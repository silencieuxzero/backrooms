<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>后室模拟器</title>
<style>
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
}

/* 开始界面样式 */
#start-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #E0DAA6;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    background-image:
        radial-gradient(circle at 10% 20%, rgba(147, 122, 45, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(147, 122, 45, 0.1) 0%, transparent 20%);
}

.start-container {
    width: 90%;
    max-width: 800px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
    padding: 40px;
    text-align: center;
    border: 2px solid #937A2D;
    position: relative;
    overflow: hidden;
}

.start-container::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, #937A2D, #e0daa6, #937A2D);
}

.game-title {
    font-size: 3.5rem;
    color: #937A2D;
    margin-bottom: 40px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    letter-spacing: 2px;
    font-weight: bold;
}

.quote-container {
    min-height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin: 40px 0;
    padding: 30px;
    background: rgba(240, 233, 200, 0.7);
    border-radius: 8px;
    border: 1px solid #937A2D;
    position: relative;
}

.quote-text {
    font-size: 1.4rem;
    line-height: 1.6;
    color: #333;
    margin-bottom: 20px;
    font-style: italic;
    text-align: center;
}

.quote-author {
    font-size: 1.1rem;
    color: #937A2D;
    font-weight: bold;
    align-self: flex-end;
    margin-right: 20px;
}

.start-btn {
    background: linear-gradient(135deg, #937A2D 0%, #7a6424 100%);
    color: white;
    border: none;
    padding: 16px 40px;
    font-size: 1.3rem;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(147, 122, 45, 0.4);
    margin-top: 20px;
    font-weight: bold;
    letter-spacing: 1px;
}

.start-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(147, 122, 45, 0.6);
    background: linear-gradient(135deg, #7a6424 0%, #63501d 100%);
}

.start-btn:active {
    transform: translateY(1px);
}

.footer {
    margin-top: 30px;
    font-size: 0.9rem;
    color: #666;
}

@media (max-width: 768px) {
    .game-title {
        font-size: 2.5rem;
    }
    .quote-text {
        font-size: 1.2rem;
    }
    .start-container {
        padding: 30px 20px;
    }
}

/* 原游戏样式保持不变 */
body {
    background: #E0DAA6;
    color: #000000;
    line-height: 1.6;
    min-height: 100vh;
    padding: 10px;
    background-image:
        radial-gradient(circle at 10% 20%, rgba(147, 122, 45, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(147, 122, 45, 0.1) 0%, transparent 20%);
}

.game-container {
    max-width: 1200px;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    border: 1px solid #937A2D;
    display: grid;
    grid-template-columns: 250px 1fr 300px;
    grid-template-rows: auto 1fr auto;
    grid-template-areas:
        "header header header"
        "sidebar main decisions"
        "footer footer footer";
    min-height: 90vh;
}

.header {
    grid-area: header;
    background: linear-gradient(90deg, #E0DAA6 0%, #d4ca96 100%);
    padding: 15px 20px;
    border-bottom: 2px solid #937A2D;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header h1 {
    font-size: 1.5rem;
    color: #000000;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.time-controls {
    display: flex;
    gap: 10px;
    align-items: center;
}

.time-btn {
    background: #937A2D;
    color: #ffffff;
    border: 1px solid #7a6424;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}

.time-btn:hover:not(:disabled) {
    background: #7a6424;
}

.time-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.current-time {
    font-size: 1.2rem;
    font-weight: bold;
    color: #000000;
    margin-right: 10px;
}

.sidebar {
    grid-area: sidebar;
    background: #f0e9c8;
    padding: 15px;
    border-right: 1px solid #937A2D;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.character-panel {
    background: #f5f0d9;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    max-height: 300px;
    overflow-y: auto;
}

.character-card {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    padding: 8px;
    background: #f0e9c8;
    border-radius: 4px;
    border-left: 3px solid #937A2D;
}

.character-info {
    flex: 1;
}

.character-name {
    font-weight: bold;
    color: #000000;
    font-size: 0.9rem;
}

.character-role {
    font-size: 0.7rem;
    color: #5a5a5a;
}

.relationship-bar {
    height: 6px;
    background: #e0daa6;
    border-radius: 3px;
    margin-top: 5px;
    overflow: hidden;
}

.relationship-fill {
    height: 100%;
    background: #937A2D;
    border-radius: 3px;
}

.main-content {
    grid-area: main;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    overflow-y: auto;
}

.status-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
}

.status-card {
    background: #f5f0d9;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    text-align: center;
}

.status-value {
    font-size: 1.8rem;
    font-weight: bold;
    color: #937A2D;
    margin: 5px 0;
}

.status-label {
    font-size: 0.8rem;
    color: #5a5a5a;
}

.buff-container {
    background: #f5f0d9;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    margin-top: 10px;
}

.buff-title {
    color: #937A2D;
    font-size: 1.1rem;
    margin-bottom: 10px;
    font-weight: bold;
}

.buff-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.buff-item {
    background: rgba(147, 122, 45, 0.1);
    padding: 8px 12px;
    border-radius: 4px;
    border: 1px solid #937A2D;
    font-size: 0.9rem;
    color: #333;
}

/* 站内事件容器 */
.site-event-container {
    background: #f5f0d9;
    padding: 20px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    flex: 1;
    display: flex;
    flex-direction: column;
}

/* 人物加入事件容器 */
.character-join-container {
    background: #f5f0d9;
    padding: 20px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    display: flex;
    flex-direction: column;
    max-height: 300px;
    overflow-y: auto;
}

/* 站内竞赛容器 */
.site-contest-container {
    background: #f5f0d9;
    padding: 20px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    display: flex;
    flex-direction: column;
    max-height: 300px;
    overflow-y: auto;
}

.event-title {
    color: #937A2D;
    font-size: 1.3rem;
    margin-bottom: 15px;
    border-left: 4px solid #937A2D;
    padding-left: 10px;
}

.event-description {
    background: rgba(147, 122, 45, 0.1);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    line-height: 1.7;
    border: 1px solid #937A2D;
    flex: 1;
}

.choices-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin-top: 20px;
}

.choice-btn {
    background: linear-gradient(135deg, #937A2D 0%, #7a6424 100%);
    color: #ffffff;
    border: none;
    padding: 15px;
    border-radius: 6px;
    text-align: left;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
    border: 1px solid #7a6424;
    position: relative;
    overflow: hidden;
}

.choice-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, #7a6424 0%, #63501d 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.choice-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.choice-btn.selected {
    background: linear-gradient(135deg, #7a6424 0%, #63501d 100%);
    border-color: #E0DAA6;
}

.choice-btn::after {
    content: "▶";
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #E0DAA6;
}

.confirm-btn {
    background: #937A2D;
    color: #ffffff;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 15px;
    align-self: flex-end;
}

.confirm-btn:hover:not(:disabled) {
    background: #7a6424;
}

.confirm-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.next-event-btn {
    background: #937A2D;
    color: #ffffff;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 15px;
    align-self: flex-end;
}

.next-event-btn:hover:not(:disabled) {
    background: #7a6424;
}

.next-event-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.decisions-panel {
    grid-area: decisions;
    background: #f0e9c8;
    padding: 15px;
    border-left: 1px solid #937A2D;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.panel-title {
    color: #937A2D;
    font-size: 1.2rem;
    margin-bottom: 10px;
    border-bottom: 1px solid #937A2D;
    padding-bottom: 5px;
}

.decision-category {
    background: #f5f0d9;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #937A2D;
}

.decision-btn {
    background: #937A2D;
    color: #ffffff;
    border: 1px solid #7a6424;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    width: 100%;
    text-align: left;
    margin-bottom: 8px;
    transition: all 0.2s ease;
}

.decision-btn:hover:not(:disabled) {
    background: #7a6424;
}

.decision-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.active-decision {
    background: rgba(147, 122, 45, 0.2);
    border-color: #937A2D;
}

.progress-bar {
    height: 6px;
    background: #e0daa6;
    border-radius: 3px;
    margin-top: 5px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: #937A2D;
    border-radius: 3px;
    width: 0%;
    transition: width 0.3s ease;
}

.effects-display {
    background: #f5f0d9;
    padding: 10px;
    border-radius: 6px;
    margin-top: 15px;
    border: 1px solid #937A2D;
    font-size: 0.9rem;
}

.effect-item {
    display: flex;
    align-items: center;
    margin: 5px 0;
}

.effect-positive {
    color: #06d6a0;
}

.effect-negative {
    color: #ef476f;
}

.hidden {
    display: none !important;
}

.game-over {
    text-align: center;
    padding: 30px;
}

.game-over h2 {
    color: #937A2D;
    margin-bottom: 20px;
}

.restart-btn {
    background: linear-gradient(135deg, #ef476f 0%, #ff6b6b 100%);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 25px;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 20px;
    transition: all 0.3s ease;
}

.restart-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(239, 71, 111, 0.4);
}

.footer {
    grid-area: footer;
    background: #f0e9c8;
    padding: 10px 20px;
    border-top: 1px solid #937A2D;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
    color: #5a5a5a;
}

.current-leader {
    font-weight: bold;
    color: #937A2D;
}

/* 国策系统样式 */
.national-policy-category {
    background: #f5f0d9;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    margin-bottom: 15px;
}

.policy-item {
    background: #f0e9c8;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 8px;
    border-left: 3px solid #937A2D;
    display: flex;
    justify-content: between;
    align-items: center;
}

.policy-info {
    flex: 1;
}

.policy-name {
    font-weight: bold;
    color: #000000;
    font-size: 0.9rem;
}

.policy-description {
    font-size: 0.7rem;
    color: #5a5a5a;
    margin-top: 2px;
}

.policy-requirements {
    font-size: 0.7rem;
    color: #937A2D;
    font-style: italic;
    margin-top: 2px;
}

.policy-btn {
    background: #937A2D;
    color: #ffffff;
    border: 1px solid #7a6424;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
    white-space: nowrap;
}

.policy-btn:hover:not(:disabled) {
    background: #7a6424;
}

.policy-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.policy-btn.executing {
    background: #7a6424;
    cursor: not-allowed;
}

.policy-btn.completed {
    background: #06d6a0;
    cursor: default;
}

/* 响应式设计 */
@media (max-width: 900px) {
    .game-container {
        grid-template-columns: 1fr;
        grid-template-areas:
            "header"
            "main"
            "decisions"
            "sidebar"
            "footer";
    }
    .sidebar, .decisions-panel {
        border: none;
        border-top: 1px solid #937A2D;
    }
}
</style>
</head>
<body>
<!-- 开始界面 -->
<div id="start-screen">
    <div class="start-container">
        <h1 class="game-title">后室模拟器</h1>
        <div class="quote-container">
            <div class="quote-text" id="quote-text">你无需告诉我Fandom后室中文的未来如何，我会亲自去迎接她的未来。</div>
            <div class="quote-author" id="quote-author">----- APT</div>
        </div>
        <button class="start-btn" id="start-btn">开始游戏</button>
        <div class="footer">后室模拟器 4.2</div>
    </div>
</div>

<!-- 原游戏界面 -->
<div class="game-container hidden" id="game-container">
    <div class="header">
        <h1>后室模拟器</h1>
        <div class="time-controls">
            <div class="current-time" id="current-time">2022年1月</div>
            <button class="time-btn" id="next-month">下一个月</button>
        </div>
    </div>
    
    <div class="sidebar">
        <div class="character-panel">
            <h3>关键人物</h3>
            <div id="characters-container">
                <!-- 角色卡片将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="status-cards">
            <div class="status-card">
                <div class="status-label">行政力</div>
                <div class="status-value" id="admin-power">100</div>
            </div>
            <div class="status-card">
                <div class="status-label">影响力</div>
                <div class="status-value" id="influence">50</div>
            </div>
            <div class="status-card">
                <div class="status-label">社群情绪</div>
                <div class="status-value" id="community-mood">70</div>
            </div>
            <div class="status-card">
                <div class="status-label">文章质量</div>
                <div class="status-value" id="article-quality">60</div>
            </div>
            <div class="status-card">
                <div class="status-label">活跃写手</div>
                <div class="status-value" id="active-writers">30</div>
            </div>
            <div class="status-card">
                <div class="status-label">站点资金</div>
                <div class="status-value" id="site-funds">1000</div>
            </div>
        </div>
        
        <!-- Buff显示区域 -->
        <div class="buff-container">
            <div class="buff-title">当前生效Buff</div>
            <div class="buff-list" id="buff-list">
                <!-- Buff将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <!-- 站内事件容器 -->
        <div class="site-event-container" id="site-event-container">
            <h2 class="event-title" id="site-event-title">建站初期</h2>
            <div class="event-description" id="site-event-description">
                2022年1月，你作为普通写手加入了刚刚成立的Fandom后室中文站。Cycas作为首任站长，与karma、RBTL等人一起建立了站点的基本框架。此时，站点刚刚起步，大家充满热情。
            </div>
            <div class="choices-container" id="site-choices-container">
                <button class="choice-btn" data-choice="0">支持Cycas的稳健发展路线</button>
                <button class="choice-btn" data-choice="1">建议更激进的扩张策略</button>
                <button class="choice-btn" data-choice="2">专注创作，少参与管理事务</button>
            </div>
            <button class="confirm-btn hidden" id="site-confirm-btn">确定选择</button>
            <button class="next-event-btn hidden" id="site-next-event-btn">下一事件</button>
            <div class="effects-display hidden" id="site-effects-display">
                <!-- 站内事件效果显示区域 -->
            </div>
        </div>
        
        <!-- 人物加入事件容器 -->
        <div class="character-join-container" id="character-join-container">
            <h2 class="event-title">人物加入</h2>
            <div class="event-description" id="character-join-description">
                本月没有重要人物加入。
            </div>
            <div class="choices-container" id="character-choices-container">
                <!-- 人物加入选择按钮将通过JavaScript动态生成 -->
            </div>
            <button class="confirm-btn hidden" id="character-confirm-btn">确定选择</button>
            <button class="next-event-btn hidden" id="character-next-event-btn">下一人物</button>
            <div class="effects-display hidden" id="character-effects-display">
                <!-- 人物加入事件效果显示区域 -->
            </div>
        </div>
        
        <!-- 站内竞赛容器 -->
        <div class="site-contest-container" id="site-contest-container">
            <h2 class="event-title" id="contest-event-title">竞赛</h2>
            <div class="event-description" id="contest-event-description">
                本月没有竞赛事件。
            </div>
            <div class="choices-container" id="contest-choices-container">
                <!-- 竞赛选择按钮将通过JavaScript动态生成 -->
            </div>
            <button class="confirm-btn hidden" id="contest-confirm-btn">确定选择</button>
            <button class="next-event-btn hidden" id="contest-next-event-btn">下一竞赛</button>
            <div class="effects-display hidden" id="contest-effects-display">
                <!-- 竞赛事件效果显示区域 -->
            </div>
        </div>
        
        <div id="game-over-container" class="game-over hidden">
            <h2 id="game-over-title">游戏结束</h2>
            <p id="game-over-description"></p>
            <button class="restart-btn" id="restart-btn">重新开始游戏</button>
        </div>
    </div>
    
    <div class="decisions-panel">
        <!-- 国策系统 -->
        <div class="decision-category">
            <h3 class="panel-title">国策系统</h3>
            <div style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">
                最多同时进行5个国策，每个消耗10行政点，耗时1个月
            </div>
            <div class="national-policy-category">
                <h4 style="color: #937A2D; margin-bottom: 8px;">通用国策</h4>
                <div id="general-policies">
                    <!-- 通用国策将通过JavaScript动态生成 -->
                </div>
            </div>
            <div class="national-policy-category">
                <h4 style="color: #937A2D; margin-bottom: 8px;">宣传线国策</h4>
                <div id="propaganda-policies">
                    <!-- 宣传线国策将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>
        
        <div class="decision-category">
            <h3 class="panel-title">管理决议</h3>
            <button class="decision-btn" id="decision-quality" data-cost="20" data-time="3">提升文章质量标准</button>
            <button class="decision-btn" id="decision-recruit" data-cost="15" data-time="2">招募新写手</button>
            <button class="decision-btn" id="decision-promote" data-cost="25" data-time="4">宣传推广活动</button>
            <button class="decision-btn" id="decision-reform" data-cost="30" data-time="5">管理体制改革</button>
        </div>
        
        <div class="decision-category">
            <h3 class="panel-title">人事决议</h3>
            <button class="decision-btn" id="decision-appoint-admin" data-cost="15">任命管理员</button>
            <button class="decision-btn" id="decision-dismiss-admin" data-cost="10">撤销管理员</button>
            <button class="decision-btn" id="decision-appoint-moderator" data-cost="10">任命版主</button>
            <button class="decision-btn" id="decision-dismiss-moderator" data-cost="5">撤销版主</button>
            <div id="admin-list">
                <div>管理员: <span id="admin-names">无</span></div>
            </div>
            <div id="moderator-list">
                <div>版主: <span id="moderator-names">无</span></div>
            </div>
        </div>
        
        <div class="decision-category">
            <h3 class="panel-title">关系决议</h3>
            <button class="decision-btn" id="decision-improve-relation" data-cost="10">提升人物好感度</button>
            <button class="decision-btn" id="decision-decrease-relation" data-cost="5">降低人物好感度</button>
        </div>
        
        <div class="decision-category">
            <h3 class="panel-title">进行中的决议</h3>
            <div id="active-decisions">
                <!-- 进行中的决议将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <div class="decision-category">
            <h3 class="panel-title">进行中的国策</h3>
            <div id="active-policies">
                <!-- 进行中的国策将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div>当前站长: <span class="current-leader" id="current-leader">Cycas</span></div>
        <div>决议槽: <span id="decision-slots">0/2</span></div>
        <div>国策槽: <span id="policy-slots">0/5</span></div>
        <div>游戏版本: 4.2</div>
    </div>
</div>

<script>
// 开始界面功能

// 名言数组
const quotes = [
    { text: "代码的过多使用不能作为文章是否优秀的标准，文章的总体风格不能作为文章是否优秀的的标准。", author: "山后蔓" },
    { text: "你无需告诉我Fandom后室中文的未来如何，我会亲自去迎接她的未来。", author: "APT" },
    { text: "写手交流群的初衷，是为了提供一个互相学习、交流与提升的平台。", author: "杨队" },
    { text: "写手们应注重于自身的独特才是。", author: "面包" },
    { text: "所有人都只在乎版式。", author: "面包" },
    { text: "何必在乎他对Fandom的看法，他愿意去哪里是他的选择。", author: "面包" },
    { text: "所有人都只在乎字数。", author: "面包" },
    { text: "不要犹豫，也别让才华沉寂。", author: "杨队" },
    { text: "你群怎么没有接入国家电网，这么一来就可以彻底解除能源危机了。", author: "海旦" },
    { text: "草。", author: "RBTL" },
    { text: "这个人有五个红票是怎么写出蝴蝶效应这么好的文的啊。", author: "Cycas" },
    { text: "别写感叹号亚层好嘛哥哥。", author: "Rezrp813" },
    { text: "未完，丢沙。", author: "Daoqd" },
    { text: "妈的，我管理员权限没了。", author: "XRH" },
    { text: "你们在伤害我。", author: "Doog" },
    { text: "你电脑没装QQ是吧。", author: "Doog" },
    { text: "现在艺术全靠AI模型了。", author: "小濮" },
    { text: "创作是一种自慰，是对于自己子意识体的强奸。", author: "海旦的不知名朋友" },
    { text: "我好失望。你连最基础的标点错误都没有改，你到底是为什么回来?", author: "面包" },
    { text: "COLA！", author: "杨队" },
    { text: "当时诛灭可是我鸡腿...击退...集推...你妈不推了。", author: "杨队" },
    { text: "质疑月冥，理解月冥，成为月冥。", author: "盒子" },
    { text: "这真是，无与伦比的奇迹。", author: "杨队" },
    { text: "Why was this chat talking about cock", author: "密歇根" },
    { text: "河水的速度也越来越接近平常。", author: "极风" },
    { text: "在User:To Mildew./CC执行操作\"edit\"时触发了过滤器。采取的行动：区段封禁、封禁；过滤器描述：内容含有敏感词。", author: "滥用过滤器" },
    { text: "我创死你！", author: "Lunaticninety" },
    { text: "创作并不是无中生有，而是来自作家的日常中，作家将日常提炼了出来。", author: "四方之中" },
    { text: "我来用弗洛伊德分析一下你现在的情况------你有恋母情结。", author: "Airy" },
    { text: "老写手就可以不顾脸面卖淫了？", author: "南岸" }
];

// 打乱数组顺序（Fisher-Yates洗牌算法）
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// 初始化开始界面
let shuffledQuotes = shuffleArray(quotes);
let currentQuoteIndex = 0;
let quoteInterval;

// 更新名言显示 - 修复版本
function updateQuote() {
    const quoteText = document.getElementById('quote-text');
    const quoteAuthor = document.getElementById('quote-author');
    
    // 直接更新文本内容
    quoteText.textContent = shuffledQuotes[currentQuoteIndex].text;
    quoteAuthor.textContent = "----- " + shuffledQuotes[currentQuoteIndex].author;
    
    // 更新索引，确保不会越界
    currentQuoteIndex = (currentQuoteIndex + 1) % shuffledQuotes.length;
    
    // 如果回到开头，重新洗牌
    if (currentQuoteIndex === 0) {
        shuffledQuotes = shuffleArray(quotes);
    }
}

// 开始游戏
document.getElementById('start-btn').addEventListener('click', function() {
    clearInterval(quoteInterval);
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('game-container').classList.remove('hidden');
    initGame();
});

// 初始化开始界面
// 先显示第一条名言
updateQuote();
// 然后开始定时器
quoteInterval = setInterval(updateQuote, 5000);

// 游戏状态
const gameState = {
    currentEventIndex: 0,
    currentSubEventIndex: 0,
    year: 2022,
    month: 1,
    adminPower: 100,
    influence: 100,
    communityMood: 70,
    articleQuality: 60,
    activeWriters: 30,
    siteFunds: 1000,
    currentLeader: "Cycas",
    characters: {
        "Cycas": { name: "Cycas", role: "现任站长", relationship: 60, faction: "pragmatic", active: true, gender: "male" },
        "XRHX": { name: "XRHX", role: "写手", relationship: 50, faction: "diverse", adminBonus: { communityMood: 10 }, moderatorBonus: { communityMood: 5 }, active: false, gender: "male" },
        "RBTL": { name: "RBTL", role: "写手", relationship: 40, faction: "threshold", adminBonus: { articleQuality: 10 }, moderatorBonus: { articleQuality: 5 }, active: false, gender: "male" },
        "karma": { name: "karma", role: "写手", relationship: 45, faction: "threshold", adminBonus: { adminPower: 5 }, moderatorBonus: { adminPower: 4 }, active: false, gender: "male" },
        // 晴雪与雨改为22年4月加入
        "晴雪与雨": { name: "晴雪与雨", role: "写手", relationship: 55, faction: "diverse", adminBonus: { communityMood: 10 }, moderatorBonus: { communityMood: 5 }, active: false, gender: "female" },
        // Adaihappyjan改为22年3月加入
        "Adaihappyjan": { name: "Adaihappyjan", role: "写手", relationship: 30, faction: "pragmatic", adminBonus: { adminPower: 10 }, moderatorBonus: { adminPower: 5 }, active: false, gender: "male" },
        // Lunaticninety改为22年3月加入
        "Lunaticninety": { name: "Lunaticninety", role: "写手", relationship: 35, faction: "pragmatic", adminBonus: { communityMood: 10 }, moderatorBonus: { communityMood: 5 }, active: false, gender: "female" },
        "MaxwellYang": { name: "MaxwellYang", role: "写手", relationship: 50, faction: "pragmatic", adminBonus: { influence: 10 }, moderatorBonus: { influence: 5 }, active: false, gender: "male" },
        "Aread": { name: "Aread", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { adminPower: 5 }, moderatorBonus: { adminPower: 3 }, gender: "male" },
        "APT": { name: "APT", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { activeWriters: 5 }, moderatorBonus: { activeWriters: 3 }, gender: "male" },
        "池续": { name: "池续", role: "写手", relationship: 40, faction: "diverse", active: false, adminBonus: { articleQuality: 10 }, moderatorBonus: { articleQuality: 5 }, gender: "male" },
        "有雪落在白川山": { name: "有雪落在白川山", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { communityMood: 5 }, moderatorBonus: { communityMood: 3 }, gender: "female" },
        "南岸青栀": { name: "南岸青栀", role: "写手", relationship: 35, faction: "diverse", active: false, adminBonus: { influence: 5 }, moderatorBonus: { influence: 3 }, gender: "female" },
        "零域": { name: "零域", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { pragmaticSupport: 5 }, moderatorBonus: { pragmaticSupport: 3 }, gender: "male" },
        "Doog": { name: "Doog", role: "写手", relationship: 25, faction: "threshold", active: false, adminBonus: { thresholdSupport: 5 }, moderatorBonus: { thresholdSupport: 3 }, gender: "male" },
        "FWMango": { name: "FWMango", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { adminPower: 5 }, moderatorBonus: { adminPower: 3 }, gender: "male" },
        // 原有新增人物
        "Ritisech": { name: "Ritisech", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { communityMood: 5 }, moderatorBonus: { communityMood: 3 }, gender: "male" },
        "小濮": { name: "小濮", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { communityMood: 5 }, moderatorBonus: { communityMood: 3 }, gender: "male" },
        "列文": { name: "列文", role: "写手", relationship: 30, faction: "threshold", active: false, adminBonus: { articleQuality: 5 }, moderatorBonus: { articleQuality: 3 }, gender: "female" },
        "星极": { name: "星极", role: "写手", relationship: 40, faction: "diverse", active: false, adminBonus: { influence: 10 }, moderatorBonus: { influence: 5 }, gender: "female" },
        "子午线": { name: "子午线", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { communityMood: 10 }, moderatorBonus: { communityMood: 5 }, gender: "female" },
        "芦苇": { name: "芦苇", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { adminPower: 10 }, moderatorBonus: { adminPower: 5 }, gender: "male" },
        // === 新增人物 - 文章质量相关 ===
        "Ashy": { name: "Ashy", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { articleQuality: 8 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "纳吉卡": { name: "纳吉卡", role: "写手", relationship: 35, faction: "diverse", active: false, adminBonus: { articleQuality: 10 }, moderatorBonus: { articleQuality: 5 }, gender: "male" },
        "小落": { name: "小落", role: "写手", relationship: 40, faction: "threshold", active: false, adminBonus: { articleQuality: 7 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        "饮鸩": { name: "饮鸩", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { articleQuality: 6 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        "柠檬": { name: "柠檬", role: "写手", relationship: 35, faction: "diverse", active: false, adminBonus: { articleQuality: 8 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "苏狐": { name: "苏狐", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { articleQuality: 9 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "ZPR": { name: "ZPR", role: "写手", relationship: 30, faction: "threshold", active: false, adminBonus: { articleQuality: 7 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        "Lazy": { name: "Lazy", role: "写手", relationship: 35, faction: "diverse", active: false, adminBonus: { articleQuality: 8 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "欧阳": { name: "欧阳", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { articleQuality: 10 }, moderatorBonus: { articleQuality: 5 }, gender: "male" },
        "Bingo": { name: "Bingo", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { articleQuality: 6 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        "月冥": { name: "月冥", role: "写手", relationship: 35, faction: "threshold", active: false, adminBonus: { articleQuality: 9 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "山后蔓": { name: "山后蔓", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { articleQuality: 8 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "繁星": { name: "繁星", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { articleQuality: 7 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        "ASDS": { name: "ASDS", role: "写手", relationship: 35, faction: "pragmatic", active: false, adminBonus: { articleQuality: 6 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        // === 新增人物 - 社区情绪相关 ===
        "海旦": { name: "海旦", role: "写手", relationship: 40, faction: "diverse", active: false, adminBonus: { communityMood: 12 }, moderatorBonus: { communityMood: 6 }, gender: "male" },
        "XXjun": { name: "XXjun", role: "写手", relationship: 35, faction: "pragmatic", active: false, adminBonus: { communityMood: 8 }, moderatorBonus: { communityMood: 4 }, gender: "male" },
        "水桶": { name: "水桶", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { communityMood: 10 }, moderatorBonus: { communityMood: 5 }, gender: "male" },
        "Rua": { name: "Rua", role: "写手", relationship: 40, faction: "threshold", active: false, adminBonus: { communityMood: 9 }, moderatorBonus: { communityMood: 4 }, gender: "male" },
        "时雨": { name: "时雨", role: "写手", relationship: 35, faction: "pragmatic", active: false, adminBonus: { communityMood: 7 }, moderatorBonus: { communityMood: 3 }, gender: "male" },
        "末年安夏": { name: "末年安夏", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { communityMood: 8 }, moderatorBonus: { communityMood: 4 }, gender: "male" },
        "Xxcby": { name: "Xxcby", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { communityMood: 6 }, moderatorBonus: { communityMood: 3 }, gender: "male" },
        "York": { name: "York", role: "写手", relationship: 35, faction: "threshold", active: false, adminBonus: { communityMood: 9 }, moderatorBonus: { communityMood: 4 }, gender: "male" },
        "8nxs": { name: "8nxs", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { communityMood: 7 }, moderatorBonus: { communityMood: 3 }, gender: "male" },
        // === 新增人物 - 行政点相关 ===
        "艺曦": { name: "艺曦", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { adminPower: 15 }, moderatorBonus: { adminPower: 7 }, gender: "male" },
        "Stapel": { name: "Stapel", role: "写手", relationship: 35, faction: "diverse", active: false, adminBonus: { adminPower: 12 }, moderatorBonus: { adminPower: 6 }, gender: "male" },
        "神经": { name: "神经", role: "写手", relationship: 30, faction: "threshold", active: false, adminBonus: { adminPower: 10 }, moderatorBonus: { adminPower: 5 }, gender: "male" },
        "铁桶": { name: "铁桶", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { adminPower: 8 }, moderatorBonus: { adminPower: 4 }, gender: "male" }
    },
    completedEvents: [],
    isGameOver: false,
    activeDecisions: [],
    decisionSlots: 2,
    // 国策系统
    nationalPolicies: {
        completed: [],
        active: [],
        maxActivePolicies: 5
    },
    // Buff系统
    activeBuffs: {},
    // 特殊状态标记
    rbtlStayed: false,
    uprisingSuccess: false,
    whiteMountainBanned: false,
    chixuPassed: false,
    whiteMountainRehabilitated: false,
    adaiLeft: false,
    // 冬月奏变相关状态
    winterMoonEvents: [],
    inWinterMoonSequence: false,
    // 选择确认相关状态
    selectedChoice: null,
    choiceConfirmed: false,
    // 管理员和版主
    admins: [],
    moderators: [],
    // 人物加入序列
    characterJoinSequence: [],
    inCharacterJoinSequence: false,
    currentCharacterJoinIndex: 0,
    // 竞赛事件相关状态
    contestEvents: [],
    inContestSequence: false,
    currentContestIndex: 0,
    // 新状态：当前显示的是站内事件还是人物加入事件
    currentEventType: "site" // 可以是 "site" 或 "character"
};

// 国策数据
const nationalPolicies = {
    // 通用国策
    "general-1": {
        id: "general-1",
        name: "建立基础制度",
        description: "建立站点基本管理制度",
        category: "general",
        cost: 10,
        time: 1,
        effects: { adminPower: 5 },
        requirements: []
    },
    "general-2": {
        id: "general-2",
        name: "组建宣传组",
        description: "建立专门的宣传团队",
        category: "general",
        cost: 10,
        time: 1,
        effects: { influence: 20 },
        requirements: ["general-1"],
        unlocks: ["decision-recruit", "decision-promote"]
    },
    "general-3": {
        id: "general-3",
        name: "红黄票制度落实",
        description: "建立文章评价体系",
        category: "general",
        cost: 10,
        time: 1,
        effects: { articleQuality: 10 },
        requirements: ["general-1"],
        unlocks: ["decision-quality"]
    },
    "general-4": {
        id: "general-4",
        name: "建立站规",
        description: "制定详细的站点规则",
        category: "general",
        cost: 10,
        time: 1,
        effects: { activeWriters: 10 },
        requirements: ["general-1"]
    },
    "general-5": {
        id: "general-5",
        name: "举办竞赛",
        description: "组织创作竞赛活动",
        category: "general",
        cost: 10,
        time: 1,
        effects: { influence: 15 },
        requirements: ["general-2"],
        unlocks: ["decision-article-contest", "decision-creative-contest", "decision-translation-contest"]
    },
    // 宣传线国策
    "propaganda-1": {
        id: "propaganda-1",
        name: "宣传组改革",
        description: "优化宣传组工作流程",
        category: "propaganda",
        cost: 10,
        time: 1,
        effects: { influence: 10 },
        requirements: ["general-2"]
    },
    "propaganda-2": {
        id: "propaganda-2",
        name: "文章介绍",
        description: "推广优秀文章作品",
        category: "propaganda",
        cost: 10,
        time: 1,
        effects: { influence: 10, activeWriters: 10 },
        requirements: ["propaganda-1"]
    },
    "propaganda-3": {
        id: "propaganda-3",
        name: "联动其他up主",
        description: "与其他创作者合作推广",
        category: "propaganda",
        cost: 10,
        time: 1,
        effects: { influence: 20 },
        requirements: ["propaganda-2"],
        buff: { id: "influence-wide", name: "影响力广泛", effect: "activeWriters", value: 5, duration: -1 }
    },
    "propaganda-4": {
        id: "propaganda-4",
        name: "光明的未来",
        description: "展望站点发展前景",
        category: "propaganda",
        cost: 10,
        time: 1,
        effects: {},
        requirements: ["propaganda-3"],
        buff: { id: "bright-future", name: "前景光明", effect: "influence", value: 5, duration: -1 }
    }
};

// 决议数据（已删除竞赛决议）
const decisions = {
    "decision-quality": {
        name: "提升文章质量标准",
        description: "制定更严格的文章审核标准，提高整体内容质量",
        cost: 20,
        time: 3,
        effects: {
            articleQuality: 15,
            communityMood: -10,
            activeWriters: -5,
            influence: 10
        },
        requiresPolicy: "general-3"
    },
    "decision-recruit": {
        name: "招募新写手",
        description: "通过宣传活动吸引更多创作者加入",
        cost: 15,
        time: 2,
        effects: {
            activeWriters: 10,
            influence: 50,
            articleQuality: -20,
            adminPower: -10
        },
        requiresPolicy: "general-2"
    },
    "decision-promote": {
        name: "宣传推广活动",
        description: "在B站等平台进行推广，扩大社群影响力",
        cost: 25,
        time: 4,
        effects: {
            activeWriters: 15,
            influence: 70,
            adminPower: -15
        },
        requiresPolicy: "general-2"
    },
    "decision-reform": {
        name: "管理体制改革",
        description: "改革站点管理制度，提高管理效率",
        cost: 30,
        time: 5,
        effects: {
            adminPower: 20,
            communityMood: -15,
            influence: 25
        }
    }
};

// 竞赛事件数据
const contestEvents = [
    {
        id: "first-theme-contest",
        title: "第一届主题竞赛",
        description: "2022年8月，第一届主题竞赛结束。Yoghurt的《子宫》荣获第一，Tsz的《Level 2088》荣获第二，ZPR的《遗忘森林》荣获第三。",
        triggerMonth: 8,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "second-theme-contest",
        title: "第二届主题竞赛",
        description: "2023年1月，第二届主题竞赛结束。PM的《通话》荣获第一，小落的《偶戏》荣获第二，零域的《乡土已逝》荣获第三。",
        triggerMonth: 13,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "first-story-contest",
        title: "第一届故事竞赛",
        description: "2023年3月，第一届故事竞赛结束。XRHX的《冷雨夜》荣获第一，晴雪与雨的《为了替她赴死》荣获第二，Ran的《所及最高处》荣获第三。",
        triggerMonth: 15,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "third-theme-contest",
        title: "第三届主题竞赛",
        description: "2023年8月，第三届主题竞赛结束。这一次竞赛是为了大清洗中新生的ZH层级的Level ZH 0的编号竞争。最终，由XRHX、月冥和时雨共同创作的文章拿下了这一次竞赛的第一名。",
        triggerMonth: 20,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "fourth-theme-contest",
        title: "第四届主题竞赛",
        description: "2024年2月，第四届主题竞赛结束。XRHX的《Level →》荣获第一，Aread的《终焉》荣获第二，MaxwellYang的《Level ZH 993》荣获第三。",
        triggerMonth: 26,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "fifth-theme-contest-result",
        title: "第五届主题竞赛结果",
        description: "2024年8月，第五届主题竞赛结束，盒子的《黑匣》荣幸获得了Object ZH 1的编号。",
        triggerMonth: 32,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "joint-contest",
        title: "联合图文竞赛",
        description: "FBC于2024年8月举办了联合图文竞赛，零域的《罐中海》荣获第一，MaxwellYang的《2001.10.9，18:45》荣获第二，Comlontaa的《往昔再现》荣获第三。",
        triggerMonth: 32,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    }
];

// 游戏事件数据（包含第五次竞赛的成就事件）
const gameEvents = [
    // 建站初期 - Cycas时期
    {
        id: "founding",
        title: "建站初期",
        description: "2022年1月，你作为普通写手加入了刚刚成立的Fandom后室中文站。Cycas作为首任站长，与karma、RBTL等人一起建立了站点的基本框架。此时，站点刚刚起步，大家充满热情。",
        triggerMonth: 1,
        choices: [
            {
                text: "支持Cycas的稳健发展路线",
                effects: {
                    communityMood: 10,
                    "Cycas": 20,
                    adminPower: 10,
                    influence: 5,
                    siteFunds: 50
                }
            },
            {
                text: "建议更激进的扩张策略",
                effects: {
                    activeWriters: 10,
                    "Cycas": -10,
                    "RBTL": 15,
                    adminPower: -5,
                    influence: 10,
                    siteFunds: -20
                }
            },
            {
                text: "专注创作，少参与管理事务",
                effects: {
                    influence: 10,
                    articleQuality: 10,
                    "XRHX": 10,
                    siteFunds: 30
                }
            }
        ],
        afterEvent: function() {
            // 启动人物加入序列
            gameState.characterJoinSequence = [
                { name: "XRHX", description: "XRHX加入了后室中文站，她很快成为了社群中的重要成员，以其独特的创作风格受到关注。" },
                { name: "karma", description: "karma加入了后室中文站，作为建站元老之一，他在社群中有着重要地位。" },
                { name: "RBTL", description: "RBTL加入了后室中文站，他对后室美学有着强烈的坚持，很快在社群中崭露头角。" },
                { name: "海旦", description: "海旦加入了后室中文站，他是一位活跃的社群成员，能够有效提升社区情绪。" }
            ];
            gameState.inCharacterJoinSequence = true;
            gameState.currentCharacterJoinIndex = 0;
            showCharacterJoinEvent(0);
        }
    },
    {
        id: "translation-conflict",
        title: "翻译争议",
        description: "2022年2月，写手Doog因使用机器翻译被RBTL严厉批评，双方发生激烈争吵。RBTL最终封禁了Doog，但处理方式引起了一些成员的不满。",
        triggerMonth: 2,
        choices: [
            {
                text: "不好意思！您的翻译水平不够！请练练再来吧！",
                effects: {
                    articleQuality: 15,
                    "RBTL": 15,
                    communityMood: 15,
                    "Doog": -114514,
                    influence: 5
                }
            },
            {
                text: "你们在伤害Doog",
                effects: {
                    "RBTL": -15,
                    communityMood: -10,
                    "Doog": 10,
                    influence: -10
                }
            },
            {
                text: "提议建立更完善的翻译规范",
                effects: {
                    influence: 20,
                    adminPower: -15,
                    "XRHX": 10,
                    articleQuality: 10
                }
            }
        ]
    },
    {
        id: "cycas-leaves",
        title: "Cycas卸任",
        description: "2022年3月，Cycas因个人原因决定卸任站长职务。RBTL凭借其在社群中的影响力成为新任站长。同时，karma也随Cycas一起离开了管理层。",
        triggerMonth: 3,
        choices: [
            {
                text: "支持RBTL继任站长",
                effects: {
                    "RBTL": 25,
                    "Cycas": -10,
                    communityMood: -5,
                    influence: 5
                }
            },
            {
                text: "建议由其他人担任站长",
                effects: {
                    "RBTL": -15,
                    "XRHX": 15,
                    "Adaihappyjan": 10,
                    communityMood: -10,
                    influence: 10
                }
            },
            {
                text: "挽留karma，希望他留下",
                effects: {
                    influence: 15,
                    "karma": 30,
                    communityMood: 10,
                    "Cycas": 5
                }
            },
            {
                text: "尊重Cycas的决定，保持中立",
                effects: {
                    influence: 10,
                    "Cycas": 10,
                    communityMood: 5
                }
            }
        ],
        afterEvent: function(choiceIndex) {
            gameState.currentLeader = "RBTL";
            // 移除Cycas的角色
            delete gameState.characters.Cycas;
            // 如果选择挽留karma（选项2），则不删除karma
            if (choiceIndex !== 2) {
                delete gameState.characters.karma;
            }
        }
    },
    {
        id: "ai-crisis",
        title: "智械危机",
        description: "2022年12月，管理员神经申请到了滥用过滤器机器人，然而，在该机器人被APK启动后，XRHX、上单、Adaihappyjan等人被滥用过滤器误伤。后来，该过滤器又误伤了铁桶。群聊内多把此事当做笑料。",
        triggerMonth: 12,
        choices: [
            {
                text: "傻逼滥用过滤器",
                effects: {
                    communityMood: 10
                }
            }
        ]
    },
    {
        id: "rbtl-policy",
        title: "RBTL的政策",
        description: "2022年5月，RBTL上任后提出了相关政策，要求所有文章必须符合后室核心美学。这一政策在社群中引发了激烈讨论。",
        triggerMonth: 5,
        choices: [
            {
                text: "支持RBTL的纯粹路线",
                effects: {
                    articleQuality: 15,
                    communityMood: -10,
                    "RBTL": 20,
                    "晴雪与雨": -15,
                    influence: -10
                }
            },
            {
                text: "反对限制，支持创作自由",
                effects: {
                    communityMood: 5,
                    "晴雪与雨": 25,
                    "RBTL": -20,
                    influence: -15
                }
            },
            {
                text: "建议更温和的实施方式",
                effects: {
                    influence: 15,
                    communityMood: 5,
                    adminPower: -10
                }
            }
        ]
    },
    {
        id: "style-war",
        title: "文风战争",
        description: "2022年8月，RBTL与晴雪与雨的冲突彻底爆发。RBTL坚持纯粹路线，而晴雪与雨等人支持多元创作。社群普遍支持晴雪与雨，RBTL面临下台危机。",
        triggerMonth: 8,
        choices: [
            {
                text: "和这群非纯粹派在一起，怎么能搞好后室呢",
                effects: {
                    articleQuality: 10,
                    communityMood: -30,
                    "RBTL": 25,
                    "晴雪与雨": -40,
                    activeWriters: -20,
                    influence: -20
                }
            },
            {
                text: "天无二日，我心中只有晴雪一个太阳",
                effects: {
                    communityMood: -20,
                    "晴雪与雨": 40,
                    "XRHX": 25,
                    "RBTL": -50,
                    activeWriters: -10,
                    influence: -15
                }
            },
            {
                text: "呼吁双方冷静，寻求妥协",
                effects: {
                    influence: 30,
                    communityMood: 10,
                    "XRHX": 30,
                    "RBTL": -20,
                    "晴雪与雨": 15
                }
            }
        ],
        afterEvent: function(choiceIndex) {
            // 如果选择支持RBTL，RBTL留任
            if (choiceIndex === 0) {
                gameState.rbtlStayed = true;
                gameState.currentLeader = "RBTL";
            } else {
                // 否则RBTL下台
                gameState.rbtlStayed = false;
                gameState.currentLeader = "Lunaticninety";
                // 实际权力在Adaihappyjan手中
                gameState.characters.Adaihappyjan.relationship += 20;
                gameState.characters.Lunaticninety.role = "名义站长";
                gameState.characters.Adaihappyjan.role = "实际掌权者";
                // 移除RBTL
                delete gameState.characters.RBTL;
            }
        }
    },
    {
        id: "spring-festival-2023",
        title: "后室春节联欢晚会",
        description: "2023年1月，社群举办了第一届后室春节联欢晚会，大家欢聚一堂，共同庆祝春节。",
        triggerMonth: 13,
        choices: [
            {
                text: "支持举办春节联欢晚会",
                effects: {
                    communityMood: 20,
                    influence: 10
                }
            }
        ]
    },
    {
        id: "february-uprising",
        title: "二月动乱",
        description: "2023年2月，有雪落在白川山联合大量写手发起抗议，要求管理改革。社群普遍支持白川山，反对Adaihappyjan的实际控制。",
        triggerMonth: 14,
        choices: [
            {
                text: "这已经不是一般的写手了，一定要出重拳",
                effects: {
                    adminPower: 20,
                    communityMood: -25,
                    "Adaihappyjan": 20,
                    "有雪落在白川山": -30,
                    activeWriters: -15,
                    influence: -25
                }
            },
            {
                text: "造反好啊，争取武装夺取政权",
                effects: {
                    communityMood: -15,
                    "有雪落在白川山": 35,
                    "Adaihappyjan": -25,
                    activeWriters: 10,
                    influence: -20
                }
            },
            {
                text: "寻求妥协方案，避免社群分裂",
                effects: {
                    influence: 25,
                    adminPower: -15,
                    communityMood: 10,
                    "有雪落在白川山": 10
                }
            }
        ],
        afterEvent: function(choiceIndex) {
            // 根据选择决定动乱结果
            if (choiceIndex === 1) {
                gameState.uprisingSuccess = true;
                gameState.currentLeader = "有雪落在白川山";
                gameState.characters["有雪落在白川山"].role = "站长";
            } else {
                gameState.uprisingSuccess = false;
                gameState.whiteMountainBanned = true;
                gameState.characters["有雪落在白川山"].active = false;
            }
        }
    },
    {
        id: "march-first-incident",
        title: "三一事件",
        description: "2023年3月，版主Ashy突然将大量Wikidot成员移出群聊，引发轩然大波。最终Ashy被永久封禁，FWMango也因此事受到牵连。",
        triggerMonth: 15,
        choices: [
            {
                text: "支持Ashy的行动，维护Fandom独立性",
                effects: {
                    communityMood: -20,
                    activeWriters: -10,
                    influence: -15
                }
            },
            {
                text: "批评Ashy的过激行为",
                effects: {
                    adminPower: 15,
                    communityMood: -10,
                    "Adaihappyjan": 15,
                    influence: -10
                }
            },
            {
                text: "呼吁两站和解，共同发展",
                effects: {
                    influence: 20,
                    communityMood: 15,
                    "XRHX": 20
                }
            }
        ],
        afterEvent: function() {
            gameState.characters["FWMango"].active = true;
            // 封禁Ashy、纳吉卡、小落
            gameState.characters["Ashy"].active = false;
            gameState.characters["纳吉卡"].active = false;
            gameState.characters["小落"].active = false;
        }
    },
    {
        id: "adai-becomes-leader",
        title: "Adaihappyjan成为站长",
        description: "2023年6月，Adaihappyjan正式成为站长，掌握了站点的实际管理权。",
        triggerMonth: 18,
        choices: [
            {
                text: "支持Adaihappyjan的领导",
                effects: {
                    "Adaihappyjan": 20,
                    adminPower: 10,
                    communityMood: 5,
                    influence: 5,
                    siteFunds: 100
                }
            },
            {
                text: "对Adaihappyjan的独断表示担忧",
                effects: {
                    "Adaihappyjan": -15,
                    communityMood: -10,
                    influence: -10
                }
            }
        ],
        afterEvent: function() {
            gameState.currentLeader = "Adaihappyjan";
            gameState.characters.Adaihappyjan.role = "站长";
        }
    },
    {
        id: "great-purge",
        title: "大清洗运动",
        description: "2023年7月，Adaihappyjan提出了'大清洗'计划，旨在清理全站低质量文章。这一激进改革引发了激烈争议。",
        triggerMonth: 19,
        choices: [
            {
                text: "支持大清洗，提升文章质量",
                effects: {
                    articleQuality: 25,
                    communityMood: -30,
                    "Adaihappyjan": 30,
                    activeWriters: -20,
                    influence: -15
                }
            },
            {
                text: "反对大清洗，保护创作热情",
                effects: {
                    communityMood: -15,
                    "Adaihappyjan": -30,
                    "XRHX": 15,
                    activeWriters: 15,
                    influence: -10
                }
            },
            {
                text: "提议更温和的质量改进方案",
                effects: {
                    influence: 30,
                    adminPower: -20,
                    articleQuality: 10,
                    communityMood: 5,
                    "XRHX": 20
                }
            }
        ]
    },
    {
        id: "maxwell-becomes-leader",
        title: "MaxwellYang成为站长",
        description: "2023年8月，MaxwellYang成为站长，与Adaihappyjan共同拥有管理权限。",
        triggerMonth: 20,
        choices: [
            {
                text: "支持MaxwellYang的领导",
                effects: {
                    "MaxwellYang": 20,
                    adminPower: 5,
                    communityMood: 5,
                    influence: 5
                }
            },
            {
                text: "认为权力分散会导致效率低下",
                effects: {
                    "MaxwellYang": 10,
                    "Adaihappyjan": -5,
                    communityMood: 5
                }
            }
        ],
        afterEvent: function() {
            gameState.currentLeader = "MaxwellYang";
            gameState.characters.MaxwellYang.role = "站长";
            gameState.characters.Adaihappyjan.role = "共同管理者";
        }
    },
    {
        id: "fifth-contest-achievement",
        title: "第五届主题竞赛争议",
        description: "2024年7月，第五届主题竞赛开始了，本次竞赛是争夺Object ZH 1的编号。然而有写手对本次的'成就'机制感到不满。",
        triggerMonth: 31,
        choices: [
            {
                text: "所有人都只在乎返璞归真。",
                effects: {
                    articleQuality: -10
                }
            }
        ]
    },
    {
        id: "spring-festival-2024",
        title: "后室春节联欢晚会",
        description: "2024年1月，社群举办了第二届后室春节联欢晚会，大家欢聚一堂，共同庆祝春节。",
        triggerMonth: 25,
        choices: [
            {
                text: "支持举办春节联欢晚会",
                effects: {
                    communityMood: 20,
                    influence: 10
                }
            }
        ]
    },
    {
        id: "chixu-illness",
        title: "池续患病",
        description: "2024年4月，原创组组长池续被诊断出患有急性粒细胞白血病。这一消息震惊了整个社群。",
        triggerMonth: 28,
        choices: [
            {
                text: "组织社群支持，为池续加油",
                effects: {
                    communityMood: -20,
                    "池续": 40,
                    "MaxwellYang": 10,
                    influence: 10,
                    siteFunds: -200
                }
            },
            {
                text: "继续日常工作，不过度打扰",
                effects: {
                    communityMood: -20,
                    "池续": 20,
                    "MaxwellYang": 10,
                }
            }
        ]
    },
    {
        id: "chixu-passed",
        title: "池续逝世",
        description: "2024年6月，我们挚爱的池续永远离开了我们。他的才华、热情和奉献精神都为后室中文站带来了巨大的价值。",
        triggerMonth: 30,
        choices: [
            {
                text: "人事已尽，天命难为",
                effects: {
                    articleQuality: -10,
                    communityMood: -15
                }
            }
        ],
        afterEvent: function() {
            gameState.chixuPassed = true;
            gameState.characters["池续"].active = false;
        }
    },
    {
        id: "winter-moon-sequence",
        title: "冬月奏变",
        description: "2024年12月，长期积累的矛盾终于爆发，社群面临前所未有的分裂危机。",
        triggerMonth: 36,
        isSequence: true,
        subEvents: [
            {
                title: "重写MEG CN",
                description: "APT INSTALL提议重写MEG CN，但Adaihappyjan以版权为由一票否决，引发争议。",
                choices: [
                    {
                        text: "支持重写MEG CN",
                        effects: {
                            "Adaihappyjan": -20,
                            "APT": 35,
                            communityMood: -10,
                            influence: -10
                        }
                    },
                    {
                        text: "支持Adaihappyjan的决定",
                        effects: {
                            "Adaihappyjan": 15,
                            communityMood: -5,
                            influence: -5
                        }
                    }
                ]
            },
            {
                title: "MaxwellYang下台",
                description: "在冬月奏变的压力下，MaxwellYang宣布卸任站长职务，Aread成为新站长。",
                choices: [
                    {
                        text: "支持Aread继任",
                        effects: {
                            "Aread": 20,
                            communityMood: -5,
                            influence: -5
                        }
                    },
                    {
                        text: "反对这一人事变动",
                        effects: {
                            "Aread": -15,
                            communityMood: -10,
                            influence: -10
                        }
                    }
                ],
                afterEvent: function() {
                    gameState.currentLeader = "Aread";
                    gameState.characters.Aread.role = "站长";
                    gameState.characters.MaxwellYang.role = "前站长";
                }
            },
            {
                title: "要求公开资金去向",
                description: "零域等人要求宣传组公开财务收支，引发关于资金透明度的激烈争论。",
                choices: [
                    {
                        text: "支持公开资金去向",
                        effects: {
                            "Adaihappyjan": -25,
                            communityMood: -10,
                            influence: -10
                        }
                    },
                    {
                        text: "反对公开，保护隐私",
                        effects: {
                            "Adaihappyjan": 15,
                            communityMood: -15,
                            influence: -15
                        }
                    }
                ]
            },
            {
                title: "阿达下台",
                description: "在持续的压力下，Adaihappyjan宣布下台，并带走了他投入的所有资金。",
                choices: [
                    {
                        text: "谴责Adaihappyjan的行为",
                        effects: {
                            "Adaihappyjan": -40,
                            communityMood: 20,
                            activeWriters: 15,
                            "APT": 30,
                            influence: 10,
                            siteFunds: -500
                        }
                    },
                    {
                        text: "理解Adaihappyjan的决定",
                        effects: {
                            "Adaihappyjan": -10,
                            communityMood: -25,
                            activeWriters: -10,
                            influence: -20
                        }
                    }
                ],
                afterEvent: function(choiceIndex) {
                    gameState.adaiLeft = true;
                    gameState.characters.Adaihappyjan.active = false;
                }
            },
            {
                title: "白川山要求平反",
                description: "有雪落在白川山要求为二月动乱平反，恢复其名誉。",
                choices: [
                    {
                        text: "支持平反，恢复白川山名誉",
                        effects: {
                            communityMood: 10,
                            activeWriters: 5,
                            influence: 10
                        }
                    },
                    {
                        text: "反对平反，维持原决定",
                        effects: {
                            communityMood: -10,
                            influence: -10
                        }
                    }
                ],
                afterEvent: function(choiceIndex) {
                    if (choiceIndex === 0) {
                        gameState.whiteMountainRehabilitated = true;
                        gameState.characters["有雪落在白川山"].active = true;
                        gameState.characters["有雪落在白川山"].role = "写手";
                    }
                }
            }
        ]
    },
    {
        id: "rebuild-promotion",
        title: "重建宣传组",
        description: "2025年1月，在冬月奏变后，社群开始重建宣传组，试图恢复站点的活力。",
        triggerMonth: 37,
        choices: [
            {
                text: "积极参与重建工作",
                effects: {
                    communityMood: 15,
                    activeWriters: 10,
                    influence: 10,
                    siteFunds: -100
                }
            },
            {
                text: "保持观望态度",
                effects: {
                    communityMood: 5
                }
            }
        ]
    }
];

// 月份触发的人物加入事件（已调整时间）
const monthlyCharacterJoins = {
    1: [ // 2022年1月 - 海旦已在初始序列中加入
    ],
    2: [ // 2022年2月
    ],
    3: [ // 2022年3月
        { name: "Adaihappyjan", description: "Adaihappyjan加入了后室中文站，他拥有丰富的资源和宣传经验，为站点发展提供了重要支持。" },
        { name: "Lunaticninety", description: "Lunaticninety加入了后室中文站，她是一位有管理经验的成员，未来可能在站点管理中发挥作用。" },
        { name: "Ritisech", description: "Ritisech加入了后室中文站，他是一位活跃的成员，对社区氛围有积极影响。" },
        { name: "芦苇", description: "芦苇加入了后室中文站，他是一位有管理才能的成员，未来可能在站点管理中发挥作用。" },
        { name: "XXjun", description: "XXjun加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "山后蔓", description: "山后蔓加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "Lazy", description: "Lazy加入了后室中文站，他是一位有才华的写手，能够提升站点的文章质量。" }
    ],
    4: [ // 2022年4月 - 晴雪与雨改为此时加入
        { name: "晴雪与雨", description: "晴雪与雨加入了后室中文站，她是一位有才华的创作者，对后室创作有自己的独特见解。" },
        { name: "MaxwellYang", description: "MaxwellYang加入了后室中文站，他是一位有调解能力的成员，未来可能在社群协调中发挥作用。" },
        { name: "星极", description: "星极加入了后室中文站，她是一位有才华的写手，能够提升站点的影响力。" },
        { name: "柠檬", description: "柠檬加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "Rua", description: "Rua加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "铁桶", description: "铁桶加入了后室中文站，他是一位有管理才能的成员，能够提供行政支持。" }
    ],
    5: [ // 2022年5月
        { name: "南岸青栀", description: "南岸青栀加入了后室中文站，她是一位有才华的写手，为社群带来了新的活力。" },
        { name: "Ashy", description: "Ashy加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" }
    ],
    6: [ // 2022年6月
        { name: "ZPR", description: "ZPR加入了后室中文站，他是一位有才华的写手，能够提升站点的文章质量。" }
    ],
    7: [ // 2022年7月
        { name: "月冥", description: "月冥加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "ASDS", description: "ASDS加入了后室中文站，他是一位有才华的写手，能够提升站点的文章质量。" },
        { name: "水桶", description: "水桶加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "神经", description: "神经加入了后室中文站，他是一位有管理才能的成员，能够提供行政支持。" }
    ],
    8: [ // 2022年8月
        { name: "小濮", description: "小濮加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "列文", description: "列文加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "子午线", description: "子午线加入了后室中文站，她是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "纳吉卡", description: "纳吉卡加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "时雨", description: "时雨加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "8nxs", description: "8nxs加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" }
    ],
    9: [ // 2022年9月
        { name: "零域", description: "零域加入了后室中文站，他是一位有才华的写手，为社群带来了新的活力。" },
        { name: "苏狐", description: "苏狐加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "繁星", description: "繁星加入了后室中文站，他是一位有才华的写手，能够提升站点的文章质量。" }
    ],
    10: [ // 2022年10月
        { name: "Aread", description: "Aread加入了后室中文站，他是一位有管理经验的成员，未来可能在站点管理中发挥作用。" },
        { name: "小落", description: "小落加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "欧阳", description: "欧阳加入了后室中文站，他是一位有才华的写手，能够提升站点的文章质量。" }
    ],
    11: [ // 2022年11月
        { name: "池续", description: "池续加入了后室中文站，他是一位才华横溢的写手，但性格和创作理念各不相同。" },
        { name: "有雪落在白川山", description: "有雪落在白川山加入了后室中文站，她是一位才华横溢的写手，但性格和创作理念各不相同。" }
    ],
    15: [ // 2023年3月
        { name: "APT", description: "APT加入了后室中文站，他是一位有想法的写手，对后室创作有自己的见解。" }
    ],
    16: [ // 2023年4月 - Stapel在23年2月加入，但为了逻辑放在4月
        { name: "Stapel", description: "Stapel加入了后室中文站，他是一位有管理才能的成员，能够提供行政支持。" }
    ],
    18: [ // 2023年6月
        { name: "York", description: "York加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" }
    ],
    25: [ // 2023年12月
        { name: "末年安夏", description: "末年安夏加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" }
    ],
    28: [ // 2024年1月
        { name: "Bingo", description: "Bingo加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" }
    ],
    29: [ // 2024年3月
        { name: "艺曦", description: "艺曦加入了后室中文站，他是一位有管理才能的成员，能够提供行政支持。" }
    ],
    31: [ // 2024年5月
        { name: "饮鸩", description: "饮鸩加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" }
    ],
    34: [ // 2024年6月
        { name: "Xxcby", description: "Xxcby加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" }
    ]
};

// 显示人物加入事件
function showCharacterJoinEvent(index) {
    if (index >= gameState.characterJoinSequence.length) {
        // 人物加入序列结束
        gameState.inCharacterJoinSequence = false;
        gameState.characterJoinSequence = [];
        showNoCharacterJoin();
        return;
    }
    
    const characterEvent = gameState.characterJoinSequence[index];
    const character = gameState.characters[characterEvent.name];
    
    document.getElementById('character-join-description').textContent = characterEvent.description;
    
    // 更新选择按钮
    const choicesContainer = document.getElementById('character-choices-container');
    choicesContainer.innerHTML = '';
    
    const button = document.createElement('button');
    button.className = 'choice-btn';
    button.textContent = `欢迎${characterEvent.name}加入`;
    
    // 直接绑定点击事件，不通过通用选择处理
    button.onclick = function() {
        // 激活该角色
        character.active = true;
        character.relationship += 20;
        
        // 显示效果
        showCharacterEffects({ [characterEvent.name]: 20 }, `${characterEvent.name}已加入`);
        
        // 禁用选择按钮
        button.disabled = true;
        
        // 隐藏确认按钮
        document.getElementById('character-confirm-btn').classList.add('hidden');
        
        // 如果还有更多人物，显示下一事件按钮
        if (index < gameState.characterJoinSequence.length - 1) {
            document.getElementById('character-next-event-btn').classList.remove('hidden');
        } else {
            document.getElementById('character-next-event-btn').classList.add('hidden');
        }
        
        // 更新显示
        renderCharacterPanel();
        updateGameDisplay();
        // 更新按钮状态
        updateButtonStates();
    };
    
    choicesContainer.appendChild(button);
    
    // 隐藏确认按钮
    document.getElementById('character-confirm-btn').classList.add('hidden');
    // 隐藏下一事件按钮
    document.getElementById('character-next-event-btn').classList.add('hidden');
    // 隐藏效果显示
    document.getElementById('character-effects-display').classList.add('hidden');
    
    // 重置选择状态
    gameState.selectedChoice = null;
    gameState.choiceConfirmed = false;
    
    // 更新按钮状态
    updateButtonStates();
}

// 显示无人物加入
function showNoCharacterJoin() {
    document.getElementById('character-join-description').textContent = "本月没有重要人物加入。";
    document.getElementById('character-choices-container').innerHTML = '';
    document.getElementById('character-confirm-btn').classList.add('hidden');
    document.getElementById('character-next-event-btn').classList.add('hidden');
    document.getElementById('character-effects-display').classList.add('hidden');
    
    // 更新按钮状态
    updateButtonStates();
}

// 显示竞赛事件
function showContestEvent(event) {
    if (!event) {
        showNoContest();
        return;
    }
    
    document.getElementById('contest-event-title').textContent = event.title;
    document.getElementById('contest-event-description').textContent = event.description;
    
    // 更新选择按钮
    const choicesContainer = document.getElementById('contest-choices-container');
    choicesContainer.innerHTML = '';
    
    event.choices.forEach((choice, index) => {
        const button = document.createElement('button');
        button.className = 'choice-btn';
        button.textContent = choice.text;
        button.setAttribute('data-choice', index);
        button.addEventListener('click', handleContestChoiceSelection);
        choicesContainer.appendChild(button);
    });
    
    // 显示确认按钮
    document.getElementById('contest-confirm-btn').classList.remove('hidden');
    
    // 如果有多个竞赛，显示下一竞赛按钮
    if (gameState.inContestSequence && gameState.currentContestIndex < gameState.contestEvents.length - 1) {
        document.getElementById('contest-next-event-btn').classList.remove('hidden');
    } else {
        document.getElementById('contest-next-event-btn').classList.add('hidden');
    }
    
    // 隐藏效果显示
    document.getElementById('contest-effects-display').classList.add('hidden');
    
    // 重置选择状态
    gameState.selectedChoice = null;
    gameState.choiceConfirmed = false;
    
    // 更新按钮状态
    updateButtonStates();
}

// 显示无竞赛事件
function showNoContest() {
    document.getElementById('contest-event-title').textContent = "竞赛";
    document.getElementById('contest-event-description').textContent = "本月没有竞赛事件。";
    document.getElementById('contest-choices-container').innerHTML = '';
    document.getElementById('contest-confirm-btn').classList.add('hidden');
    document.getElementById('contest-next-event-btn').classList.add('hidden');
    document.getElementById('contest-effects-display').classList.add('hidden');
    
    // 更新按钮状态
    updateButtonStates();
}

// 处理竞赛选择按钮点击
function handleContestChoiceSelection(event) {
    if (gameState.choiceConfirmed) return;
    
    const choiceIndex = parseInt(event.currentTarget.getAttribute('data-choice'));
    gameState.selectedChoice = choiceIndex;
    
    // 更新按钮样式
    document.querySelectorAll('#contest-choices-container .choice-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');
    
    updateButtonStates();
}

// 处理竞赛选择确认
function handleContestChoiceConfirmation() {
    if (gameState.selectedChoice === null) return;
    
    // 获取当前竞赛事件
    const currentEvent = gameState.contestEvents[gameState.currentContestIndex];
    const choice = currentEvent.choices[gameState.selectedChoice];
    
    // 应用选择效果
    applyEffects(choice.effects);
    
    // 显示效果
    showContestEffects(choice.effects);
    
    // 标记事件为已完成
    gameState.completedEvents.push(currentEvent.id);
    
    // 标记选择已确认
    gameState.choiceConfirmed = true;
    
    // 禁用选择按钮
    document.querySelectorAll('#contest-choices-container .choice-btn').forEach(btn => {
        btn.disabled = true;
    });
    
    // 隐藏确认按钮
    document.getElementById('contest-confirm-btn').classList.add('hidden');
    
    // 更新显示
    updateGameDisplay();
    
    // 更新按钮状态
    updateButtonStates();
    
    // 检查结局条件
    checkEndings();
}

// 显示竞赛效果
function showContestEffects(effects, title = "选择效果") {
    const effectsDisplay = document.getElementById('contest-effects-display');
    effectsDisplay.classList.remove('hidden');
    effectsDisplay.innerHTML = `<div style="margin-bottom: 10px; color: #937A2D;">${title}:</div>`;
    
    Object.keys(effects).forEach(key => {
        const effectItem = document.createElement('div');
        effectItem.className = 'effect-item';
        let displayText = '';
        let value = effects[key];
        
        if (key === 'adminPower') {
            displayText = `行政力 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'influence') {
            displayText = `影响力 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'communityMood') {
            displayText = `社群情绪 ${value > 0 ? '+' : ''}${value}%`;
        } else if (key === 'articleQuality') {
            displayText = `文章质量 ${value > 0 ? '+' : ''}${value}%`;
        } else if (key === 'activeWriters') {
            displayText = `活跃写手 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'siteFunds') {
            displayText = `站点资金 ${value > 0 ? '+' : ''}${value}`;
        }
        
        effectItem.textContent = displayText;
        effectItem.classList.add(value > 0 ? 'effect-positive' : 'effect-negative');
        effectsDisplay.appendChild(effectItem);
    });
}

// 处理竞赛下一事件
function handleContestNextEvent() {
    if (gameState.inContestSequence) {
        // 处理竞赛序列
        gameState.currentContestIndex++;
        if (gameState.currentContestIndex < gameState.contestEvents.length) {
            // 显示下一个竞赛事件
            showContestEvent(gameState.contestEvents[gameState.currentContestIndex]);
        } else {
            // 竞赛序列结束
            gameState.inContestSequence = false;
            showNoContest();
        }
    }
}

// 初始化游戏
function initGame() {
    updateGameDisplay();
    renderCharacterPanel();
    updateActiveDecisions();
    updateStaffDisplay();
    renderNationalPolicies();
    updateBuffDisplay();
    
    // 添加选择按钮事件监听
    document.querySelectorAll('#site-choices-container .choice-btn').forEach(button => {
        button.addEventListener('click', handleSiteChoiceSelection);
    });
    
    // 添加决议按钮事件监听
    document.querySelectorAll('.decision-btn').forEach(button => {
        button.addEventListener('click', handleDecision);
    });
    
    // 添加时间控制按钮事件监听
    document.getElementById('next-month').addEventListener('click', advanceMonth);
    
    // 添加确认按钮事件监听
    document.getElementById('site-confirm-btn').addEventListener('click', handleSiteChoiceConfirmation);
    document.getElementById('character-confirm-btn').addEventListener('click', handleCharacterChoiceConfirmation);
    document.getElementById('contest-confirm-btn').addEventListener('click', handleContestChoiceConfirmation);
    
    // 添加下一事件按钮事件监听
    document.getElementById('site-next-event-btn').addEventListener('click', handleSiteNextEvent);
    document.getElementById('character-next-event-btn').addEventListener('click', handleCharacterNextEvent);
    document.getElementById('contest-next-event-btn').addEventListener('click', handleContestNextEvent);
    
    // 添加重新开始按钮事件监听
    document.getElementById('restart-btn').addEventListener('click', restartGame);
    
    // 显示初始事件
    showSiteEvent(gameEvents[0]);
    
    // 显示人物加入事件容器（始终显示）
    document.getElementById('character-join-container').classList.remove('hidden');
    showNoCharacterJoin();
    
    // 显示竞赛事件容器（始终显示）
    document.getElementById('site-contest-container').classList.remove('hidden');
    showNoContest();
    
    // 确保所有按钮初始状态正确
    updateButtonStates();
}

// 渲染国策系统
function renderNationalPolicies() {
    renderGeneralPolicies();
    renderPropagandaPolicies();
    updateActivePoliciesDisplay();
}

// 渲染通用国策
function renderGeneralPolicies() {
    const container = document.getElementById('general-policies');
    container.innerHTML = '';
    
    Object.values(nationalPolicies).forEach(policy => {
        if (policy.category === 'general') {
            const policyElement = createPolicyElement(policy);
            container.appendChild(policyElement);
        }
    });
}

// 渲染宣传线国策
function renderPropagandaPolicies() {
    const container = document.getElementById('propaganda-policies');
    container.innerHTML = '';
    
    Object.values(nationalPolicies).forEach(policy => {
        if (policy.category === 'propaganda') {
            const policyElement = createPolicyElement(policy);
            container.appendChild(policyElement);
        }
    });
}

// 创建国策元素
function createPolicyElement(policy) {
    const policyDiv = document.createElement('div');
    policyDiv.className = 'policy-item';
    
    const policyInfo = document.createElement('div');
    policyInfo.className = 'policy-info';
    
    const policyName = document.createElement('div');
    policyName.className = 'policy-name';
    policyName.textContent = policy.name;
    
    const policyDesc = document.createElement('div');
    policyDesc.className = 'policy-description';
    policyDesc.textContent = policy.description;
    
    const policyReq = document.createElement('div');
    policyReq.className = 'policy-requirements';
    
    // 检查前置条件
    const requirementsMet = policy.requirements.every(req => 
        gameState.nationalPolicies.completed.includes(req)
    );
    
    // 检查是否已完成
    const isCompleted = gameState.nationalPolicies.completed.includes(policy.id);
    
    // 检查是否正在执行
    const isExecuting = gameState.nationalPolicies.active.some(p => p.id === policy.id);
    
    // 检查是否有空余国策槽
    const hasFreePolicySlot = gameState.nationalPolicies.active.length < gameState.nationalPolicies.maxActivePolicies;
    
    // 检查行政力是否足够
    const hasEnoughPower = gameState.adminPower >= policy.cost;
    
    const policyBtn = document.createElement('button');
    policyBtn.className = 'policy-btn';
    
    if (isCompleted) {
        policyBtn.textContent = '已完成';
        policyBtn.disabled = true;
        policyBtn.classList.add('completed');
        policyReq.textContent = '效果: ' + formatPolicyEffects(policy.effects);
    } else if (isExecuting) {
        policyBtn.textContent = '执行中';
        policyBtn.disabled = true;
        policyBtn.classList.add('executing');
        policyReq.textContent = '执行中...';
    } else if (!requirementsMet) {
        policyBtn.textContent = '未解锁';
        policyBtn.disabled = true;
        policyReq.textContent = '需要: ' + policy.requirements.map(req => nationalPolicies[req].name).join(', ');
    } else if (!hasFreePolicySlot) {
        policyBtn.textContent = '国策槽已满';
        policyBtn.disabled = true;
        policyReq.textContent = '消耗: ' + policy.cost + '行政点';
    } else if (!hasEnoughPower) {
        policyBtn.textContent = '行政力不足';
        policyBtn.disabled = true;
        policyReq.textContent = '消耗: ' + policy.cost + '行政点';
    } else {
        policyBtn.textContent = '执行';
        policyBtn.onclick = () => executeNationalPolicy(policy);
        policyReq.textContent = '消耗: ' + policy.cost + '行政点';
    }
    
    policyInfo.appendChild(policyName);
    policyInfo.appendChild(policyDesc);
    policyInfo.appendChild(policyReq);
    
    policyDiv.appendChild(policyInfo);
    policyDiv.appendChild(policyBtn);
    
    return policyDiv;
}

// 格式化国策效果显示
function formatPolicyEffects(effects) {
    const effectStrings = [];
    for (const [key, value] of Object.entries(effects)) {
        let displayName = '';
        switch (key) {
            case 'adminPower': displayName = '行政力'; break;
            case 'influence': displayName = '影响力'; break;
            case 'articleQuality': displayName = '文章质量'; break;
            case 'activeWriters': displayName = '活跃写手'; break;
            default: displayName = key;
        }
        effectStrings.push(`${displayName}${value > 0 ? '+' : ''}${value}`);
    }
    return effectStrings.join(', ');
}

// 执行国策
function executeNationalPolicy(policy) {
    // 检查条件
    if (gameState.nationalPolicies.active.length >= gameState.nationalPolicies.maxActivePolicies) {
        alert('国策槽已满！最多同时进行' + gameState.nationalPolicies.maxActivePolicies + '个国策。');
        return;
    }
    
    if (gameState.adminPower < policy.cost) {
        alert('行政力不足！需要' + policy.cost + '点行政力。');
        return;
    }
    
    // 检查前置条件
    const requirementsMet = policy.requirements.every(req => 
        gameState.nationalPolicies.completed.includes(req)
    );
    
    if (!requirementsMet) {
        alert('未满足前置条件！');
        return;
    }
    
    // 扣除行政力
    gameState.adminPower -= policy.cost;
    
    // 添加到进行中国策
    gameState.nationalPolicies.active.push({
        id: policy.id,
        name: policy.name,
        time: policy.time,
        progress: 0,
        effects: policy.effects,
        buff: policy.buff,
        unlocks: policy.unlocks
    });
    
    // 更新显示
    updateGameDisplay();
    renderNationalPolicies();
}

// 更新进行中的国策显示
function updateActivePoliciesDisplay() {
    const container = document.getElementById('active-policies');
    container.innerHTML = '';
    
    if (gameState.nationalPolicies.active.length === 0) {
        container.innerHTML = '<div>没有进行中的国策</div>';
        return;
    }
    
    gameState.nationalPolicies.active.forEach(policy => {
        const progressPercent = (policy.progress / policy.time) * 100;
        const policyElement = document.createElement('div');
        policyElement.className = 'active-decision-item';
        policyElement.innerHTML = `
            <div>${policy.name}</div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progressPercent}%"></div>
            </div>
            <div>${policy.progress}/${policy.time}个月</div>
        `;
        container.appendChild(policyElement);
    });
    
    // 更新国策槽显示
    document.getElementById('policy-slots').textContent = 
        `${gameState.nationalPolicies.active.length}/${gameState.nationalPolicies.maxActivePolicies}`;
}

// 处理进行中的国策
function processActivePolicies() {
    for (let i = gameState.nationalPolicies.active.length - 1; i >= 0; i--) {
        const policy = gameState.nationalPolicies.active[i];
        policy.progress++;
        
        if (policy.progress >= policy.time) {
            // 国策完成
            applyEffects(policy.effects);
            
            // 添加Buff
            if (policy.buff) {
                gameState.activeBuffs[policy.buff.id] = {
                    name: policy.buff.name,
                    effect: policy.buff.effect,
                    value: policy.buff.value,
                    duration: policy.buff.duration
                };
            }
            
            // 解锁相关决议
            if (policy.unlocks) {
                policy.unlocks.forEach(decisionId => {
                    // 决议解锁逻辑在updateDecisionButtons中处理
                });
            }
            
            // 移动到已完成列表
            gameState.nationalPolicies.completed.push(policy.id);
            gameState.nationalPolicies.active.splice(i, 1);
            
            // 显示国策完成效果
            showSiteEffects(policy.effects, `${policy.name} 已完成`);
            
            // 重新渲染国策界面以更新状态
            renderNationalPolicies();
        }
    }
    
    // 处理Buff效果
    processBuffs();
    
    updateActivePoliciesDisplay();
    updateBuffDisplay();
}

// 处理Buff效果
function processBuffs() {
    // 应用持续Buff效果
    for (const buffId in gameState.activeBuffs) {
        const buff = gameState.activeBuffs[buffId];
        if (buff.effect && buff.value) {
            gameState[buff.effect] += buff.value;
        }
        
        // 处理有限时间的Buff
        if (buff.duration > 0) {
            buff.duration--;
            if (buff.duration <= 0) {
                delete gameState.activeBuffs[buffId];
            }
        }
    }
}

// 更新Buff显示
function updateBuffDisplay() {
    const container = document.getElementById('buff-list');
    container.innerHTML = '';
    
    if (Object.keys(gameState.activeBuffs).length === 0) {
        container.innerHTML = '<div style="color: #666; font-style: italic;">暂无生效Buff</div>';
        return;
    }
    
    for (const buffId in gameState.activeBuffs) {
        const buff = gameState.activeBuffs[buffId];
        const buffElement = document.createElement('div');
        buffElement.className = 'buff-item';
        buffElement.textContent = `${buff.name}`;
        container.appendChild(buffElement);
    }
}

// 前进一个月
function advanceMonth() {
    // 如果正在处理人物加入序列、冬月奏变序列或竞赛序列，不允许前进
    if (gameState.inCharacterJoinSequence || gameState.inWinterMoonSequence || gameState.inContestSequence) {
        return;
    }
    
    // 重置选择状态
    gameState.selectedChoice = null;
    gameState.choiceConfirmed = false;
    
    // 处理进行中的决议
    processActiveDecisions();
    
    // 处理进行中的国策
    processActivePolicies();
    
    // 处理管理员和版主好感度
    processStaffRelationships();
    
    // 应用管理员和版主加成
    applyStaffBonuses();
    
    // 更新月份
    gameState.month++;
    if (gameState.month > 12) {
        gameState.month = 1;
        gameState.year++;
    }
    
    // 每月减少20影响力
    gameState.influence = Math.max(0, gameState.influence - 20);
    
    // 更新行政力（除特殊时期外每月+5）
    const currentMonth = (gameState.year - 2022) * 12 + gameState.month;
    if (!((currentMonth >= 14 && currentMonth <= 15) || currentMonth === 36)) {
        gameState.adminPower += 5;
    }
    
    // 活跃写手大于150时，行政力每月额外增加10
    if (gameState.activeWriters > 150) {
        gameState.adminPower += 10;
    }
    
    // 活跃写手大于250时，文章质量每月下降20（原为>200，现改为>250）
    if (gameState.activeWriters > 250) {
        gameState.articleQuality = Math.max(0, gameState.articleQuality - 20);
    }
    
    // 活跃写手小于30时，社区情绪每月下降5
    if (gameState.activeWriters < 30) {
        gameState.communityMood = Math.max(0, gameState.communityMood - 5);
    }
    
    // 社群情绪影响行政力
    if (gameState.communityMood >= 70) {
        gameState.adminPower += 5;
    } else if (gameState.communityMood <= 30) {
        gameState.adminPower -= 5;
    }
    
    // 影响力影响活跃写手
    if (gameState.influence >= 60) {
        gameState.activeWriters += Math.floor(gameState.influence / 20);
    }
    
    // 确保数值在合理范围内
    gameState.influence = Math.max(0, gameState.influence);
    gameState.adminPower = Math.max(0, gameState.adminPower);
    gameState.communityMood = Math.max(0, Math.min(100, gameState.communityMood));
    gameState.articleQuality = Math.max(0, Math.min(100, gameState.articleQuality));
    gameState.activeWriters = Math.max(0, gameState.activeWriters);
    gameState.siteFunds = Math.max(0, gameState.siteFunds);
    
    updateTimeDisplay();
    checkEvents();
    checkCharacterJoins();
    checkContests();
    updateGameDisplay();
    
    // 检查结局条件
    checkEndings();
}

// 更新按钮状态
function updateButtonStates() {
    const nextMonthBtn = document.getElementById('next-month');
    const siteConfirmBtn = document.getElementById('site-confirm-btn');
    const siteNextEventBtn = document.getElementById('site-next-event-btn');
    const characterConfirmBtn = document.getElementById('character-confirm-btn');
    const characterNextEventBtn = document.getElementById('character-next-event-btn');
    const contestConfirmBtn = document.getElementById('contest-confirm-btn');
    const contestNextEventBtn = document.getElementById('contest-next-event-btn');
    
    // 如果有选择但未确认，禁用"下一个月"按钮
    nextMonthBtn.disabled = (gameState.selectedChoice !== null && !gameState.choiceConfirmed) ||
                           gameState.inCharacterJoinSequence ||
                           gameState.inContestSequence;
    
    // 站内事件按钮状态
    siteConfirmBtn.disabled = (gameState.selectedChoice === null);
    
    // 人物加入事件按钮状态
    characterConfirmBtn.disabled = (gameState.selectedChoice === null);
    
    // 竞赛事件按钮状态
    contestConfirmBtn.disabled = (gameState.selectedChoice === null);
    
    // 在人物加入序列中显示下一事件按钮
    characterNextEventBtn.classList.toggle('hidden', !gameState.inCharacterJoinSequence);
    
    // 在冬月奏变序列中显示下一事件按钮
    siteNextEventBtn.classList.toggle('hidden', !gameState.inWinterMoonSequence);
    
    // 在竞赛序列中显示下一事件按钮
    contestNextEventBtn.classList.toggle('hidden', !gameState.inContestSequence);
    
    // 更新决议按钮状态
    updateDecisionButtons();
}

// 更新决议按钮状态
function updateDecisionButtons() {
    document.querySelectorAll('.decision-btn').forEach(button => {
        const decisionId = button.id;
        if (decisionId === "decision-appoint-admin" || decisionId === "decision-dismiss-admin" ||
            decisionId === "decision-appoint-moderator" || decisionId === "decision-dismiss-moderator" ||
            decisionId === "decision-improve-relation" || decisionId === "decision-decrease-relation") {
            // 人事决议和关系决议按钮特殊处理
            button.disabled = false;
            return;
        }
        
        const decision = decisions[decisionId];
        
        // 检查是否已有相同决议在进行中
        const isActive = gameState.activeDecisions.some(d => d.id === decisionId);
        
        // 检查是否有足够的行政力和决议槽
        const hasEnoughPower = gameState.adminPower >= decision.cost;
        const hasFreeSlot = gameState.activeDecisions.length < gameState.decisionSlots;
        
        // 检查是否需要前置国策
        const policyRequired = decision.requiresPolicy;
        const hasRequiredPolicy = !policyRequired || gameState.nationalPolicies.completed.includes(policyRequired);
        
        button.disabled = isActive || !hasEnoughPower || !hasFreeSlot || !hasRequiredPolicy;
        button.classList.toggle('active-decision', isActive);
        
        // 添加提示信息
        if (policyRequired && !gameState.nationalPolicies.completed.includes(policyRequired)) {
            button.title = `需要先完成国策: ${nationalPolicies[policyRequired].name}`;
        } else {
            button.title = '';
        }
    });
}

// 处理进行中的决议
function processActiveDecisions() {
    for (let i = gameState.activeDecisions.length - 1; i >= 0; i--) {
        const decision = gameState.activeDecisions[i];
        decision.progress++;
        
        if (decision.progress >= decision.time) {
            // 决议完成
            applyEffects(decision.effects);
            gameState.activeDecisions.splice(i, 1);
            
            // 显示决议完成效果
            showSiteEffects(decision.effects, `${decision.name} 已完成`);
        }
    }
    
    updateActiveDecisions();
}

// 更新进行中的决议显示
function updateActiveDecisions() {
    const container = document.getElementById('active-decisions');
    container.innerHTML = '';
    
    if (gameState.activeDecisions.length === 0) {
        container.innerHTML = '<div>没有进行中的决议</div>';
        return;
    }
    
    gameState.activeDecisions.forEach(decision => {
        const progressPercent = (decision.progress / decision.time) * 100;
        const decisionElement = document.createElement('div');
        decisionElement.className = 'active-decision-item';
        decisionElement.innerHTML = `
            <div>${decision.name}</div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progressPercent}%"></div>
            </div>
            <div>${decision.progress}/${decision.time}个月</div>
        `;
        container.appendChild(decisionElement);
    });
}

// 处理决议
function handleDecision(event) {
    const decisionId = event.currentTarget.id;
    
    if (decisionId === "decision-appoint-admin") {
        appointAdmin();
        return;
    }
    
    if (decisionId === "decision-dismiss-admin") {
        dismissAdmin();
        return;
    }
    
    if (decisionId === "decision-appoint-moderator") {
        appointModerator();
        return;
    }
    
    if (decisionId === "decision-dismiss-moderator") {
        dismissModerator();
        return;
    }
    
    if (decisionId === "decision-improve-relation") {
        improveRelation();
        return;
    }
    
    if (decisionId === "decision-decrease-relation") {
        decreaseRelation();
        return;
    }
    
    const decision = decisions[decisionId];
    
    // 检查是否已有相同决议在进行中
    if (gameState.activeDecisions.some(d => d.id === decisionId)) {
        return;
    }
    
    // 检查是否有足够的行政力和决议槽
    if (gameState.adminPower < decision.cost ||
        gameState.activeDecisions.length >= gameState.decisionSlots) {
        return;
    }
    
    // 检查是否需要前置国策
    if (decision.requiresPolicy && !gameState.nationalPolicies.completed.includes(decision.requiresPolicy)) {
        alert(`需要先完成国策: ${nationalPolicies[decision.requiresPolicy].name}`);
        return;
    }
    
    // 扣除行政力
    gameState.adminPower -= decision.cost;
    
    // 添加到进行中的决议
    gameState.activeDecisions.push({
        id: decisionId,
        name: decision.name,
        time: decision.time,
        progress: 0,
        effects: decision.effects
    });
    
    // 更新显示
    updateGameDisplay();
    updateActiveDecisions();
}

// 任命管理员
function appointAdmin() {
    // 检查行政力
    if (gameState.adminPower < 15) {
        alert("行政力不足！需要15点行政力。");
        return;
    }
    
    const availableCharacters = Object.keys(gameState.characters).filter(name => 
        gameState.characters[name].active &&
        !gameState.admins.includes(name) &&
        name !== gameState.currentLeader &&
        !gameState.moderators.includes(name)
    );
    
    if (availableCharacters.length === 0) {
        alert("没有合适的人选可以任命为管理员！");
        return;
    }
    
    if (gameState.admins.length >= 2) {
        alert("管理员名额已满！最多只能有2名管理员。");
        return;
    }
    
    const characterName = prompt(`请选择任命为管理员的人选：\n${availableCharacters.join(', ')}`);
    
    if (characterName && availableCharacters.includes(characterName)) {
        gameState.admins.push(characterName);
        gameState.characters[characterName].relationship += 20;
        gameState.adminPower -= 15; // 消耗行政力
        updateStaffDisplay();
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已任命 ${characterName} 为管理员！`);
    }
}

// 撤销管理员
function dismissAdmin() {
    // 检查行政力
    if (gameState.adminPower < 10) {
        alert("行政力不足！需要10点行政力。");
        return;
    }
    
    if (gameState.admins.length === 0) {
        alert("当前没有管理员可以撤销！");
        return;
    }
    
    const characterName = prompt(`请选择要撤销的管理员：\n${gameState.admins.join(', ')}`);
    
    if (characterName && gameState.admins.includes(characterName)) {
        gameState.admins = gameState.admins.filter(name => name !== characterName);
        gameState.characters[characterName].relationship -= 30;
        gameState.adminPower -= 10; // 消耗行政力
        updateStaffDisplay();
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已撤销 ${characterName} 的管理员职务！`);
    }
}

// 任命版主
function appointModerator() {
    // 检查行政力
    if (gameState.adminPower < 10) {
        alert("行政力不足！需要10点行政力。");
        return;
    }
    
    const availableCharacters = Object.keys(gameState.characters).filter(name => 
        gameState.characters[name].active &&
        !gameState.moderators.includes(name) &&
        name !== gameState.currentLeader &&
        !gameState.admins.includes(name)
    );
    
    if (availableCharacters.length === 0) {
        alert("没有合适的人选可以任命为版主！");
        return;
    }
    
    if (gameState.moderators.length >= 3) {
        alert("版主名额已满！最多只能有3名版主。");
        return;
    }
    
    const characterName = prompt(`请选择任命为版主的人选：\n${availableCharacters.join(', ')}`);
    
    if (characterName && availableCharacters.includes(characterName)) {
        gameState.moderators.push(characterName);
        gameState.characters[characterName].relationship += 10;
        gameState.adminPower -= 10; // 消耗行政力
        updateStaffDisplay();
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已任命 ${characterName} 为版主！`);
    }
}

// 撤销版主
function dismissModerator() {
    // 检查行政力
    if (gameState.adminPower < 5) {
        alert("行政力不足！需要5点行政力。");
        return;
    }
    
    if (gameState.moderators.length === 0) {
        alert("当前没有版主可以撤销！");
        return;
    }
    
    const characterName = prompt(`请选择要撤销的版主：\n${gameState.moderators.join(', ')}`);
    
    if (characterName && gameState.moderators.includes(characterName)) {
        gameState.moderators = gameState.moderators.filter(name => name !== characterName);
        gameState.characters[characterName].relationship -= 20;
        gameState.adminPower -= 5; // 消耗行政力
        updateStaffDisplay();
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已撤销 ${characterName} 的版主职务！`);
    }
}

// 提升人物好感度
function improveRelation() {
    // 检查行政力
    if (gameState.adminPower < 10) {
        alert("行政力不足！需要10点行政力。");
        return;
    }
    
    const availableCharacters = Object.keys(gameState.characters).filter(name => 
        gameState.characters[name].active
    );
    
    if (availableCharacters.length === 0) {
        alert("没有合适的人选！");
        return;
    }
    
    const characterName = prompt(`请选择要提升好感度的人物：\n${availableCharacters.join(', ')}`);
    
    if (characterName && availableCharacters.includes(characterName)) {
        gameState.characters[characterName].relationship += 20;
        gameState.characters[characterName].relationship = Math.min(100, gameState.characters[characterName].relationship);
        gameState.adminPower -= 10; // 消耗行政力
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已提升 ${characterName} 的好感度！`);
    }
}

// 降低人物好感度
function decreaseRelation() {
    // 检查行政力
    if (gameState.adminPower < 5) {
        alert("行政力不足！需要5点行政力。");
        return;
    }
    
    const availableCharacters = Object.keys(gameState.characters).filter(name => 
        gameState.characters[name].active
    );
    
    if (availableCharacters.length === 0) {
        alert("没有合适的人选！");
        return;
    }
    
    const characterName = prompt(`请选择要降低好感度的人物：\n${availableCharacters.join(', ')}`);
    
    if (characterName && availableCharacters.includes(characterName)) {
        gameState.characters[characterName].relationship -= 20;
        gameState.characters[characterName].relationship = Math.max(0, gameState.characters[characterName].relationship);
        gameState.adminPower -= 5; // 消耗行政力
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已降低 ${characterName} 的好感度！`);
    }
}

// 应用效果到游戏状态
function applyEffects(effects) {
    Object.keys(effects).forEach(key => {
        if (key in gameState) {
            gameState[key] += effects[key];
            // 确保数值在合理范围内
            if (key === 'communityMood') {
                gameState[key] = Math.max(0, Math.min(100, gameState[key]));
            } else if (key === 'adminPower' || key === 'influence') {
                gameState[key] = Math.max(0, gameState[key]);
            } else if (key === 'activeWriters') {
                gameState[key] = Math.max(0, gameState[key]);
            } else if (key === 'articleQuality') {
                gameState[key] = Math.max(0, Math.min(100, gameState[key]));
            } else if (key === 'siteFunds') {
                gameState[key] = Math.max(0, gameState[key]);
            }
        } else if (key in gameState.characters) {
            gameState.characters[key].relationship += effects[key];
            gameState.characters[key].relationship = Math.max(0, Math.min(100, gameState.characters[key].relationship));
        }
    });
}

// 显示站内事件效果
function showSiteEffects(effects, title = "选择效果") {
    const effectsDisplay = document.getElementById('site-effects-display');
    effectsDisplay.classList.remove('hidden');
    effectsDisplay.innerHTML = `<div style="margin-bottom: 10px; color: #937A2D;">${title}:</div>`;
    
    Object.keys(effects).forEach(key => {
        const effectItem = document.createElement('div');
        effectItem.className = 'effect-item';
        let displayText = '';
        let value = effects[key];
        
        if (key === 'adminPower') {
            displayText = `行政力 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'influence') {
            displayText = `影响力 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'communityMood') {
            displayText = `社群情绪 ${value > 0 ? '+' : ''}${value}%`;
        } else if (key === 'articleQuality') {
            displayText = `文章质量 ${value > 0 ? '+' : ''}${value}%`;
        } else if (key === 'activeWriters') {
            displayText = `活跃写手 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'siteFunds') {
            displayText = `站点资金 ${value > 0 ? '+' : ''}${value}`;
        } else if (key in gameState.characters) {
            displayText = `${key} 关系 ${value > 0 ? '+' : ''}${value}`;
        }
        
        effectItem.textContent = displayText;
        effectItem.classList.add(value > 0 ? 'effect-positive' : 'effect-negative');
        effectsDisplay.appendChild(effectItem);
    });
}

// 显示人物加入事件效果
function showCharacterEffects(effects, title = "选择效果") {
    const effectsDisplay = document.getElementById('character-effects-display');
    effectsDisplay.classList.remove('hidden');
    effectsDisplay.innerHTML = `<div style="margin-bottom: 10px; color: #937A2D;">${title}:</div>`;
    
    Object.keys(effects).forEach(key => {
        const effectItem = document.createElement('div');
        effectItem.className = 'effect-item';
        let displayText = '';
        let value = effects[key];
        
        if (key in gameState.characters) {
            displayText = `${key} 关系 ${value > 0 ? '+' : ''}${value}`;
        }
        
        effectItem.textContent = displayText;
        effectItem.classList.add(value > 0 ? 'effect-positive' : 'effect-negative');
        effectsDisplay.appendChild(effectItem);
    });
}

// 检查月份触发的人物加入
function checkCharacterJoins() {
    const currentMonth = (gameState.year - 2022) * 12 + gameState.month;
    
    if (monthlyCharacterJoins[currentMonth]) {
        gameState.characterJoinSequence = [...monthlyCharacterJoins[currentMonth]];
        gameState.inCharacterJoinSequence = true;
        gameState.currentCharacterJoinIndex = 0;
        showCharacterJoinEvent(0);
    }
}

// 检查竞赛事件
function checkContests() {
    const currentMonth = (gameState.year - 2022) * 12 + gameState.month;
    
    // 收集本月所有未完成的竞赛事件
    const thisMonthContests = contestEvents.filter(contest => 
        !gameState.completedEvents.includes(contest.id) &&
        contest.triggerMonth === currentMonth
    );
    
    if (thisMonthContests.length > 0) {
        // 如果有多个竞赛，启动竞赛序列
        gameState.contestEvents = thisMonthContests;
        gameState.inContestSequence = true;
        gameState.currentContestIndex = 0;
        
        // 显示竞赛事件
        showContestEvent(thisMonthContests[0]);
    } else {
        // 没有竞赛事件，显示默认状态
        showNoContest();
    }
}

// 处理管理员和版主好感度
function processStaffRelationships() {
    // 管理员每月+10%好感度
    gameState.admins.forEach(admin => {
        if (gameState.characters[admin]) {
            gameState.characters[admin].relationship = Math.min(100, gameState.characters[admin].relationship + 10);
            // 如果是Adaihappyjan，则每月降低社区情绪5点
            if (admin === "Adaihappyjan") {
                gameState.communityMood = Math.max(0, gameState.communityMood - 5);
            }
        }
    });
    
    // 版主每月+5%好感度
    gameState.moderators.forEach(moderator => {
        if (gameState.characters[moderator]) {
            gameState.characters[moderator].relationship = Math.min(100, gameState.characters[moderator].relationship + 5);
            // 如果是Adaihappyjan，则每月降低社区情绪3点
            if (moderator === "Adaihappyjan") {
                gameState.communityMood = Math.max(0, gameState.communityMood - 3);
            }
        }
    });
    
    renderCharacterPanel();
}

// 应用管理员和版主加成
function applyStaffBonuses() {
    // 应用管理员加成
    gameState.admins.forEach(admin => {
        const character = gameState.characters[admin];
        if (character && character.adminBonus) {
            Object.entries(character.adminBonus).forEach(([stat, value]) => {
                if (stat in gameState) {
                    gameState[stat] += value;
                }
            });
        }
    });
    
    // 应用版主加成
    gameState.moderators.forEach(moderator => {
        const character = gameState.characters[moderator];
        if (character && character.moderatorBonus) {
            Object.entries(character.moderatorBonus).forEach(([stat, value]) => {
                if (stat in gameState) {
                    gameState[stat] += value;
                }
            });
        }
    });
}

// 更新时间显示
function updateTimeDisplay() {
    const monthNames = ["1月", "2月", "3月", "4月", "5月", "6月",
                       "7月", "8月", "9月", "10月", "11月", "12月"];
    
    document.getElementById('current-time').textContent = 
        `${gameState.year}年${monthNames[gameState.month-1]}`;
}

// 检查事件触发
function checkEvents() {
    // 如果正在处理人物加入序列、冬月奏变序列或竞赛序列，不检查其他事件
    if (gameState.inCharacterJoinSequence || gameState.inWinterMoonSequence || gameState.inContestSequence) return;
    
    const currentMonth = (gameState.year - 2022) * 12 + gameState.month;
    
    for (let i = 0; i < gameEvents.length; i++) {
        const event = gameEvents[i];
        if (!gameState.completedEvents.includes(event.id) &&
            event.triggerMonth === currentMonth) {
            
            // 如果是冬月奏变序列事件
            if (event.isSequence) {
                gameState.inWinterMoonSequence = true;
                gameState.winterMoonEvents = [...event.subEvents];
                gameState.currentSubEventIndex = 0;
                showSiteEvent(gameState.winterMoonEvents[0]);
                document.getElementById('site-next-event-btn').classList.remove('hidden');
            } else {
                // 普通事件
                gameState.currentEventIndex = i;
                showSiteEvent(event);
            }
            return;
        }
    }
    
    // 没有事件发生
    showNoSiteEvent();
}

// 显示站内事件
function showSiteEvent(event) {
    document.getElementById('site-event-title').textContent = event.title;
    document.getElementById('site-event-description').textContent = event.description;
    
    // 更新选择按钮
    const choicesContainer = document.getElementById('site-choices-container');
    choicesContainer.innerHTML = '';
    
    event.choices.forEach((choice, index) => {
        // 检查条件是否满足
        if (choice.condition && !choice.condition()) {
            return;
        }
        
        const button = document.createElement('button');
        button.className = 'choice-btn';
        button.textContent = choice.text;
        button.setAttribute('data-choice', index);
        button.addEventListener('click', handleSiteChoiceSelection);
        choicesContainer.appendChild(button);
    });
    
    // 显示确认按钮
    document.getElementById('site-confirm-btn').classList.remove('hidden');
    
    // 隐藏下一事件按钮（除非是冬月奏变序列）
    if (!gameState.inWinterMoonSequence) {
        document.getElementById('site-next-event-btn').classList.add('hidden');
    }
    
    // 隐藏效果显示
    document.getElementById('site-effects-display').classList.add('hidden');
    
    // 重置选择状态
    gameState.selectedChoice = null;
    gameState.choiceConfirmed = false;
    
    // 更新按钮状态
    updateButtonStates();
}

// 显示无站内事件
function showNoSiteEvent() {
    document.getElementById('site-event-title').textContent = "无重大事件";
    document.getElementById('site-event-description').textContent = 
        `本月没有重大事件发生。社群继续正常运作，${gameState.currentLeader}作为站长管理站点事务。`;
    
    // 清空选择按钮
    const choicesContainer = document.getElementById('site-choices-container');
    choicesContainer.innerHTML = '';
    
    // 隐藏确认按钮和下一事件按钮
    document.getElementById('site-confirm-btn').classList.add('hidden');
    document.getElementById('site-next-event-btn').classList.add('hidden');
    
    // 隐藏效果显示
    document.getElementById('site-effects-display').classList.add('hidden');
    
    // 重置选择状态
    gameState.selectedChoice = null;
    gameState.choiceConfirmed = false;
    
    // 更新按钮状态
    updateButtonStates();
}

// 处理站内选择按钮点击
function handleSiteChoiceSelection(event) {
    // 如果已经确认选择，不允许更改
    if (gameState.choiceConfirmed) return;
    
    const choiceIndex = parseInt(event.currentTarget.getAttribute('data-choice'));
    gameState.selectedChoice = choiceIndex;
    
    // 更新按钮样式
    document.querySelectorAll('#site-choices-container .choice-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');
    
    // 更新按钮状态
    updateButtonStates();
}

// 处理站内选择确认
function handleSiteChoiceConfirmation() {
    if (gameState.selectedChoice === null) return;
    
    // 获取当前事件
    let currentEvent;
    if (gameState.inWinterMoonSequence) {
        currentEvent = gameState.winterMoonEvents[gameState.currentSubEventIndex];
    } else {
        currentEvent = gameEvents[gameState.currentEventIndex];
    }
    
    const choice = currentEvent.choices[gameState.selectedChoice];
    
    // 应用选择效果
    applyEffects(choice.effects);
    
    // 显示效果
    showSiteEffects(choice.effects);
    
    // 执行事件后处理
    if (currentEvent.afterEvent) {
        currentEvent.afterEvent(gameState.selectedChoice);
    }
    
    // 如果不是冬月奏变序列，标记事件为已完成
    if (!gameState.inWinterMoonSequence) {
        gameState.completedEvents.push(currentEvent.id);
    }
    
    // 标记选择已确认
    gameState.choiceConfirmed = true;
    
    // 禁用选择按钮
    document.querySelectorAll('#site-choices-container .choice-btn').forEach(btn => {
        btn.disabled = true;
    });
    
    // 隐藏确认按钮
    document.getElementById('site-confirm-btn').classList.add('hidden');
    
    // 更新显示
    updateGameDisplay();
    renderCharacterPanel();
    
    // 更新按钮状态
    updateButtonStates();
    
    // 检查结局条件
    checkEndings();
}

// 处理人物选择确认
function handleCharacterChoiceConfirmation() {
    // 此函数保留用于未来扩展
}

// 处理站内下一事件
function handleSiteNextEvent() {
    if (gameState.inWinterMoonSequence) {
        // 处理冬月奏变序列
        gameState.currentSubEventIndex++;
        if (gameState.currentSubEventIndex < gameState.winterMoonEvents.length) {
            // 显示下一个事件
            showSiteEvent(gameState.winterMoonEvents[gameState.currentSubEventIndex]);
        } else {
            // 冬月奏变序列结束
            gameState.inWinterMoonSequence = false;
            gameState.completedEvents.push("winter-moon-sequence");
            document.getElementById('site-next-event-btn').classList.add('hidden');
            showNoSiteEvent();
        }
    }
}

// 处理人物下一事件
function handleCharacterNextEvent() {
    if (gameState.inCharacterJoinSequence) {
        // 处理人物加入序列
        gameState.currentCharacterJoinIndex++;
        if (gameState.currentCharacterJoinIndex < gameState.characterJoinSequence.length) {
            // 显示下一个角色加入事件
            showCharacterJoinEvent(gameState.currentCharacterJoinIndex);
        } else {
            // 人物加入序列结束
            gameState.inCharacterJoinSequence = false;
            gameState.characterJoinSequence = [];
            gameState.currentCharacterJoinIndex = 0;
            document.getElementById('character-next-event-btn').classList.add('hidden');
            showNoCharacterJoin();
        }
    }
}

// 更新游戏显示
function updateGameDisplay() {
    document.getElementById('admin-power').textContent = gameState.adminPower;
    document.getElementById('influence').textContent = gameState.influence;
    document.getElementById('community-mood').textContent = gameState.communityMood;
    document.getElementById('article-quality').textContent = gameState.articleQuality;
    document.getElementById('active-writers').textContent = gameState.activeWriters;
    document.getElementById('site-funds').textContent = gameState.siteFunds;
    document.getElementById('current-leader').textContent = gameState.currentLeader;
    document.getElementById('decision-slots').textContent = 
        `${gameState.activeDecisions.length}/${gameState.decisionSlots}`;
    
    updateDecisionButtons();
}

// 渲染角色面板
function renderCharacterPanel() {
    const container = document.getElementById('characters-container');
    container.innerHTML = '';
    
    Object.values(gameState.characters).forEach(character => {
        // 不显示未激活的角色
        if (character.active === false) return;
        
        const card = document.createElement('div');
        card.className = 'character-card';
        
        const relationshipPercent = Math.max(0, Math.min(100, character.relationship));
        
        card.innerHTML = `
            <div class="character-info">
                <div class="character-name">${character.name}</div>
                <div class="character-role">${character.role}</div>
                <div class="relationship-bar">
                    <div class="relationship-fill" style="width: ${relationshipPercent}%"></div>
                </div>
            </div>
        `;
        
        container.appendChild(card);
    });
}

// 更新管理员和版主显示
function updateStaffDisplay() {
    const adminNames = document.getElementById('admin-names');
    const moderatorNames = document.getElementById('moderator-names');
    
    adminNames.textContent = gameState.admins.length > 0 ? gameState.admins.join(', ') : '无';
    moderatorNames.textContent = gameState.moderators.length > 0 ? gameState.moderators.join(', ') : '无';
}

// 检查结局条件
function checkEndings() {
    // 结局1: 社群活跃写手数为0，站点无法运行
    if (gameState.activeWriters <= 0) {
        endGame("无活跃写手，站点无法运行", "人都跑光了，我们完蛋了，哈哈。");
        return;
    }
    
    // 结局1.5: 社群情绪过小，站点无法运行
    if (gameState.communityMood <= 7) {
        endGame("社区不满，大家造反了", "搞什么！又来动乱！");
        return;
    }
    
    // 结局2: 文章质量为0，站点沦为"垃圾场"
    if (gameState.articleQuality <= 0) {
        endGame("站点沦为垃圾场", "文章质量降至0，站点内容质量极低，沦为网络垃圾场，失去了存在的意义。");
        return;
    }
    
    // 结局3: 行政力过低，无政府状态
    if (gameState.adminPower <= 0) {
        endGame("无政府状态", "行政力降至0，站点管理完全瘫痪，陷入无政府状态，无法继续运作。");
        return;
    }
    
    // 结局4: 影响力过低，被Wikidot入侵
    if (gameState.influence <= 0) {
        endGame("被Wikidot入侵", "影响力降至0，站点失去独立性，被Wikidot后室中文站完全控制。");
        return;
    }
    
    // 结局5: RBTL支持度高，没有下台
    if (gameState.rbtlStayed && gameState.year >= 2023) {
        endGame("纯粹派的胜利", "在您的支持下，RBTL成功度过了文风战争危机，继续领导后室中文站。纯粹美学成为站点的主导创作方向。（晴雪：喂我花生）");
        return;
    }
    
    // 结局6: 二月动乱成功，白川山上台（在23年3月判定）
    if (gameState.uprisingSuccess && gameState.year === 2023 && gameState.month >= 3) {
        endGame("写手动乱成功", "二月动乱取得了成功，有雪落在白川山成为新任站长，社群建立了更加民主的管理制度。");
        return;
    }
    
    // 结局7: 冬月奏变失败，阿达复辟
    if (gameState.year >= 2025 && 
        gameState.completedEvents.includes("winter-moon-sequence") && 
        gameState.characters.Adaihappyjan.relationship > 70 && !gameState.adaiLeft) {
        endGame("冬月奏变失败 - 阿达复辟", "冬月奏变失败，Adaihappyjan凭借其高支持度重新掌握权力，恢复了原有的管理模式。冬月奏变成为了和二月动乱一样的事情，但是大家都知道总有一天人们能成功。");
        return;
    }
    
    // 结局8和9: 冬月奏变胜利（在25年1月判定）
    if (gameState.year >= 2025 && 
        gameState.completedEvents.includes("winter-moon-sequence")) {
        
        // 如果Aread支持度小于50%，则支持度最高者上台
        if (gameState.characters.Aread.relationship < 50) {
            // 找出支持度最高的角色
            let highestSupport = 0;
            let highestLeader = "Aread";
            Object.entries(gameState.characters).forEach(([name, char]) => {
                if (char.relationship > highestSupport && char.active !== false) {
                    highestSupport = char.relationship;
                    highestLeader = name;
                }
            });
            
            endGame("冬月奏变胜利 - " + highestLeader + "执政", "冬月奏变后，由于Aread支持度不足，" + highestLeader + "成为新任站长，带领社群继续前行。");
        } else {
            endGame("冬月奏变胜利 - Aread继续执政", "冬月奏变后，Aread继续担任站长，带领社群进入新的发展阶段。");
        }
        return;
    }
    
    // 检查是否到达游戏终点（2025年1月后）
    if (gameState.year > 2025 || (gameState.year === 2025 && gameState.month > 1)) {
        endGame("游戏结束", "您已体验完后室中文站的完整历史。感谢您的参与！");
    }
}

// 结束游戏
function endGame(title, description) {
    gameState.isGameOver = true;
    
    const siteEventContainer = document.getElementById('site-event-container');
    const characterJoinContainer = document.getElementById('character-join-container');
    const contestContainer = document.getElementById('site-contest-container');
    const gameOverContainer = document.getElementById('game-over-container');
    
    siteEventContainer.classList.add('hidden');
    characterJoinContainer.classList.add('hidden');
    contestContainer.classList.add('hidden');
    gameOverContainer.classList.remove('hidden');
    
    document.getElementById('game-over-title').textContent = title;
    document.getElementById('game-over-description').textContent = description;
}

// 重新开始游戏 - 修复版本
function restartGame() {
    // 停止所有定时器
    clearInterval(quoteInterval);
    
    // 重新加载页面以完全重置游戏状态
    window.location.reload();
}
</script>
</body>
</html><!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>后室模拟器</title>
<style>
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
}

/* 开始界面样式 */
#start-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #E0DAA6;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    background-image:
        radial-gradient(circle at 10% 20%, rgba(147, 122, 45, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(147, 122, 45, 0.1) 0%, transparent 20%);
}

.start-container {
    width: 90%;
    max-width: 800px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
    padding: 40px;
    text-align: center;
    border: 2px solid #937A2D;
    position: relative;
    overflow: hidden;
}

.start-container::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, #937A2D, #e0daa6, #937A2D);
}

.game-title {
    font-size: 3.5rem;
    color: #937A2D;
    margin-bottom: 40px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    letter-spacing: 2px;
    font-weight: bold;
}

.quote-container {
    min-height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin: 40px 0;
    padding: 30px;
    background: rgba(240, 233, 200, 0.7);
    border-radius: 8px;
    border: 1px solid #937A2D;
    position: relative;
}

.quote-text {
    font-size: 1.4rem;
    line-height: 1.6;
    color: #333;
    margin-bottom: 20px;
    font-style: italic;
    text-align: center;
}

.quote-author {
    font-size: 1.1rem;
    color: #937A2D;
    font-weight: bold;
    align-self: flex-end;
    margin-right: 20px;
}

.start-btn {
    background: linear-gradient(135deg, #937A2D 0%, #7a6424 100%);
    color: white;
    border: none;
    padding: 16px 40px;
    font-size: 1.3rem;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(147, 122, 45, 0.4);
    margin-top: 20px;
    font-weight: bold;
    letter-spacing: 1px;
}

.start-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(147, 122, 45, 0.6);
    background: linear-gradient(135deg, #7a6424 0%, #63501d 100%);
}

.start-btn:active {
    transform: translateY(1px);
}

.footer {
    margin-top: 30px;
    font-size: 0.9rem;
    color: #666;
}

@media (max-width: 768px) {
    .game-title {
        font-size: 2.5rem;
    }
    .quote-text {
        font-size: 1.2rem;
    }
    .start-container {
        padding: 30px 20px;
    }
}

/* 原游戏样式保持不变 */
body {
    background: #E0DAA6;
    color: #000000;
    line-height: 1.6;
    min-height: 100vh;
    padding: 10px;
    background-image:
        radial-gradient(circle at 10% 20%, rgba(147, 122, 45, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(147, 122, 45, 0.1) 0%, transparent 20%);
}

.game-container {
    max-width: 1200px;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    border: 1px solid #937A2D;
    display: grid;
    grid-template-columns: 250px 1fr 300px;
    grid-template-rows: auto 1fr auto;
    grid-template-areas:
        "header header header"
        "sidebar main decisions"
        "footer footer footer";
    min-height: 90vh;
}

.header {
    grid-area: header;
    background: linear-gradient(90deg, #E0DAA6 0%, #d4ca96 100%);
    padding: 15px 20px;
    border-bottom: 2px solid #937A2D;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header h1 {
    font-size: 1.5rem;
    color: #000000;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.time-controls {
    display: flex;
    gap: 10px;
    align-items: center;
}

.time-btn {
    background: #937A2D;
    color: #ffffff;
    border: 1px solid #7a6424;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}

.time-btn:hover:not(:disabled) {
    background: #7a6424;
}

.time-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.current-time {
    font-size: 1.2rem;
    font-weight: bold;
    color: #000000;
    margin-right: 10px;
}

.sidebar {
    grid-area: sidebar;
    background: #f0e9c8;
    padding: 15px;
    border-right: 1px solid #937A2D;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.character-panel {
    background: #f5f0d9;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    max-height: 300px;
    overflow-y: auto;
}

.character-card {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    padding: 8px;
    background: #f0e9c8;
    border-radius: 4px;
    border-left: 3px solid #937A2D;
}

.character-info {
    flex: 1;
}

.character-name {
    font-weight: bold;
    color: #000000;
    font-size: 0.9rem;
}

.character-role {
    font-size: 0.7rem;
    color: #5a5a5a;
}

.relationship-bar {
    height: 6px;
    background: #e0daa6;
    border-radius: 3px;
    margin-top: 5px;
    overflow: hidden;
}

.relationship-fill {
    height: 100%;
    background: #937A2D;
    border-radius: 3px;
}

.main-content {
    grid-area: main;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    overflow-y: auto;
}

.status-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
}

.status-card {
    background: #f5f0d9;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    text-align: center;
}

.status-value {
    font-size: 1.8rem;
    font-weight: bold;
    color: #937A2D;
    margin: 5px 0;
}

.status-label {
    font-size: 0.8rem;
    color: #5a5a5a;
}

.buff-container {
    background: #f5f0d9;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    margin-top: 10px;
}

.buff-title {
    color: #937A2D;
    font-size: 1.1rem;
    margin-bottom: 10px;
    font-weight: bold;
}

.buff-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.buff-item {
    background: rgba(147, 122, 45, 0.1);
    padding: 8px 12px;
    border-radius: 4px;
    border: 1px solid #937A2D;
    font-size: 0.9rem;
    color: #333;
}

/* 站内事件容器 */
.site-event-container {
    background: #f5f0d9;
    padding: 20px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    flex: 1;
    display: flex;
    flex-direction: column;
}

/* 人物加入事件容器 */
.character-join-container {
    background: #f5f0d9;
    padding: 20px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    display: flex;
    flex-direction: column;
    max-height: 300px;
    overflow-y: auto;
}

/* 站内竞赛容器 */
.site-contest-container {
    background: #f5f0d9;
    padding: 20px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    display: flex;
    flex-direction: column;
    max-height: 300px;
    overflow-y: auto;
}

.event-title {
    color: #937A2D;
    font-size: 1.3rem;
    margin-bottom: 15px;
    border-left: 4px solid #937A2D;
    padding-left: 10px;
}

.event-description {
    background: rgba(147, 122, 45, 0.1);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    line-height: 1.7;
    border: 1px solid #937A2D;
    flex: 1;
}

.choices-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin-top: 20px;
}

.choice-btn {
    background: linear-gradient(135deg, #937A2D 0%, #7a6424 100%);
    color: #ffffff;
    border: none;
    padding: 15px;
    border-radius: 6px;
    text-align: left;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
    border: 1px solid #7a6424;
    position: relative;
    overflow: hidden;
}

.choice-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, #7a6424 0%, #63501d 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.choice-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.choice-btn.selected {
    background: linear-gradient(135deg, #7a6424 0%, #63501d 100%);
    border-color: #E0DAA6;
}

.choice-btn::after {
    content: "▶";
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #E0DAA6;
}

.confirm-btn {
    background: #937A2D;
    color: #ffffff;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 15px;
    align-self: flex-end;
}

.confirm-btn:hover:not(:disabled) {
    background: #7a6424;
}

.confirm-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.next-event-btn {
    background: #937A2D;
    color: #ffffff;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 15px;
    align-self: flex-end;
}

.next-event-btn:hover:not(:disabled) {
    background: #7a6424;
}

.next-event-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.decisions-panel {
    grid-area: decisions;
    background: #f0e9c8;
    padding: 15px;
    border-left: 1px solid #937A2D;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.panel-title {
    color: #937A2D;
    font-size: 1.2rem;
    margin-bottom: 10px;
    border-bottom: 1px solid #937A2D;
    padding-bottom: 5px;
}

.decision-category {
    background: #f5f0d9;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #937A2D;
}

.decision-btn {
    background: #937A2D;
    color: #ffffff;
    border: 1px solid #7a6424;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    width: 100%;
    text-align: left;
    margin-bottom: 8px;
    transition: all 0.2s ease;
}

.decision-btn:hover:not(:disabled) {
    background: #7a6424;
}

.decision-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.active-decision {
    background: rgba(147, 122, 45, 0.2);
    border-color: #937A2D;
}

.progress-bar {
    height: 6px;
    background: #e0daa6;
    border-radius: 3px;
    margin-top: 5px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: #937A2D;
    border-radius: 3px;
    width: 0%;
    transition: width 0.3s ease;
}

.effects-display {
    background: #f5f0d9;
    padding: 10px;
    border-radius: 6px;
    margin-top: 15px;
    border: 1px solid #937A2D;
    font-size: 0.9rem;
}

.effect-item {
    display: flex;
    align-items: center;
    margin: 5px 0;
}

.effect-positive {
    color: #06d6a0;
}

.effect-negative {
    color: #ef476f;
}

.hidden {
    display: none !important;
}

.game-over {
    text-align: center;
    padding: 30px;
}

.game-over h2 {
    color: #937A2D;
    margin-bottom: 20px;
}

.restart-btn {
    background: linear-gradient(135deg, #ef476f 0%, #ff6b6b 100%);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 25px;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 20px;
    transition: all 0.3s ease;
}

.restart-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(239, 71, 111, 0.4);
}

.footer {
    grid-area: footer;
    background: #f0e9c8;
    padding: 10px 20px;
    border-top: 1px solid #937A2D;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
    color: #5a5a5a;
}

.current-leader {
    font-weight: bold;
    color: #937A2D;
}

/* 国策系统样式 */
.national-policy-category {
    background: #f5f0d9;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #937A2D;
    margin-bottom: 15px;
}

.policy-item {
    background: #f0e9c8;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 8px;
    border-left: 3px solid #937A2D;
    display: flex;
    justify-content: between;
    align-items: center;
}

.policy-info {
    flex: 1;
}

.policy-name {
    font-weight: bold;
    color: #000000;
    font-size: 0.9rem;
}

.policy-description {
    font-size: 0.7rem;
    color: #5a5a5a;
    margin-top: 2px;
}

.policy-requirements {
    font-size: 0.7rem;
    color: #937A2D;
    font-style: italic;
    margin-top: 2px;
}

.policy-btn {
    background: #937A2D;
    color: #ffffff;
    border: 1px solid #7a6424;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
    white-space: nowrap;
}

.policy-btn:hover:not(:disabled) {
    background: #7a6424;
}

.policy-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.policy-btn.executing {
    background: #7a6424;
    cursor: not-allowed;
}

.policy-btn.completed {
    background: #06d6a0;
    cursor: default;
}

/* 响应式设计 */
@media (max-width: 900px) {
    .game-container {
        grid-template-columns: 1fr;
        grid-template-areas:
            "header"
            "main"
            "decisions"
            "sidebar"
            "footer";
    }
    .sidebar, .decisions-panel {
        border: none;
        border-top: 1px solid #937A2D;
    }
}
</style>
</head>
<body>
<!-- 开始界面 -->
<div id="start-screen">
    <div class="start-container">
        <h1 class="game-title">后室模拟器</h1>
        <div class="quote-container">
            <div class="quote-text" id="quote-text">你无需告诉我Fandom后室中文的未来如何，我会亲自去迎接她的未来。</div>
            <div class="quote-author" id="quote-author">----- APT</div>
        </div>
        <button class="start-btn" id="start-btn">开始游戏</button>
        <div class="footer">后室模拟器 4.2</div>
    </div>
</div>

<!-- 原游戏界面 -->
<div class="game-container hidden" id="game-container">
    <div class="header">
        <h1>后室模拟器</h1>
        <div class="time-controls">
            <div class="current-time" id="current-time">2022年1月</div>
            <button class="time-btn" id="next-month">下一个月</button>
        </div>
    </div>
    
    <div class="sidebar">
        <div class="character-panel">
            <h3>关键人物</h3>
            <div id="characters-container">
                <!-- 角色卡片将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>
    
    <div class="main-content">
        <div class="status-cards">
            <div class="status-card">
                <div class="status-label">行政力</div>
                <div class="status-value" id="admin-power">100</div>
            </div>
            <div class="status-card">
                <div class="status-label">影响力</div>
                <div class="status-value" id="influence">50</div>
            </div>
            <div class="status-card">
                <div class="status-label">社群情绪</div>
                <div class="status-value" id="community-mood">70</div>
            </div>
            <div class="status-card">
                <div class="status-label">文章质量</div>
                <div class="status-value" id="article-quality">60</div>
            </div>
            <div class="status-card">
                <div class="status-label">活跃写手</div>
                <div class="status-value" id="active-writers">30</div>
            </div>
            <div class="status-card">
                <div class="status-label">站点资金</div>
                <div class="status-value" id="site-funds">1000</div>
            </div>
        </div>
        
        <!-- Buff显示区域 -->
        <div class="buff-container">
            <div class="buff-title">当前生效Buff</div>
            <div class="buff-list" id="buff-list">
                <!-- Buff将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <!-- 站内事件容器 -->
        <div class="site-event-container" id="site-event-container">
            <h2 class="event-title" id="site-event-title">建站初期</h2>
            <div class="event-description" id="site-event-description">
                2022年1月，你作为普通写手加入了刚刚成立的Fandom后室中文站。Cycas作为首任站长，与karma、RBTL等人一起建立了站点的基本框架。此时，站点刚刚起步，大家充满热情。
            </div>
            <div class="choices-container" id="site-choices-container">
                <button class="choice-btn" data-choice="0">支持Cycas的稳健发展路线</button>
                <button class="choice-btn" data-choice="1">建议更激进的扩张策略</button>
                <button class="choice-btn" data-choice="2">专注创作，少参与管理事务</button>
            </div>
            <button class="confirm-btn hidden" id="site-confirm-btn">确定选择</button>
            <button class="next-event-btn hidden" id="site-next-event-btn">下一事件</button>
            <div class="effects-display hidden" id="site-effects-display">
                <!-- 站内事件效果显示区域 -->
            </div>
        </div>
        
        <!-- 人物加入事件容器 -->
        <div class="character-join-container" id="character-join-container">
            <h2 class="event-title">人物加入</h2>
            <div class="event-description" id="character-join-description">
                本月没有重要人物加入。
            </div>
            <div class="choices-container" id="character-choices-container">
                <!-- 人物加入选择按钮将通过JavaScript动态生成 -->
            </div>
            <button class="confirm-btn hidden" id="character-confirm-btn">确定选择</button>
            <button class="next-event-btn hidden" id="character-next-event-btn">下一人物</button>
            <div class="effects-display hidden" id="character-effects-display">
                <!-- 人物加入事件效果显示区域 -->
            </div>
        </div>
        
        <!-- 站内竞赛容器 -->
        <div class="site-contest-container" id="site-contest-container">
            <h2 class="event-title" id="contest-event-title">竞赛</h2>
            <div class="event-description" id="contest-event-description">
                本月没有竞赛事件。
            </div>
            <div class="choices-container" id="contest-choices-container">
                <!-- 竞赛选择按钮将通过JavaScript动态生成 -->
            </div>
            <button class="confirm-btn hidden" id="contest-confirm-btn">确定选择</button>
            <button class="next-event-btn hidden" id="contest-next-event-btn">下一竞赛</button>
            <div class="effects-display hidden" id="contest-effects-display">
                <!-- 竞赛事件效果显示区域 -->
            </div>
        </div>
        
        <div id="game-over-container" class="game-over hidden">
            <h2 id="game-over-title">游戏结束</h2>
            <p id="game-over-description"></p>
            <button class="restart-btn" id="restart-btn">重新开始游戏</button>
        </div>
    </div>
    
    <div class="decisions-panel">
        <!-- 国策系统 -->
        <div class="decision-category">
            <h3 class="panel-title">国策系统</h3>
            <div style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">
                最多同时进行5个国策，每个消耗10行政点，耗时1个月
            </div>
            <div class="national-policy-category">
                <h4 style="color: #937A2D; margin-bottom: 8px;">通用国策</h4>
                <div id="general-policies">
                    <!-- 通用国策将通过JavaScript动态生成 -->
                </div>
            </div>
            <div class="national-policy-category">
                <h4 style="color: #937A2D; margin-bottom: 8px;">宣传线国策</h4>
                <div id="propaganda-policies">
                    <!-- 宣传线国策将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>
        
        <div class="decision-category">
            <h3 class="panel-title">管理决议</h3>
            <button class="decision-btn" id="decision-quality" data-cost="20" data-time="3">提升文章质量标准</button>
            <button class="decision-btn" id="decision-recruit" data-cost="15" data-time="2">招募新写手</button>
            <button class="decision-btn" id="decision-promote" data-cost="25" data-time="4">宣传推广活动</button>
            <button class="decision-btn" id="decision-reform" data-cost="30" data-time="5">管理体制改革</button>
        </div>
        
        <div class="decision-category">
            <h3 class="panel-title">人事决议</h3>
            <button class="decision-btn" id="decision-appoint-admin" data-cost="15">任命管理员</button>
            <button class="decision-btn" id="decision-dismiss-admin" data-cost="10">撤销管理员</button>
            <button class="decision-btn" id="decision-appoint-moderator" data-cost="10">任命版主</button>
            <button class="decision-btn" id="decision-dismiss-moderator" data-cost="5">撤销版主</button>
            <div id="admin-list">
                <div>管理员: <span id="admin-names">无</span></div>
            </div>
            <div id="moderator-list">
                <div>版主: <span id="moderator-names">无</span></div>
            </div>
        </div>
        
        <div class="decision-category">
            <h3 class="panel-title">关系决议</h3>
            <button class="decision-btn" id="decision-improve-relation" data-cost="10">提升人物好感度</button>
            <button class="decision-btn" id="decision-decrease-relation" data-cost="5">降低人物好感度</button>
        </div>
        
        <div class="decision-category">
            <h3 class="panel-title">进行中的决议</h3>
            <div id="active-decisions">
                <!-- 进行中的决议将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <div class="decision-category">
            <h3 class="panel-title">进行中的国策</h3>
            <div id="active-policies">
                <!-- 进行中的国策将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div>当前站长: <span class="current-leader" id="current-leader">Cycas</span></div>
        <div>决议槽: <span id="decision-slots">0/2</span></div>
        <div>国策槽: <span id="policy-slots">0/5</span></div>
        <div>游戏版本: 4.2</div>
    </div>
</div>

<script>
// 开始界面功能

// 名言数组
const quotes = [
    { text: "代码的过多使用不能作为文章是否优秀的标准，文章的总体风格不能作为文章是否优秀的的标准。", author: "山后蔓" },
    { text: "你无需告诉我Fandom后室中文的未来如何，我会亲自去迎接她的未来。", author: "APT" },
    { text: "写手交流群的初衷，是为了提供一个互相学习、交流与提升的平台。", author: "杨队" },
    { text: "写手们应注重于自身的独特才是。", author: "面包" },
    { text: "所有人都只在乎版式。", author: "面包" },
    { text: "何必在乎他对Fandom的看法，他愿意去哪里是他的选择。", author: "面包" },
    { text: "所有人都只在乎字数。", author: "面包" },
    { text: "不要犹豫，也别让才华沉寂。", author: "杨队" },
    { text: "你群怎么没有接入国家电网，这么一来就可以彻底解除能源危机了。", author: "海旦" },
    { text: "草。", author: "RBTL" },
    { text: "这个人有五个红票是怎么写出蝴蝶效应这么好的文的啊。", author: "Cycas" },
    { text: "别写感叹号亚层好嘛哥哥。", author: "Rezrp813" },
    { text: "未完，丢沙。", author: "Daoqd" },
    { text: "妈的，我管理员权限没了。", author: "XRH" },
    { text: "你们在伤害我。", author: "Doog" },
    { text: "你电脑没装QQ是吧。", author: "Doog" },
    { text: "现在艺术全靠AI模型了。", author: "小濮" },
    { text: "创作是一种自慰，是对于自己子意识体的强奸。", author: "海旦的不知名朋友" },
    { text: "我好失望。你连最基础的标点错误都没有改，你到底是为什么回来?", author: "面包" },
    { text: "COLA！", author: "杨队" },
    { text: "当时诛灭可是我鸡腿...击退...集推...你妈不推了。", author: "杨队" },
    { text: "质疑月冥，理解月冥，成为月冥。", author: "盒子" },
    { text: "这真是，无与伦比的奇迹。", author: "杨队" },
    { text: "Why was this chat talking about cock", author: "密歇根" },
    { text: "河水的速度也越来越接近平常。", author: "极风" },
    { text: "在User:To Mildew./CC执行操作\"edit\"时触发了过滤器。采取的行动：区段封禁、封禁；过滤器描述：内容含有敏感词。", author: "滥用过滤器" },
    { text: "我创死你！", author: "Lunaticninety" },
    { text: "创作并不是无中生有，而是来自作家的日常中，作家将日常提炼了出来。", author: "四方之中" },
    { text: "我来用弗洛伊德分析一下你现在的情况------你有恋母情结。", author: "Airy" },
    { text: "老写手就可以不顾脸面卖淫了？", author: "南岸" }
];

// 打乱数组顺序（Fisher-Yates洗牌算法）
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// 初始化开始界面
let shuffledQuotes = shuffleArray(quotes);
let currentQuoteIndex = 0;
let quoteInterval;

// 更新名言显示 - 修复版本
function updateQuote() {
    const quoteText = document.getElementById('quote-text');
    const quoteAuthor = document.getElementById('quote-author');
    
    // 直接更新文本内容
    quoteText.textContent = shuffledQuotes[currentQuoteIndex].text;
    quoteAuthor.textContent = "----- " + shuffledQuotes[currentQuoteIndex].author;
    
    // 更新索引，确保不会越界
    currentQuoteIndex = (currentQuoteIndex + 1) % shuffledQuotes.length;
    
    // 如果回到开头，重新洗牌
    if (currentQuoteIndex === 0) {
        shuffledQuotes = shuffleArray(quotes);
    }
}

// 开始游戏
document.getElementById('start-btn').addEventListener('click', function() {
    clearInterval(quoteInterval);
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('game-container').classList.remove('hidden');
    initGame();
});

// 初始化开始界面
// 先显示第一条名言
updateQuote();
// 然后开始定时器
quoteInterval = setInterval(updateQuote, 5000);

// 游戏状态
const gameState = {
    currentEventIndex: 0,
    currentSubEventIndex: 0,
    year: 2022,
    month: 1,
    adminPower: 100,
    influence: 100,
    communityMood: 70,
    articleQuality: 60,
    activeWriters: 30,
    siteFunds: 1000,
    currentLeader: "Cycas",
    characters: {
        "Cycas": { name: "Cycas", role: "现任站长", relationship: 60, faction: "pragmatic", active: true, gender: "male" },
        "XRHX": { name: "XRHX", role: "写手", relationship: 50, faction: "diverse", adminBonus: { communityMood: 10 }, moderatorBonus: { communityMood: 5 }, active: false, gender: "male" },
        "RBTL": { name: "RBTL", role: "写手", relationship: 40, faction: "threshold", adminBonus: { articleQuality: 10 }, moderatorBonus: { articleQuality: 5 }, active: false, gender: "male" },
        "karma": { name: "karma", role: "写手", relationship: 45, faction: "threshold", adminBonus: { adminPower: 5 }, moderatorBonus: { adminPower: 4 }, active: false, gender: "male" },
        // 晴雪与雨改为22年4月加入
        "晴雪与雨": { name: "晴雪与雨", role: "写手", relationship: 55, faction: "diverse", adminBonus: { communityMood: 10 }, moderatorBonus: { communityMood: 5 }, active: false, gender: "female" },
        // Adaihappyjan改为22年3月加入
        "Adaihappyjan": { name: "Adaihappyjan", role: "写手", relationship: 30, faction: "pragmatic", adminBonus: { adminPower: 10 }, moderatorBonus: { adminPower: 5 }, active: false, gender: "male" },
        // Lunaticninety改为22年3月加入
        "Lunaticninety": { name: "Lunaticninety", role: "写手", relationship: 35, faction: "pragmatic", adminBonus: { communityMood: 10 }, moderatorBonus: { communityMood: 5 }, active: false, gender: "female" },
        "MaxwellYang": { name: "MaxwellYang", role: "写手", relationship: 50, faction: "pragmatic", adminBonus: { influence: 10 }, moderatorBonus: { influence: 5 }, active: false, gender: "male" },
        "Aread": { name: "Aread", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { adminPower: 5 }, moderatorBonus: { adminPower: 3 }, gender: "male" },
        "APT": { name: "APT", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { activeWriters: 5 }, moderatorBonus: { activeWriters: 3 }, gender: "male" },
        "池续": { name: "池续", role: "写手", relationship: 40, faction: "diverse", active: false, adminBonus: { articleQuality: 10 }, moderatorBonus: { articleQuality: 5 }, gender: "male" },
        "有雪落在白川山": { name: "有雪落在白川山", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { communityMood: 5 }, moderatorBonus: { communityMood: 3 }, gender: "female" },
        "南岸青栀": { name: "南岸青栀", role: "写手", relationship: 35, faction: "diverse", active: false, adminBonus: { influence: 5 }, moderatorBonus: { influence: 3 }, gender: "female" },
        "零域": { name: "零域", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { pragmaticSupport: 5 }, moderatorBonus: { pragmaticSupport: 3 }, gender: "male" },
        "Doog": { name: "Doog", role: "写手", relationship: 25, faction: "threshold", active: false, adminBonus: { thresholdSupport: 5 }, moderatorBonus: { thresholdSupport: 3 }, gender: "male" },
        "FWMango": { name: "FWMango", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { adminPower: 5 }, moderatorBonus: { adminPower: 3 }, gender: "male" },
        // 原有新增人物
        "Ritisech": { name: "Ritisech", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { communityMood: 5 }, moderatorBonus: { communityMood: 3 }, gender: "male" },
        "小濮": { name: "小濮", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { communityMood: 5 }, moderatorBonus: { communityMood: 3 }, gender: "male" },
        "列文": { name: "列文", role: "写手", relationship: 30, faction: "threshold", active: false, adminBonus: { articleQuality: 5 }, moderatorBonus: { articleQuality: 3 }, gender: "female" },
        "星极": { name: "星极", role: "写手", relationship: 40, faction: "diverse", active: false, adminBonus: { influence: 10 }, moderatorBonus: { influence: 5 }, gender: "female" },
        "子午线": { name: "子午线", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { communityMood: 10 }, moderatorBonus: { communityMood: 5 }, gender: "female" },
        "芦苇": { name: "芦苇", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { adminPower: 10 }, moderatorBonus: { adminPower: 5 }, gender: "male" },
        // === 新增人物 - 文章质量相关 ===
        "Ashy": { name: "Ashy", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { articleQuality: 8 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "纳吉卡": { name: "纳吉卡", role: "写手", relationship: 35, faction: "diverse", active: false, adminBonus: { articleQuality: 10 }, moderatorBonus: { articleQuality: 5 }, gender: "male" },
        "小落": { name: "小落", role: "写手", relationship: 40, faction: "threshold", active: false, adminBonus: { articleQuality: 7 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        "饮鸩": { name: "饮鸩", role: "写手", relationship: 30, faction: "pragmatic", active: false, adminBonus: { articleQuality: 6 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        "柠檬": { name: "柠檬", role: "写手", relationship: 35, faction: "diverse", active: false, adminBonus: { articleQuality: 8 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "苏狐": { name: "苏狐", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { articleQuality: 9 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "ZPR": { name: "ZPR", role: "写手", relationship: 30, faction: "threshold", active: false, adminBonus: { articleQuality: 7 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        "Lazy": { name: "Lazy", role: "写手", relationship: 35, faction: "diverse", active: false, adminBonus: { articleQuality: 8 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "欧阳": { name: "欧阳", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { articleQuality: 10 }, moderatorBonus: { articleQuality: 5 }, gender: "male" },
        "Bingo": { name: "Bingo", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { articleQuality: 6 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        "月冥": { name: "月冥", role: "写手", relationship: 35, faction: "threshold", active: false, adminBonus: { articleQuality: 9 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "山后蔓": { name: "山后蔓", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { articleQuality: 8 }, moderatorBonus: { articleQuality: 4 }, gender: "male" },
        "繁星": { name: "繁星", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { articleQuality: 7 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        "ASDS": { name: "ASDS", role: "写手", relationship: 35, faction: "pragmatic", active: false, adminBonus: { articleQuality: 6 }, moderatorBonus: { articleQuality: 3 }, gender: "male" },
        // === 新增人物 - 社区情绪相关 ===
        "海旦": { name: "海旦", role: "写手", relationship: 40, faction: "diverse", active: false, adminBonus: { communityMood: 12 }, moderatorBonus: { communityMood: 6 }, gender: "male" },
        "XXjun": { name: "XXjun", role: "写手", relationship: 35, faction: "pragmatic", active: false, adminBonus: { communityMood: 8 }, moderatorBonus: { communityMood: 4 }, gender: "male" },
        "水桶": { name: "水桶", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { communityMood: 10 }, moderatorBonus: { communityMood: 5 }, gender: "male" },
        "Rua": { name: "Rua", role: "写手", relationship: 40, faction: "threshold", active: false, adminBonus: { communityMood: 9 }, moderatorBonus: { communityMood: 4 }, gender: "male" },
        "时雨": { name: "时雨", role: "写手", relationship: 35, faction: "pragmatic", active: false, adminBonus: { communityMood: 7 }, moderatorBonus: { communityMood: 3 }, gender: "male" },
        "末年安夏": { name: "末年安夏", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { communityMood: 8 }, moderatorBonus: { communityMood: 4 }, gender: "male" },
        "Xxcby": { name: "Xxcby", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { communityMood: 6 }, moderatorBonus: { communityMood: 3 }, gender: "male" },
        "York": { name: "York", role: "写手", relationship: 35, faction: "threshold", active: false, adminBonus: { communityMood: 9 }, moderatorBonus: { communityMood: 4 }, gender: "male" },
        "8nxs": { name: "8nxs", role: "写手", relationship: 30, faction: "diverse", active: false, adminBonus: { communityMood: 7 }, moderatorBonus: { communityMood: 3 }, gender: "male" },
        // === 新增人物 - 行政点相关 ===
        "艺曦": { name: "艺曦", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { adminPower: 15 }, moderatorBonus: { adminPower: 7 }, gender: "male" },
        "Stapel": { name: "Stapel", role: "写手", relationship: 35, faction: "diverse", active: false, adminBonus: { adminPower: 12 }, moderatorBonus: { adminPower: 6 }, gender: "male" },
        "神经": { name: "神经", role: "写手", relationship: 30, faction: "threshold", active: false, adminBonus: { adminPower: 10 }, moderatorBonus: { adminPower: 5 }, gender: "male" },
        "铁桶": { name: "铁桶", role: "写手", relationship: 40, faction: "pragmatic", active: false, adminBonus: { adminPower: 8 }, moderatorBonus: { adminPower: 4 }, gender: "male" }
    },
    completedEvents: [],
    isGameOver: false,
    activeDecisions: [],
    decisionSlots: 2,
    // 国策系统
    nationalPolicies: {
        completed: [],
        active: [],
        maxActivePolicies: 5
    },
    // Buff系统
    activeBuffs: {},
    // 特殊状态标记
    rbtlStayed: false,
    uprisingSuccess: false,
    whiteMountainBanned: false,
    chixuPassed: false,
    whiteMountainRehabilitated: false,
    adaiLeft: false,
    // 冬月奏变相关状态
    winterMoonEvents: [],
    inWinterMoonSequence: false,
    // 选择确认相关状态
    selectedChoice: null,
    choiceConfirmed: false,
    // 管理员和版主
    admins: [],
    moderators: [],
    // 人物加入序列
    characterJoinSequence: [],
    inCharacterJoinSequence: false,
    currentCharacterJoinIndex: 0,
    // 竞赛事件相关状态
    contestEvents: [],
    inContestSequence: false,
    currentContestIndex: 0,
    // 新状态：当前显示的是站内事件还是人物加入事件
    currentEventType: "site" // 可以是 "site" 或 "character"
};

// 国策数据
const nationalPolicies = {
    // 通用国策
    "general-1": {
        id: "general-1",
        name: "建立基础制度",
        description: "建立站点基本管理制度",
        category: "general",
        cost: 10,
        time: 1,
        effects: { adminPower: 5 },
        requirements: []
    },
    "general-2": {
        id: "general-2",
        name: "组建宣传组",
        description: "建立专门的宣传团队",
        category: "general",
        cost: 10,
        time: 1,
        effects: { influence: 20 },
        requirements: ["general-1"],
        unlocks: ["decision-recruit", "decision-promote"]
    },
    "general-3": {
        id: "general-3",
        name: "红黄票制度落实",
        description: "建立文章评价体系",
        category: "general",
        cost: 10,
        time: 1,
        effects: { articleQuality: 10 },
        requirements: ["general-1"],
        unlocks: ["decision-quality"]
    },
    "general-4": {
        id: "general-4",
        name: "建立站规",
        description: "制定详细的站点规则",
        category: "general",
        cost: 10,
        time: 1,
        effects: { activeWriters: 10 },
        requirements: ["general-1"]
    },
    "general-5": {
        id: "general-5",
        name: "举办竞赛",
        description: "组织创作竞赛活动",
        category: "general",
        cost: 10,
        time: 1,
        effects: { influence: 15 },
        requirements: ["general-2"],
        unlocks: ["decision-article-contest", "decision-creative-contest", "decision-translation-contest"]
    },
    // 宣传线国策
    "propaganda-1": {
        id: "propaganda-1",
        name: "宣传组改革",
        description: "优化宣传组工作流程",
        category: "propaganda",
        cost: 10,
        time: 1,
        effects: { influence: 10 },
        requirements: ["general-2"]
    },
    "propaganda-2": {
        id: "propaganda-2",
        name: "文章介绍",
        description: "推广优秀文章作品",
        category: "propaganda",
        cost: 10,
        time: 1,
        effects: { influence: 10, activeWriters: 10 },
        requirements: ["propaganda-1"]
    },
    "propaganda-3": {
        id: "propaganda-3",
        name: "联动其他up主",
        description: "与其他创作者合作推广",
        category: "propaganda",
        cost: 10,
        time: 1,
        effects: { influence: 20 },
        requirements: ["propaganda-2"],
        buff: { id: "influence-wide", name: "影响力广泛", effect: "activeWriters", value: 5, duration: -1 }
    },
    "propaganda-4": {
        id: "propaganda-4",
        name: "光明的未来",
        description: "展望站点发展前景",
        category: "propaganda",
        cost: 10,
        time: 1,
        effects: {},
        requirements: ["propaganda-3"],
        buff: { id: "bright-future", name: "前景光明", effect: "influence", value: 5, duration: -1 }
    }
};

// 决议数据（已删除竞赛决议）
const decisions = {
    "decision-quality": {
        name: "提升文章质量标准",
        description: "制定更严格的文章审核标准，提高整体内容质量",
        cost: 20,
        time: 3,
        effects: {
            articleQuality: 15,
            communityMood: -10,
            activeWriters: -5,
            influence: 10
        },
        requiresPolicy: "general-3"
    },
    "decision-recruit": {
        name: "招募新写手",
        description: "通过宣传活动吸引更多创作者加入",
        cost: 15,
        time: 2,
        effects: {
            activeWriters: 10,
            influence: 50,
            articleQuality: -20,
            adminPower: -10
        },
        requiresPolicy: "general-2"
    },
    "decision-promote": {
        name: "宣传推广活动",
        description: "在B站等平台进行推广，扩大社群影响力",
        cost: 25,
        time: 4,
        effects: {
            activeWriters: 15,
            influence: 70,
            adminPower: -15
        },
        requiresPolicy: "general-2"
    },
    "decision-reform": {
        name: "管理体制改革",
        description: "改革站点管理制度，提高管理效率",
        cost: 30,
        time: 5,
        effects: {
            adminPower: 20,
            communityMood: -15,
            influence: 25
        }
    }
};

// 竞赛事件数据
const contestEvents = [
    {
        id: "first-theme-contest",
        title: "第一届主题竞赛",
        description: "2022年8月，第一届主题竞赛结束。Yoghurt的《子宫》荣获第一，Tsz的《Level 2088》荣获第二，ZPR的《遗忘森林》荣获第三。",
        triggerMonth: 8,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "second-theme-contest",
        title: "第二届主题竞赛",
        description: "2023年1月，第二届主题竞赛结束。PM的《通话》荣获第一，小落的《偶戏》荣获第二，零域的《乡土已逝》荣获第三。",
        triggerMonth: 13,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "first-story-contest",
        title: "第一届故事竞赛",
        description: "2023年3月，第一届故事竞赛结束。XRHX的《冷雨夜》荣获第一，晴雪与雨的《为了替她赴死》荣获第二，Ran的《所及最高处》荣获第三。",
        triggerMonth: 15,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "third-theme-contest",
        title: "第三届主题竞赛",
        description: "2023年8月，第三届主题竞赛结束。这一次竞赛是为了大清洗中新生的ZH层级的Level ZH 0的编号竞争。最终，由XRHX、月冥和时雨共同创作的文章拿下了这一次竞赛的第一名。",
        triggerMonth: 20,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "fourth-theme-contest",
        title: "第四届主题竞赛",
        description: "2024年2月，第四届主题竞赛结束。XRHX的《Level →》荣获第一，Aread的《终焉》荣获第二，MaxwellYang的《Level ZH 993》荣获第三。",
        triggerMonth: 26,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "fifth-theme-contest-result",
        title: "第五届主题竞赛结果",
        description: "2024年8月，第五届主题竞赛结束，盒子的《黑匣》荣幸获得了Object ZH 1的编号。",
        triggerMonth: 32,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    },
    {
        id: "joint-contest",
        title: "联合图文竞赛",
        description: "FBC于2024年8月举办了联合图文竞赛，零域的《罐中海》荣获第一，MaxwellYang的《2001.10.9，18:45》荣获第二，Comlontaa的《往昔再现》荣获第三。",
        triggerMonth: 32,
        choices: [
            {
                text: "让我们恭喜各位写手！",
                effects: {
                    siteFunds: -100,
                    influence: 30,
                    articleQuality: 20
                }
            }
        ]
    }
];

// 游戏事件数据（包含第五次竞赛的成就事件）
const gameEvents = [
    // 建站初期 - Cycas时期
    {
        id: "founding",
        title: "建站初期",
        description: "2022年1月，你作为普通写手加入了刚刚成立的Fandom后室中文站。Cycas作为首任站长，与karma、RBTL等人一起建立了站点的基本框架。此时，站点刚刚起步，大家充满热情。",
        triggerMonth: 1,
        choices: [
            {
                text: "支持Cycas的稳健发展路线",
                effects: {
                    communityMood: 10,
                    "Cycas": 20,
                    adminPower: 10,
                    influence: 5,
                    siteFunds: 50
                }
            },
            {
                text: "建议更激进的扩张策略",
                effects: {
                    activeWriters: 10,
                    "Cycas": -10,
                    "RBTL": 15,
                    adminPower: -5,
                    influence: 10,
                    siteFunds: -20
                }
            },
            {
                text: "专注创作，少参与管理事务",
                effects: {
                    influence: 10,
                    articleQuality: 10,
                    "XRHX": 10,
                    siteFunds: 30
                }
            }
        ],
        afterEvent: function() {
            // 启动人物加入序列
            gameState.characterJoinSequence = [
                { name: "XRHX", description: "XRHX加入了后室中文站，他很快成为了社群中的重要成员，以其独特的创作风格受到关注。" },
                { name: "karma", description: "karma加入了后室中文站，作为建站元老之一，他在社群中有着重要地位。" },
                { name: "RBTL", description: "RBTL加入了后室中文站，他对后室美学有着强烈的坚持，很快在社群中崭露头角。" },
                { name: "海旦", description: "海旦加入了后室中文站，他是一位活跃的社群成员，能够有效提升社区情绪。" }
            ];
            gameState.inCharacterJoinSequence = true;
            gameState.currentCharacterJoinIndex = 0;
            showCharacterJoinEvent(0);
        }
    },
    {
        id: "translation-conflict",
        title: "翻译争议",
        description: "2022年2月，写手Doog因使用机器翻译被RBTL严厉批评，双方发生激烈争吵。RBTL最终封禁了Doog，但处理方式引起了一些成员的不满。",
        triggerMonth: 2,
        choices: [
            {
                text: "不好意思！您的翻译水平不够！请练练再来吧！",
                effects: {
                    articleQuality: 15,
                    "RBTL": 15,
                    communityMood: 15,
                    "Doog": -114514,
                    influence: 5
                }
            },
            {
                text: "你们在伤害Doog",
                effects: {
                    "RBTL": -15,
                    communityMood: -10,
                    "Doog": 10,
                    influence: -10
                }
            },
            {
                text: "提议建立更完善的翻译规范",
                effects: {
                    influence: 20,
                    adminPower: -15,
                    "XRHX": 10,
                    articleQuality: 10
                }
            }
        ]
    },
    {
        id: "cycas-leaves",
        title: "Cycas卸任",
        description: "2022年3月，Cycas因个人原因决定卸任站长职务。RBTL凭借其在社群中的影响力成为新任站长。同时，karma也随Cycas一起离开了管理层。",
        triggerMonth: 3,
        choices: [
            {
                text: "支持RBTL继任站长",
                effects: {
                    "RBTL": 25,
                    "Cycas": -10,
                    communityMood: -5,
                    influence: 5
                }
            },
            {
                text: "建议由其他人担任站长",
                effects: {
                    "RBTL": -15,
                    "XRHX": 15,
                    "Adaihappyjan": 10,
                    communityMood: -10,
                    influence: 10
                }
            },
            {
                text: "挽留karma，希望他留下",
                effects: {
                    influence: 15,
                    "karma": 30,
                    communityMood: 10,
                    "Cycas": 5
                }
            },
            {
                text: "尊重Cycas的决定，保持中立",
                effects: {
                    influence: 10,
                    "Cycas": 10,
                    communityMood: 5
                }
            }
        ],
        afterEvent: function(choiceIndex) {
            gameState.currentLeader = "RBTL";
            // 移除Cycas的角色
            delete gameState.characters.Cycas;
            // 如果选择挽留karma（选项2），则不删除karma
            if (choiceIndex !== 2) {
                delete gameState.characters.karma;
            }
        }
    },
    {
        id: "ai-crisis",
        title: "智械危机",
        description: "2022年12月，管理员神经申请到了滥用过滤器机器人，然而，在该机器人被APK启动后，XRHX、上单、Adaihappyjan等人被滥用过滤器误伤。后来，该过滤器又误伤了铁桶。群聊内多把此事当做笑料。",
        triggerMonth: 12,
        choices: [
            {
                text: "傻逼滥用过滤器",
                effects: {
                    communityMood: 10
                }
            }
        ]
    },
    {
        id: "rbtl-policy",
        title: "RBTL的政策",
        description: "2022年5月，RBTL上任后提出了相关政策，要求所有文章必须符合后室核心美学。这一政策在社群中引发了激烈讨论。",
        triggerMonth: 5,
        choices: [
            {
                text: "支持RBTL的纯粹路线",
                effects: {
                    articleQuality: 15,
                    communityMood: -10,
                    "RBTL": 20,
                    "晴雪与雨": -15,
                    influence: -10
                }
            },
            {
                text: "反对限制，支持创作自由",
                effects: {
                    communityMood: 5,
                    "晴雪与雨": 25,
                    "RBTL": -20,
                    influence: -15
                }
            },
            {
                text: "建议更温和的实施方式",
                effects: {
                    influence: 15,
                    communityMood: 5,
                    adminPower: -10
                }
            }
        ]
    },
    {
        id: "style-war",
        title: "文风战争",
        description: "2022年8月，RBTL与晴雪与雨的冲突彻底爆发。RBTL坚持纯粹路线，而晴雪与雨等人支持多元创作。社群普遍支持晴雪与雨，RBTL面临下台危机。",
        triggerMonth: 8,
        choices: [
            {
                text: "和这群非纯粹派在一起，怎么能搞好后室呢",
                effects: {
                    articleQuality: 10,
                    communityMood: -30,
                    "RBTL": 25,
                    "晴雪与雨": -40,
                    activeWriters: -20,
                    influence: -20
                }
            },
            {
                text: "天无二日，我心中只有晴雪一个太阳",
                effects: {
                    communityMood: -20,
                    "晴雪与雨": 40,
                    "XRHX": 25,
                    "RBTL": -50,
                    activeWriters: -10,
                    influence: -15
                }
            },
            {
                text: "呼吁双方冷静，寻求妥协",
                effects: {
                    influence: 30,
                    communityMood: 10,
                    "XRHX": 30,
                    "RBTL": -20,
                    "晴雪与雨": 15
                }
            }
        ],
        afterEvent: function(choiceIndex) {
            // 如果选择支持RBTL，RBTL留任
            if (choiceIndex === 0) {
                gameState.rbtlStayed = true;
                gameState.currentLeader = "RBTL";
            } else {
                // 否则RBTL下台
                gameState.rbtlStayed = false;
                gameState.currentLeader = "Lunaticninety";
                // 实际权力在Adaihappyjan手中
                gameState.characters.Adaihappyjan.relationship += 20;
                gameState.characters.Lunaticninety.role = "名义站长";
                gameState.characters.Adaihappyjan.role = "实际掌权者";
                // 移除RBTL
                delete gameState.characters.RBTL;
            }
        }
    },
    {
        id: "spring-festival-2023",
        title: "后室春节联欢晚会",
        description: "2023年1月，社群举办了第一届后室春节联欢晚会，大家欢聚一堂，共同庆祝春节。",
        triggerMonth: 13,
        choices: [
            {
                text: "支持举办春节联欢晚会",
                effects: {
                    communityMood: 20,
                    influence: 10
                }
            }
        ]
    },
    {
        id: "february-uprising",
        title: "二月动乱",
        description: "2023年2月，有雪落在白川山联合大量写手发起抗议，要求管理改革。社群普遍支持白川山，反对Adaihappyjan的实际控制。",
        triggerMonth: 14,
        choices: [
            {
                text: "这已经不是一般的写手了，一定要出重拳",
                effects: {
                    adminPower: 20,
                    communityMood: -25,
                    "Adaihappyjan": 20,
                    "有雪落在白川山": -30,
                    activeWriters: -15,
                    influence: -25
                }
            },
            {
                text: "造反好啊，争取武装夺取政权",
                effects: {
                    communityMood: -15,
                    "有雪落在白川山": 35,
                    "Adaihappyjan": -25,
                    activeWriters: 10,
                    influence: -20
                }
            },
            {
                text: "寻求妥协方案，避免社群分裂",
                effects: {
                    influence: 25,
                    adminPower: -15,
                    communityMood: 10,
                    "有雪落在白川山": 10
                }
            }
        ],
        afterEvent: function(choiceIndex) {
            // 根据选择决定动乱结果
            if (choiceIndex === 1) {
                gameState.uprisingSuccess = true;
                gameState.currentLeader = "有雪落在白川山";
                gameState.characters["有雪落在白川山"].role = "站长";
            } else {
                gameState.uprisingSuccess = false;
                gameState.whiteMountainBanned = true;
                gameState.characters["有雪落在白川山"].active = false;
            }
        }
    },
    {
        id: "march-first-incident",
        title: "三一事件",
        description: "2023年3月，版主Ashy突然将大量Wikidot成员移出群聊，引发轩然大波。最终Ashy被永久封禁，FWMango也因此事受到牵连。",
        triggerMonth: 15,
        choices: [
            {
                text: "支持Ashy的行动，维护Fandom独立性",
                effects: {
                    communityMood: -20,
                    activeWriters: -10,
                    influence: -15
                }
            },
            {
                text: "批评Ashy的过激行为",
                effects: {
                    adminPower: 15,
                    communityMood: -10,
                    "Adaihappyjan": 15,
                    influence: -10
                }
            },
            {
                text: "呼吁两站和解，共同发展",
                effects: {
                    influence: 20,
                    communityMood: 15,
                    "XRHX": 20
                }
            }
        ],
        afterEvent: function() {
            gameState.characters["FWMango"].active = true;
            // 封禁Ashy、纳吉卡、小落
            gameState.characters["Ashy"].active = false;
            gameState.characters["纳吉卡"].active = false;
            gameState.characters["小落"].active = false;
        }
    },
    {
        id: "adai-becomes-leader",
        title: "Adaihappyjan成为站长",
        description: "2023年6月，Adaihappyjan正式成为站长，掌握了站点的实际管理权。",
        triggerMonth: 18,
        choices: [
            {
                text: "支持Adaihappyjan的领导",
                effects: {
                    "Adaihappyjan": 20,
                    adminPower: 10,
                    communityMood: 5,
                    influence: 5,
                    siteFunds: 100
                }
            },
            {
                text: "对Adaihappyjan的独断表示担忧",
                effects: {
                    "Adaihappyjan": -15,
                    communityMood: -10,
                    influence: -10
                }
            }
        ],
        afterEvent: function() {
            gameState.currentLeader = "Adaihappyjan";
            gameState.characters.Adaihappyjan.role = "站长";
        }
    },
    {
        id: "great-purge",
        title: "大清洗运动",
        description: "2023年7月，Adaihappyjan提出了'大清洗'计划，旨在清理全站低质量文章。这一激进改革引发了激烈争议。",
        triggerMonth: 19,
        choices: [
            {
                text: "支持大清洗，提升文章质量",
                effects: {
                    articleQuality: 25,
                    communityMood: -30,
                    "Adaihappyjan": 30,
                    activeWriters: -20,
                    influence: -15
                }
            },
            {
                text: "反对大清洗，保护创作热情",
                effects: {
                    communityMood: -15,
                    "Adaihappyjan": -30,
                    "XRHX": 15,
                    activeWriters: 15,
                    influence: -10
                }
            },
            {
                text: "提议更温和的质量改进方案",
                effects: {
                    influence: 30,
                    adminPower: -20,
                    articleQuality: 10,
                    communityMood: 5,
                    "XRHX": 20
                }
            }
        ]
    },
    {
        id: "maxwell-becomes-leader",
        title: "MaxwellYang成为站长",
        description: "2023年8月，MaxwellYang成为站长，与Adaihappyjan共同拥有管理权限。",
        triggerMonth: 20,
        choices: [
            {
                text: "支持MaxwellYang的领导",
                effects: {
                    "MaxwellYang": 20,
                    adminPower: 5,
                    communityMood: 5,
                    influence: 5
                }
            },
            {
                text: "认为权力分散会导致效率低下",
                effects: {
                    "MaxwellYang": 10,
                    "Adaihappyjan": -5,
                    communityMood: 5
                }
            }
        ],
        afterEvent: function() {
            gameState.currentLeader = "MaxwellYang";
            gameState.characters.MaxwellYang.role = "站长";
            gameState.characters.Adaihappyjan.role = "共同管理者";
        }
    },
    {
        id: "fifth-contest-achievement",
        title: "第五届主题竞赛争议",
        description: "2024年7月，第五届主题竞赛开始了，本次竞赛是争夺Object ZH 1的编号。然而有写手对本次的'成就'机制感到不满。",
        triggerMonth: 31,
        choices: [
            {
                text: "所有人都只在乎返璞归真。",
                effects: {
                    articleQuality: -10
                }
            }
        ]
    },
    {
        id: "spring-festival-2024",
        title: "后室春节联欢晚会",
        description: "2024年1月，社群举办了第二届后室春节联欢晚会，大家欢聚一堂，共同庆祝春节。",
        triggerMonth: 25,
        choices: [
            {
                text: "支持举办春节联欢晚会",
                effects: {
                    communityMood: 20,
                    influence: 10
                }
            }
        ]
    },
    {
        id: "chixu-illness",
        title: "池续患病",
        description: "2024年4月，原创组组长池续被诊断出患有急性粒细胞白血病。这一消息震惊了整个社群。",
        triggerMonth: 28,
        choices: [
            {
                text: "组织社群支持，为池续加油",
                effects: {
                    communityMood: -20,
                    "池续": 40,
                    "MaxwellYang": 10,
                    influence: 10,
                    siteFunds: -200
                }
            },
            {
                text: "继续日常工作，不过度打扰",
                effects: {
                    communityMood: -20,
                    "池续": 20,
                    "MaxwellYang": 10,
                }
            }
        ]
    },
    {
        id: "chixu-passed",
        title: "池续逝世",
        description: "2024年6月，我们挚爱的池续永远离开了我们。他的才华、热情和奉献精神都为后室中文站带来了巨大的价值。",
        triggerMonth: 30,
        choices: [
            {
                text: "人事已尽，天命难为",
                effects: {
                    articleQuality: -10,
                    communityMood: -15
                }
            }
        ],
        afterEvent: function() {
            gameState.chixuPassed = true;
            gameState.characters["池续"].active = false;
        }
    },
    {
        id: "winter-moon-sequence",
        title: "冬月奏变",
        description: "2024年12月，长期积累的矛盾终于爆发，社群面临前所未有的分裂危机。",
        triggerMonth: 36,
        isSequence: true,
        subEvents: [
            {
                title: "重写MEG CN",
                description: "APT INSTALL提议重写MEG CN，但Adaihappyjan以版权为由一票否决，引发争议。",
                choices: [
                    {
                        text: "支持重写MEG CN",
                        effects: {
                            "Adaihappyjan": -20,
                            "APT": 35,
                            communityMood: -10,
                            influence: -10
                        }
                    },
                    {
                        text: "支持Adaihappyjan的决定",
                        effects: {
                            "Adaihappyjan": 15,
                            communityMood: -5,
                            influence: -5
                        }
                    }
                ]
            },
            {
                title: "MaxwellYang下台",
                description: "在冬月奏变的压力下，MaxwellYang宣布卸任站长职务，Aread成为新站长。",
                choices: [
                    {
                        text: "支持Aread继任",
                        effects: {
                            "Aread": 20,
                            communityMood: -5,
                            influence: -5
                        }
                    },
                    {
                        text: "反对这一人事变动",
                        effects: {
                            "Aread": -15,
                            communityMood: -10,
                            influence: -10
                        }
                    }
                ],
                afterEvent: function() {
                    gameState.currentLeader = "Aread";
                    gameState.characters.Aread.role = "站长";
                    gameState.characters.MaxwellYang.role = "前站长";
                }
            },
            {
                title: "要求公开资金去向",
                description: "零域等人要求宣传组公开财务收支，引发关于资金透明度的激烈争论。",
                choices: [
                    {
                        text: "支持公开资金去向",
                        effects: {
                            "Adaihappyjan": -25,
                            communityMood: -10,
                            influence: -10
                        }
                    },
                    {
                        text: "反对公开，保护隐私",
                        effects: {
                            "Adaihappyjan": 15,
                            communityMood: -15,
                            influence: -15
                        }
                    }
                ]
            },
            {
                title: "阿达下台",
                description: "在持续的压力下，Adaihappyjan宣布下台，并带走了他投入的所有资金。",
                choices: [
                    {
                        text: "谴责Adaihappyjan的行为",
                        effects: {
                            "Adaihappyjan": -40,
                            communityMood: 20,
                            activeWriters: 15,
                            "APT": 30,
                            influence: 10,
                            siteFunds: -500
                        }
                    },
                    {
                        text: "理解Adaihappyjan的决定",
                        effects: {
                            "Adaihappyjan": -10,
                            communityMood: -25,
                            activeWriters: -10,
                            influence: -20
                        }
                    }
                ],
                afterEvent: function(choiceIndex) {
                    gameState.adaiLeft = true;
                    gameState.characters.Adaihappyjan.active = false;
                }
            },
            {
                title: "白川山要求平反",
                description: "有雪落在白川山要求为二月动乱平反，恢复其名誉。",
                choices: [
                    {
                        text: "支持平反，恢复白川山名誉",
                        effects: {
                            communityMood: 10,
                            activeWriters: 5,
                            influence: 10
                        }
                    },
                    {
                        text: "反对平反，维持原决定",
                        effects: {
                            communityMood: -10,
                            influence: -10
                        }
                    }
                ],
                afterEvent: function(choiceIndex) {
                    if (choiceIndex === 0) {
                        gameState.whiteMountainRehabilitated = true;
                        gameState.characters["有雪落在白川山"].active = true;
                        gameState.characters["有雪落在白川山"].role = "写手";
                    }
                }
            }
        ]
    },
    {
        id: "rebuild-promotion",
        title: "重建宣传组",
        description: "2025年1月，在冬月奏变后，社群开始重建宣传组，试图恢复站点的活力。",
        triggerMonth: 37,
        choices: [
            {
                text: "积极参与重建工作",
                effects: {
                    communityMood: 15,
                    activeWriters: 10,
                    influence: 10,
                    siteFunds: -100
                }
            },
            {
                text: "保持观望态度",
                effects: {
                    communityMood: 5
                }
            }
        ]
    }
];

// 月份触发的人物加入事件（已调整时间）
const monthlyCharacterJoins = {
    1: [ // 2022年1月 - 海旦已在初始序列中加入
    ],
    2: [ // 2022年2月
    ],
    3: [ // 2022年3月
        { name: "Adaihappyjan", description: "Adaihappyjan加入了后室中文站，他拥有丰富的资源和宣传经验，为站点发展提供了重要支持。" },
        { name: "Lunaticninety", description: "Lunaticninety加入了后室中文站，她是一位有管理经验的成员，未来可能在站点管理中发挥作用。" },
        { name: "Ritisech", description: "Ritisech加入了后室中文站，他是一位活跃的成员，对社区氛围有积极影响。" },
        { name: "芦苇", description: "芦苇加入了后室中文站，他是一位有管理才能的成员，未来可能在站点管理中发挥作用。" },
        { name: "XXjun", description: "XXjun加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "山后蔓", description: "山后蔓加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "Lazy", description: "Lazy加入了后室中文站，他是一位有才华的写手，能够提升站点的文章质量。" }
    ],
    4: [ // 2022年4月 - 晴雪与雨改为此时加入
        { name: "晴雪与雨", description: "晴雪与雨加入了后室中文站，她是一位有才华的创作者，对后室创作有自己的独特见解。" },
        { name: "MaxwellYang", description: "MaxwellYang加入了后室中文站，他是一位有调解能力的成员，未来可能在社群协调中发挥作用。" },
        { name: "星极", description: "星极加入了后室中文站，她是一位有才华的写手，能够提升站点的影响力。" },
        { name: "柠檬", description: "柠檬加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "Rua", description: "Rua加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "铁桶", description: "铁桶加入了后室中文站，他是一位有管理才能的成员，能够提供行政支持。" }
    ],
    5: [ // 2022年5月
        { name: "南岸青栀", description: "南岸青栀加入了后室中文站，她是一位有才华的写手，为社群带来了新的活力。" },
        { name: "Ashy", description: "Ashy加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" }
    ],
    6: [ // 2022年6月
        { name: "ZPR", description: "ZPR加入了后室中文站，他是一位有才华的写手，能够提升站点的文章质量。" }
    ],
    7: [ // 2022年7月
        { name: "月冥", description: "月冥加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "ASDS", description: "ASDS加入了后室中文站，他是一位有才华的写手，能够提升站点的文章质量。" },
        { name: "水桶", description: "水桶加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "神经", description: "神经加入了后室中文站，他是一位有管理才能的成员，能够提供行政支持。" }
    ],
    8: [ // 2022年8月
        { name: "小濮", description: "小濮加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "列文", description: "列文加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "子午线", description: "子午线加入了后室中文站，她是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "纳吉卡", description: "纳吉卡加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "时雨", description: "时雨加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" },
        { name: "8nxs", description: "8nxs加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" }
    ],
    9: [ // 2022年9月
        { name: "零域", description: "零域加入了后室中文站，他是一位有才华的写手，为社群带来了新的活力。" },
        { name: "苏狐", description: "苏狐加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "繁星", description: "繁星加入了后室中文站，他是一位有才华的写手，能够提升站点的文章质量。" }
    ],
    10: [ // 2022年10月
        { name: "Aread", description: "Aread加入了后室中文站，他是一位有管理经验的成员，未来可能在站点管理中发挥作用。" },
        { name: "小落", description: "小落加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" },
        { name: "欧阳", description: "欧阳加入了后室中文站，他是一位有才华的写手，能够提升站点的文章质量。" }
    ],
    11: [ // 2022年11月
        { name: "池续", description: "池续加入了后室中文站，他是一位才华横溢的写手，但性格和创作理念各不相同。" },
        { name: "有雪落在白川山", description: "有雪落在白川山加入了后室中文站，她是一位才华横溢的写手，但性格和创作理念各不相同。" }
    ],
    15: [ // 2023年3月
        { name: "APT", description: "APT加入了后室中文站，他是一位有想法的写手，对后室创作有自己的见解。" }
    ],
    16: [ // 2023年4月 - Stapel在23年2月加入，但为了逻辑放在4月
        { name: "Stapel", description: "Stapel加入了后室中文站，他是一位有管理才能的成员，能够提供行政支持。" }
    ],
    18: [ // 2023年6月
        { name: "York", description: "York加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" }
    ],
    25: [ // 2023年12月
        { name: "末年安夏", description: "末年安夏加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" }
    ],
    28: [ // 2024年1月
        { name: "Bingo", description: "Bingo加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" }
    ],
    29: [ // 2024年3月
        { name: "艺曦", description: "艺曦加入了后室中文站，他是一位有管理才能的成员，能够提供行政支持。" }
    ],
    31: [ // 2024年5月
        { name: "饮鸩", description: "饮鸩加入了后室中文站，他是一位注重文章质量的写手，对提升文章质量有积极影响。" }
    ],
    34: [ // 2024年6月
        { name: "Xxcby", description: "Xxcby加入了后室中文站，他是一位热心社区建设的成员，能够提升社区情绪。" }
    ]
};

// 显示人物加入事件
function showCharacterJoinEvent(index) {
    if (index >= gameState.characterJoinSequence.length) {
        // 人物加入序列结束
        gameState.inCharacterJoinSequence = false;
        gameState.characterJoinSequence = [];
        showNoCharacterJoin();
        return;
    }
    
    const characterEvent = gameState.characterJoinSequence[index];
    const character = gameState.characters[characterEvent.name];
    
    document.getElementById('character-join-description').textContent = characterEvent.description;
    
    // 更新选择按钮
    const choicesContainer = document.getElementById('character-choices-container');
    choicesContainer.innerHTML = '';
    
    const button = document.createElement('button');
    button.className = 'choice-btn';
    button.textContent = `欢迎${characterEvent.name}加入`;
    
    // 直接绑定点击事件，不通过通用选择处理
    button.onclick = function() {
        // 激活该角色
        character.active = true;
        character.relationship += 20;
        
        // 显示效果
        showCharacterEffects({ [characterEvent.name]: 20 }, `${characterEvent.name}已加入`);
        
        // 禁用选择按钮
        button.disabled = true;
        
        // 隐藏确认按钮
        document.getElementById('character-confirm-btn').classList.add('hidden');
        
        // 如果还有更多人物，显示下一事件按钮
        if (index < gameState.characterJoinSequence.length - 1) {
            document.getElementById('character-next-event-btn').classList.remove('hidden');
        } else {
            document.getElementById('character-next-event-btn').classList.add('hidden');
        }
        
        // 更新显示
        renderCharacterPanel();
        updateGameDisplay();
        // 更新按钮状态
        updateButtonStates();
    };
    
    choicesContainer.appendChild(button);
    
    // 隐藏确认按钮
    document.getElementById('character-confirm-btn').classList.add('hidden');
    // 隐藏下一事件按钮
    document.getElementById('character-next-event-btn').classList.add('hidden');
    // 隐藏效果显示
    document.getElementById('character-effects-display').classList.add('hidden');
    
    // 重置选择状态
    gameState.selectedChoice = null;
    gameState.choiceConfirmed = false;
    
    // 更新按钮状态
    updateButtonStates();
}

// 显示无人物加入
function showNoCharacterJoin() {
    document.getElementById('character-join-description').textContent = "本月没有重要人物加入。";
    document.getElementById('character-choices-container').innerHTML = '';
    document.getElementById('character-confirm-btn').classList.add('hidden');
    document.getElementById('character-next-event-btn').classList.add('hidden');
    document.getElementById('character-effects-display').classList.add('hidden');
    
    // 更新按钮状态
    updateButtonStates();
}

// 显示竞赛事件
function showContestEvent(event) {
    if (!event) {
        showNoContest();
        return;
    }
    
    document.getElementById('contest-event-title').textContent = event.title;
    document.getElementById('contest-event-description').textContent = event.description;
    
    // 更新选择按钮
    const choicesContainer = document.getElementById('contest-choices-container');
    choicesContainer.innerHTML = '';
    
    event.choices.forEach((choice, index) => {
        const button = document.createElement('button');
        button.className = 'choice-btn';
        button.textContent = choice.text;
        button.setAttribute('data-choice', index);
        button.addEventListener('click', handleContestChoiceSelection);
        choicesContainer.appendChild(button);
    });
    
    // 显示确认按钮
    document.getElementById('contest-confirm-btn').classList.remove('hidden');
    
    // 如果有多个竞赛，显示下一竞赛按钮
    if (gameState.inContestSequence && gameState.currentContestIndex < gameState.contestEvents.length - 1) {
        document.getElementById('contest-next-event-btn').classList.remove('hidden');
    } else {
        document.getElementById('contest-next-event-btn').classList.add('hidden');
    }
    
    // 隐藏效果显示
    document.getElementById('contest-effects-display').classList.add('hidden');
    
    // 重置选择状态
    gameState.selectedChoice = null;
    gameState.choiceConfirmed = false;
    
    // 更新按钮状态
    updateButtonStates();
}

// 显示无竞赛事件
function showNoContest() {
    document.getElementById('contest-event-title').textContent = "竞赛";
    document.getElementById('contest-event-description').textContent = "本月没有竞赛事件。";
    document.getElementById('contest-choices-container').innerHTML = '';
    document.getElementById('contest-confirm-btn').classList.add('hidden');
    document.getElementById('contest-next-event-btn').classList.add('hidden');
    document.getElementById('contest-effects-display').classList.add('hidden');
    
    // 更新按钮状态
    updateButtonStates();
}

// 处理竞赛选择按钮点击
function handleContestChoiceSelection(event) {
    if (gameState.choiceConfirmed) return;
    
    const choiceIndex = parseInt(event.currentTarget.getAttribute('data-choice'));
    gameState.selectedChoice = choiceIndex;
    
    // 更新按钮样式
    document.querySelectorAll('#contest-choices-container .choice-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');
    
    updateButtonStates();
}

// 处理竞赛选择确认
function handleContestChoiceConfirmation() {
    if (gameState.selectedChoice === null) return;
    
    // 获取当前竞赛事件
    const currentEvent = gameState.contestEvents[gameState.currentContestIndex];
    const choice = currentEvent.choices[gameState.selectedChoice];
    
    // 应用选择效果
    applyEffects(choice.effects);
    
    // 显示效果
    showContestEffects(choice.effects);
    
    // 标记事件为已完成
    gameState.completedEvents.push(currentEvent.id);
    
    // 标记选择已确认
    gameState.choiceConfirmed = true;
    
    // 禁用选择按钮
    document.querySelectorAll('#contest-choices-container .choice-btn').forEach(btn => {
        btn.disabled = true;
    });
    
    // 隐藏确认按钮
    document.getElementById('contest-confirm-btn').classList.add('hidden');
    
    // 更新显示
    updateGameDisplay();
    
    // 更新按钮状态
    updateButtonStates();
    
    // 检查结局条件
    checkEndings();
}

// 显示竞赛效果
function showContestEffects(effects, title = "选择效果") {
    const effectsDisplay = document.getElementById('contest-effects-display');
    effectsDisplay.classList.remove('hidden');
    effectsDisplay.innerHTML = `<div style="margin-bottom: 10px; color: #937A2D;">${title}:</div>`;
    
    Object.keys(effects).forEach(key => {
        const effectItem = document.createElement('div');
        effectItem.className = 'effect-item';
        let displayText = '';
        let value = effects[key];
        
        if (key === 'adminPower') {
            displayText = `行政力 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'influence') {
            displayText = `影响力 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'communityMood') {
            displayText = `社群情绪 ${value > 0 ? '+' : ''}${value}%`;
        } else if (key === 'articleQuality') {
            displayText = `文章质量 ${value > 0 ? '+' : ''}${value}%`;
        } else if (key === 'activeWriters') {
            displayText = `活跃写手 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'siteFunds') {
            displayText = `站点资金 ${value > 0 ? '+' : ''}${value}`;
        }
        
        effectItem.textContent = displayText;
        effectItem.classList.add(value > 0 ? 'effect-positive' : 'effect-negative');
        effectsDisplay.appendChild(effectItem);
    });
}

// 处理竞赛下一事件
function handleContestNextEvent() {
    if (gameState.inContestSequence) {
        // 处理竞赛序列
        gameState.currentContestIndex++;
        if (gameState.currentContestIndex < gameState.contestEvents.length) {
            // 显示下一个竞赛事件
            showContestEvent(gameState.contestEvents[gameState.currentContestIndex]);
        } else {
            // 竞赛序列结束
            gameState.inContestSequence = false;
            showNoContest();
        }
    }
}

// 初始化游戏
function initGame() {
    updateGameDisplay();
    renderCharacterPanel();
    updateActiveDecisions();
    updateStaffDisplay();
    renderNationalPolicies();
    updateBuffDisplay();
    
    // 添加选择按钮事件监听
    document.querySelectorAll('#site-choices-container .choice-btn').forEach(button => {
        button.addEventListener('click', handleSiteChoiceSelection);
    });
    
    // 添加决议按钮事件监听
    document.querySelectorAll('.decision-btn').forEach(button => {
        button.addEventListener('click', handleDecision);
    });
    
    // 添加时间控制按钮事件监听
    document.getElementById('next-month').addEventListener('click', advanceMonth);
    
    // 添加确认按钮事件监听
    document.getElementById('site-confirm-btn').addEventListener('click', handleSiteChoiceConfirmation);
    document.getElementById('character-confirm-btn').addEventListener('click', handleCharacterChoiceConfirmation);
    document.getElementById('contest-confirm-btn').addEventListener('click', handleContestChoiceConfirmation);
    
    // 添加下一事件按钮事件监听
    document.getElementById('site-next-event-btn').addEventListener('click', handleSiteNextEvent);
    document.getElementById('character-next-event-btn').addEventListener('click', handleCharacterNextEvent);
    document.getElementById('contest-next-event-btn').addEventListener('click', handleContestNextEvent);
    
    // 添加重新开始按钮事件监听
    document.getElementById('restart-btn').addEventListener('click', restartGame);
    
    // 显示初始事件
    showSiteEvent(gameEvents[0]);
    
    // 显示人物加入事件容器（始终显示）
    document.getElementById('character-join-container').classList.remove('hidden');
    showNoCharacterJoin();
    
    // 显示竞赛事件容器（始终显示）
    document.getElementById('site-contest-container').classList.remove('hidden');
    showNoContest();
    
    // 确保所有按钮初始状态正确
    updateButtonStates();
}

// 渲染国策系统
function renderNationalPolicies() {
    renderGeneralPolicies();
    renderPropagandaPolicies();
    updateActivePoliciesDisplay();
}

// 渲染通用国策
function renderGeneralPolicies() {
    const container = document.getElementById('general-policies');
    container.innerHTML = '';
    
    Object.values(nationalPolicies).forEach(policy => {
        if (policy.category === 'general') {
            const policyElement = createPolicyElement(policy);
            container.appendChild(policyElement);
        }
    });
}

// 渲染宣传线国策
function renderPropagandaPolicies() {
    const container = document.getElementById('propaganda-policies');
    container.innerHTML = '';
    
    Object.values(nationalPolicies).forEach(policy => {
        if (policy.category === 'propaganda') {
            const policyElement = createPolicyElement(policy);
            container.appendChild(policyElement);
        }
    });
}

// 创建国策元素
function createPolicyElement(policy) {
    const policyDiv = document.createElement('div');
    policyDiv.className = 'policy-item';
    
    const policyInfo = document.createElement('div');
    policyInfo.className = 'policy-info';
    
    const policyName = document.createElement('div');
    policyName.className = 'policy-name';
    policyName.textContent = policy.name;
    
    const policyDesc = document.createElement('div');
    policyDesc.className = 'policy-description';
    policyDesc.textContent = policy.description;
    
    const policyReq = document.createElement('div');
    policyReq.className = 'policy-requirements';
    
    // 检查前置条件
    const requirementsMet = policy.requirements.every(req => 
        gameState.nationalPolicies.completed.includes(req)
    );
    
    // 检查是否已完成
    const isCompleted = gameState.nationalPolicies.completed.includes(policy.id);
    
    // 检查是否正在执行
    const isExecuting = gameState.nationalPolicies.active.some(p => p.id === policy.id);
    
    // 检查是否有空余国策槽
    const hasFreePolicySlot = gameState.nationalPolicies.active.length < gameState.nationalPolicies.maxActivePolicies;
    
    // 检查行政力是否足够
    const hasEnoughPower = gameState.adminPower >= policy.cost;
    
    const policyBtn = document.createElement('button');
    policyBtn.className = 'policy-btn';
    
    if (isCompleted) {
        policyBtn.textContent = '已完成';
        policyBtn.disabled = true;
        policyBtn.classList.add('completed');
        policyReq.textContent = '效果: ' + formatPolicyEffects(policy.effects);
    } else if (isExecuting) {
        policyBtn.textContent = '执行中';
        policyBtn.disabled = true;
        policyBtn.classList.add('executing');
        policyReq.textContent = '执行中...';
    } else if (!requirementsMet) {
        policyBtn.textContent = '未解锁';
        policyBtn.disabled = true;
        policyReq.textContent = '需要: ' + policy.requirements.map(req => nationalPolicies[req].name).join(', ');
    } else if (!hasFreePolicySlot) {
        policyBtn.textContent = '国策槽已满';
        policyBtn.disabled = true;
        policyReq.textContent = '消耗: ' + policy.cost + '行政点';
    } else if (!hasEnoughPower) {
        policyBtn.textContent = '行政力不足';
        policyBtn.disabled = true;
        policyReq.textContent = '消耗: ' + policy.cost + '行政点';
    } else {
        policyBtn.textContent = '执行';
        policyBtn.onclick = () => executeNationalPolicy(policy);
        policyReq.textContent = '消耗: ' + policy.cost + '行政点';
    }
    
    policyInfo.appendChild(policyName);
    policyInfo.appendChild(policyDesc);
    policyInfo.appendChild(policyReq);
    
    policyDiv.appendChild(policyInfo);
    policyDiv.appendChild(policyBtn);
    
    return policyDiv;
}

// 格式化国策效果显示
function formatPolicyEffects(effects) {
    const effectStrings = [];
    for (const [key, value] of Object.entries(effects)) {
        let displayName = '';
        switch (key) {
            case 'adminPower': displayName = '行政力'; break;
            case 'influence': displayName = '影响力'; break;
            case 'articleQuality': displayName = '文章质量'; break;
            case 'activeWriters': displayName = '活跃写手'; break;
            default: displayName = key;
        }
        effectStrings.push(`${displayName}${value > 0 ? '+' : ''}${value}`);
    }
    return effectStrings.join(', ');
}

// 执行国策
function executeNationalPolicy(policy) {
    // 检查条件
    if (gameState.nationalPolicies.active.length >= gameState.nationalPolicies.maxActivePolicies) {
        alert('国策槽已满！最多同时进行' + gameState.nationalPolicies.maxActivePolicies + '个国策。');
        return;
    }
    
    if (gameState.adminPower < policy.cost) {
        alert('行政力不足！需要' + policy.cost + '点行政力。');
        return;
    }
    
    // 检查前置条件
    const requirementsMet = policy.requirements.every(req => 
        gameState.nationalPolicies.completed.includes(req)
    );
    
    if (!requirementsMet) {
        alert('未满足前置条件！');
        return;
    }
    
    // 扣除行政力
    gameState.adminPower -= policy.cost;
    
    // 添加到进行中国策
    gameState.nationalPolicies.active.push({
        id: policy.id,
        name: policy.name,
        time: policy.time,
        progress: 0,
        effects: policy.effects,
        buff: policy.buff,
        unlocks: policy.unlocks
    });
    
    // 更新显示
    updateGameDisplay();
    renderNationalPolicies();
}

// 更新进行中的国策显示
function updateActivePoliciesDisplay() {
    const container = document.getElementById('active-policies');
    container.innerHTML = '';
    
    if (gameState.nationalPolicies.active.length === 0) {
        container.innerHTML = '<div>没有进行中的国策</div>';
        return;
    }
    
    gameState.nationalPolicies.active.forEach(policy => {
        const progressPercent = (policy.progress / policy.time) * 100;
        const policyElement = document.createElement('div');
        policyElement.className = 'active-decision-item';
        policyElement.innerHTML = `
            <div>${policy.name}</div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progressPercent}%"></div>
            </div>
            <div>${policy.progress}/${policy.time}个月</div>
        `;
        container.appendChild(policyElement);
    });
    
    // 更新国策槽显示
    document.getElementById('policy-slots').textContent = 
        `${gameState.nationalPolicies.active.length}/${gameState.nationalPolicies.maxActivePolicies}`;
}

// 处理进行中的国策
function processActivePolicies() {
    for (let i = gameState.nationalPolicies.active.length - 1; i >= 0; i--) {
        const policy = gameState.nationalPolicies.active[i];
        policy.progress++;
        
        if (policy.progress >= policy.time) {
            // 国策完成
            applyEffects(policy.effects);
            
            // 添加Buff
            if (policy.buff) {
                gameState.activeBuffs[policy.buff.id] = {
                    name: policy.buff.name,
                    effect: policy.buff.effect,
                    value: policy.buff.value,
                    duration: policy.buff.duration
                };
            }
            
            // 解锁相关决议
            if (policy.unlocks) {
                policy.unlocks.forEach(decisionId => {
                    // 决议解锁逻辑在updateDecisionButtons中处理
                });
            }
            
            // 移动到已完成列表
            gameState.nationalPolicies.completed.push(policy.id);
            gameState.nationalPolicies.active.splice(i, 1);
            
            // 显示国策完成效果
            showSiteEffects(policy.effects, `${policy.name} 已完成`);
            
            // 重新渲染国策界面以更新状态
            renderNationalPolicies();
        }
    }
    
    // 处理Buff效果
    processBuffs();
    
    updateActivePoliciesDisplay();
    updateBuffDisplay();
}

// 处理Buff效果
function processBuffs() {
    // 应用持续Buff效果
    for (const buffId in gameState.activeBuffs) {
        const buff = gameState.activeBuffs[buffId];
        if (buff.effect && buff.value) {
            gameState[buff.effect] += buff.value;
        }
        
        // 处理有限时间的Buff
        if (buff.duration > 0) {
            buff.duration--;
            if (buff.duration <= 0) {
                delete gameState.activeBuffs[buffId];
            }
        }
    }
}

// 更新Buff显示
function updateBuffDisplay() {
    const container = document.getElementById('buff-list');
    container.innerHTML = '';
    
    if (Object.keys(gameState.activeBuffs).length === 0) {
        container.innerHTML = '<div style="color: #666; font-style: italic;">暂无生效Buff</div>';
        return;
    }
    
    for (const buffId in gameState.activeBuffs) {
        const buff = gameState.activeBuffs[buffId];
        const buffElement = document.createElement('div');
        buffElement.className = 'buff-item';
        buffElement.textContent = `${buff.name}`;
        container.appendChild(buffElement);
    }
}

// 前进一个月
function advanceMonth() {
    // 如果正在处理人物加入序列、冬月奏变序列或竞赛序列，不允许前进
    if (gameState.inCharacterJoinSequence || gameState.inWinterMoonSequence || gameState.inContestSequence) {
        return;
    }
    
    // 重置选择状态
    gameState.selectedChoice = null;
    gameState.choiceConfirmed = false;
    
    // 处理进行中的决议
    processActiveDecisions();
    
    // 处理进行中的国策
    processActivePolicies();
    
    // 处理管理员和版主好感度
    processStaffRelationships();
    
    // 应用管理员和版主加成
    applyStaffBonuses();
    
    // 更新月份
    gameState.month++;
    if (gameState.month > 12) {
        gameState.month = 1;
        gameState.year++;
    }
    
    // 每月减少20影响力
    gameState.influence = Math.max(0, gameState.influence - 20);
    
    // 更新行政力（除特殊时期外每月+5）
    const currentMonth = (gameState.year - 2022) * 12 + gameState.month;
    if (!((currentMonth >= 14 && currentMonth <= 15) || currentMonth === 36)) {
        gameState.adminPower += 5;
    }
    
    // 活跃写手大于150时，行政力每月额外增加10
    if (gameState.activeWriters > 150) {
        gameState.adminPower += 10;
    }
    
    // 活跃写手大于250时，文章质量每月下降20（原为>200，现改为>250）
    if (gameState.activeWriters > 250) {
        gameState.articleQuality = Math.max(0, gameState.articleQuality - 20);
    }
    
    // 活跃写手小于30时，社区情绪每月下降5
    if (gameState.activeWriters < 30) {
        gameState.communityMood = Math.max(0, gameState.communityMood - 5);
    }
    
    // 社群情绪影响行政力
    if (gameState.communityMood >= 70) {
        gameState.adminPower += 5;
    } else if (gameState.communityMood <= 30) {
        gameState.adminPower -= 5;
    }
    
    // 影响力影响活跃写手
    if (gameState.influence >= 60) {
        gameState.activeWriters += Math.floor(gameState.influence / 20);
    }
    
    // 确保数值在合理范围内
    gameState.influence = Math.max(0, gameState.influence);
    gameState.adminPower = Math.max(0, gameState.adminPower);
    gameState.communityMood = Math.max(0, Math.min(100, gameState.communityMood));
    gameState.articleQuality = Math.max(0, Math.min(100, gameState.articleQuality));
    gameState.activeWriters = Math.max(0, gameState.activeWriters);
    gameState.siteFunds = Math.max(0, gameState.siteFunds);
    
    updateTimeDisplay();
    checkEvents();
    checkCharacterJoins();
    checkContests();
    updateGameDisplay();
    
    // 检查结局条件
    checkEndings();
}

// 更新按钮状态
function updateButtonStates() {
    const nextMonthBtn = document.getElementById('next-month');
    const siteConfirmBtn = document.getElementById('site-confirm-btn');
    const siteNextEventBtn = document.getElementById('site-next-event-btn');
    const characterConfirmBtn = document.getElementById('character-confirm-btn');
    const characterNextEventBtn = document.getElementById('character-next-event-btn');
    const contestConfirmBtn = document.getElementById('contest-confirm-btn');
    const contestNextEventBtn = document.getElementById('contest-next-event-btn');
    
    // 如果有选择但未确认，禁用"下一个月"按钮
    nextMonthBtn.disabled = (gameState.selectedChoice !== null && !gameState.choiceConfirmed) ||
                           gameState.inCharacterJoinSequence ||
                           gameState.inContestSequence;
    
    // 站内事件按钮状态
    siteConfirmBtn.disabled = (gameState.selectedChoice === null);
    
    // 人物加入事件按钮状态
    characterConfirmBtn.disabled = (gameState.selectedChoice === null);
    
    // 竞赛事件按钮状态
    contestConfirmBtn.disabled = (gameState.selectedChoice === null);
    
    // 在人物加入序列中显示下一事件按钮
    characterNextEventBtn.classList.toggle('hidden', !gameState.inCharacterJoinSequence);
    
    // 在冬月奏变序列中显示下一事件按钮
    siteNextEventBtn.classList.toggle('hidden', !gameState.inWinterMoonSequence);
    
    // 在竞赛序列中显示下一事件按钮
    contestNextEventBtn.classList.toggle('hidden', !gameState.inContestSequence);
    
    // 更新决议按钮状态
    updateDecisionButtons();
}

// 更新决议按钮状态
function updateDecisionButtons() {
    document.querySelectorAll('.decision-btn').forEach(button => {
        const decisionId = button.id;
        if (decisionId === "decision-appoint-admin" || decisionId === "decision-dismiss-admin" ||
            decisionId === "decision-appoint-moderator" || decisionId === "decision-dismiss-moderator" ||
            decisionId === "decision-improve-relation" || decisionId === "decision-decrease-relation") {
            // 人事决议和关系决议按钮特殊处理
            button.disabled = false;
            return;
        }
        
        const decision = decisions[decisionId];
        
        // 检查是否已有相同决议在进行中
        const isActive = gameState.activeDecisions.some(d => d.id === decisionId);
        
        // 检查是否有足够的行政力和决议槽
        const hasEnoughPower = gameState.adminPower >= decision.cost;
        const hasFreeSlot = gameState.activeDecisions.length < gameState.decisionSlots;
        
        // 检查是否需要前置国策
        const policyRequired = decision.requiresPolicy;
        const hasRequiredPolicy = !policyRequired || gameState.nationalPolicies.completed.includes(policyRequired);
        
        button.disabled = isActive || !hasEnoughPower || !hasFreeSlot || !hasRequiredPolicy;
        button.classList.toggle('active-decision', isActive);
        
        // 添加提示信息
        if (policyRequired && !gameState.nationalPolicies.completed.includes(policyRequired)) {
            button.title = `需要先完成国策: ${nationalPolicies[policyRequired].name}`;
        } else {
            button.title = '';
        }
    });
}

// 处理进行中的决议
function processActiveDecisions() {
    for (let i = gameState.activeDecisions.length - 1; i >= 0; i--) {
        const decision = gameState.activeDecisions[i];
        decision.progress++;
        
        if (decision.progress >= decision.time) {
            // 决议完成
            applyEffects(decision.effects);
            gameState.activeDecisions.splice(i, 1);
            
            // 显示决议完成效果
            showSiteEffects(decision.effects, `${decision.name} 已完成`);
        }
    }
    
    updateActiveDecisions();
}

// 更新进行中的决议显示
function updateActiveDecisions() {
    const container = document.getElementById('active-decisions');
    container.innerHTML = '';
    
    if (gameState.activeDecisions.length === 0) {
        container.innerHTML = '<div>没有进行中的决议</div>';
        return;
    }
    
    gameState.activeDecisions.forEach(decision => {
        const progressPercent = (decision.progress / decision.time) * 100;
        const decisionElement = document.createElement('div');
        decisionElement.className = 'active-decision-item';
        decisionElement.innerHTML = `
            <div>${decision.name}</div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progressPercent}%"></div>
            </div>
            <div>${decision.progress}/${decision.time}个月</div>
        `;
        container.appendChild(decisionElement);
    });
}

// 处理决议
function handleDecision(event) {
    const decisionId = event.currentTarget.id;
    
    if (decisionId === "decision-appoint-admin") {
        appointAdmin();
        return;
    }
    
    if (decisionId === "decision-dismiss-admin") {
        dismissAdmin();
        return;
    }
    
    if (decisionId === "decision-appoint-moderator") {
        appointModerator();
        return;
    }
    
    if (decisionId === "decision-dismiss-moderator") {
        dismissModerator();
        return;
    }
    
    if (decisionId === "decision-improve-relation") {
        improveRelation();
        return;
    }
    
    if (decisionId === "decision-decrease-relation") {
        decreaseRelation();
        return;
    }
    
    const decision = decisions[decisionId];
    
    // 检查是否已有相同决议在进行中
    if (gameState.activeDecisions.some(d => d.id === decisionId)) {
        return;
    }
    
    // 检查是否有足够的行政力和决议槽
    if (gameState.adminPower < decision.cost ||
        gameState.activeDecisions.length >= gameState.decisionSlots) {
        return;
    }
    
    // 检查是否需要前置国策
    if (decision.requiresPolicy && !gameState.nationalPolicies.completed.includes(decision.requiresPolicy)) {
        alert(`需要先完成国策: ${nationalPolicies[decision.requiresPolicy].name}`);
        return;
    }
    
    // 扣除行政力
    gameState.adminPower -= decision.cost;
    
    // 添加到进行中的决议
    gameState.activeDecisions.push({
        id: decisionId,
        name: decision.name,
        time: decision.time,
        progress: 0,
        effects: decision.effects
    });
    
    // 更新显示
    updateGameDisplay();
    updateActiveDecisions();
}

// 任命管理员
function appointAdmin() {
    // 检查行政力
    if (gameState.adminPower < 15) {
        alert("行政力不足！需要15点行政力。");
        return;
    }
    
    const availableCharacters = Object.keys(gameState.characters).filter(name => 
        gameState.characters[name].active &&
        !gameState.admins.includes(name) &&
        name !== gameState.currentLeader &&
        !gameState.moderators.includes(name)
    );
    
    if (availableCharacters.length === 0) {
        alert("没有合适的人选可以任命为管理员！");
        return;
    }
    
    if (gameState.admins.length >= 2) {
        alert("管理员名额已满！最多只能有2名管理员。");
        return;
    }
    
    const characterName = prompt(`请选择任命为管理员的人选：\n${availableCharacters.join(', ')}`);
    
    if (characterName && availableCharacters.includes(characterName)) {
        gameState.admins.push(characterName);
        gameState.characters[characterName].relationship += 20;
        gameState.adminPower -= 15; // 消耗行政力
        updateStaffDisplay();
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已任命 ${characterName} 为管理员！`);
    }
}

// 撤销管理员
function dismissAdmin() {
    // 检查行政力
    if (gameState.adminPower < 10) {
        alert("行政力不足！需要10点行政力。");
        return;
    }
    
    if (gameState.admins.length === 0) {
        alert("当前没有管理员可以撤销！");
        return;
    }
    
    const characterName = prompt(`请选择要撤销的管理员：\n${gameState.admins.join(', ')}`);
    
    if (characterName && gameState.admins.includes(characterName)) {
        gameState.admins = gameState.admins.filter(name => name !== characterName);
        gameState.characters[characterName].relationship -= 30;
        gameState.adminPower -= 10; // 消耗行政力
        updateStaffDisplay();
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已撤销 ${characterName} 的管理员职务！`);
    }
}

// 任命版主
function appointModerator() {
    // 检查行政力
    if (gameState.adminPower < 10) {
        alert("行政力不足！需要10点行政力。");
        return;
    }
    
    const availableCharacters = Object.keys(gameState.characters).filter(name => 
        gameState.characters[name].active &&
        !gameState.moderators.includes(name) &&
        name !== gameState.currentLeader &&
        !gameState.admins.includes(name)
    );
    
    if (availableCharacters.length === 0) {
        alert("没有合适的人选可以任命为版主！");
        return;
    }
    
    if (gameState.moderators.length >= 3) {
        alert("版主名额已满！最多只能有3名版主。");
        return;
    }
    
    const characterName = prompt(`请选择任命为版主的人选：\n${availableCharacters.join(', ')}`);
    
    if (characterName && availableCharacters.includes(characterName)) {
        gameState.moderators.push(characterName);
        gameState.characters[characterName].relationship += 10;
        gameState.adminPower -= 10; // 消耗行政力
        updateStaffDisplay();
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已任命 ${characterName} 为版主！`);
    }
}

// 撤销版主
function dismissModerator() {
    // 检查行政力
    if (gameState.adminPower < 5) {
        alert("行政力不足！需要5点行政力。");
        return;
    }
    
    if (gameState.moderators.length === 0) {
        alert("当前没有版主可以撤销！");
        return;
    }
    
    const characterName = prompt(`请选择要撤销的版主：\n${gameState.moderators.join(', ')}`);
    
    if (characterName && gameState.moderators.includes(characterName)) {
        gameState.moderators = gameState.moderators.filter(name => name !== characterName);
        gameState.characters[characterName].relationship -= 20;
        gameState.adminPower -= 5; // 消耗行政力
        updateStaffDisplay();
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已撤销 ${characterName} 的版主职务！`);
    }
}

// 提升人物好感度
function improveRelation() {
    // 检查行政力
    if (gameState.adminPower < 10) {
        alert("行政力不足！需要10点行政力。");
        return;
    }
    
    const availableCharacters = Object.keys(gameState.characters).filter(name => 
        gameState.characters[name].active
    );
    
    if (availableCharacters.length === 0) {
        alert("没有合适的人选！");
        return;
    }
    
    const characterName = prompt(`请选择要提升好感度的人物：\n${availableCharacters.join(', ')}`);
    
    if (characterName && availableCharacters.includes(characterName)) {
        gameState.characters[characterName].relationship += 20;
        gameState.characters[characterName].relationship = Math.min(100, gameState.characters[characterName].relationship);
        gameState.adminPower -= 10; // 消耗行政力
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已提升 ${characterName} 的好感度！`);
    }
}

// 降低人物好感度
function decreaseRelation() {
    // 检查行政力
    if (gameState.adminPower < 5) {
        alert("行政力不足！需要5点行政力。");
        return;
    }
    
    const availableCharacters = Object.keys(gameState.characters).filter(name => 
        gameState.characters[name].active
    );
    
    if (availableCharacters.length === 0) {
        alert("没有合适的人选！");
        return;
    }
    
    const characterName = prompt(`请选择要降低好感度的人物：\n${availableCharacters.join(', ')}`);
    
    if (characterName && availableCharacters.includes(characterName)) {
        gameState.characters[characterName].relationship -= 20;
        gameState.characters[characterName].relationship = Math.max(0, gameState.characters[characterName].relationship);
        gameState.adminPower -= 5; // 消耗行政力
        renderCharacterPanel();
        updateGameDisplay();
        alert(`已降低 ${characterName} 的好感度！`);
    }
}

// 应用效果到游戏状态
function applyEffects(effects) {
    Object.keys(effects).forEach(key => {
        if (key in gameState) {
            gameState[key] += effects[key];
            // 确保数值在合理范围内
            if (key === 'communityMood') {
                gameState[key] = Math.max(0, Math.min(100, gameState[key]));
            } else if (key === 'adminPower' || key === 'influence') {
                gameState[key] = Math.max(0, gameState[key]);
            } else if (key === 'activeWriters') {
                gameState[key] = Math.max(0, gameState[key]);
            } else if (key === 'articleQuality') {
                gameState[key] = Math.max(0, Math.min(100, gameState[key]));
            } else if (key === 'siteFunds') {
                gameState[key] = Math.max(0, gameState[key]);
            }
        } else if (key in gameState.characters) {
            gameState.characters[key].relationship += effects[key];
            gameState.characters[key].relationship = Math.max(0, Math.min(100, gameState.characters[key].relationship));
        }
    });
}

// 显示站内事件效果
function showSiteEffects(effects, title = "选择效果") {
    const effectsDisplay = document.getElementById('site-effects-display');
    effectsDisplay.classList.remove('hidden');
    effectsDisplay.innerHTML = `<div style="margin-bottom: 10px; color: #937A2D;">${title}:</div>`;
    
    Object.keys(effects).forEach(key => {
        const effectItem = document.createElement('div');
        effectItem.className = 'effect-item';
        let displayText = '';
        let value = effects[key];
        
        if (key === 'adminPower') {
            displayText = `行政力 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'influence') {
            displayText = `影响力 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'communityMood') {
            displayText = `社群情绪 ${value > 0 ? '+' : ''}${value}%`;
        } else if (key === 'articleQuality') {
            displayText = `文章质量 ${value > 0 ? '+' : ''}${value}%`;
        } else if (key === 'activeWriters') {
            displayText = `活跃写手 ${value > 0 ? '+' : ''}${value}`;
        } else if (key === 'siteFunds') {
            displayText = `站点资金 ${value > 0 ? '+' : ''}${value}`;
        } else if (key in gameState.characters) {
            displayText = `${key} 关系 ${value > 0 ? '+' : ''}${value}`;
        }
        
        effectItem.textContent = displayText;
        effectItem.classList.add(value > 0 ? 'effect-positive' : 'effect-negative');
        effectsDisplay.appendChild(effectItem);
    });
}

// 显示人物加入事件效果
function showCharacterEffects(effects, title = "选择效果") {
    const effectsDisplay = document.getElementById('character-effects-display');
    effectsDisplay.classList.remove('hidden');
    effectsDisplay.innerHTML = `<div style="margin-bottom: 10px; color: #937A2D;">${title}:</div>`;
    
    Object.keys(effects).forEach(key => {
        const effectItem = document.createElement('div');
        effectItem.className = 'effect-item';
        let displayText = '';
        let value = effects[key];
        
        if (key in gameState.characters) {
            displayText = `${key} 关系 ${value > 0 ? '+' : ''}${value}`;
        }
        
        effectItem.textContent = displayText;
        effectItem.classList.add(value > 0 ? 'effect-positive' : 'effect-negative');
        effectsDisplay.appendChild(effectItem);
    });
}

// 检查月份触发的人物加入
function checkCharacterJoins() {
    const currentMonth = (gameState.year - 2022) * 12 + gameState.month;
    
    if (monthlyCharacterJoins[currentMonth]) {
        gameState.characterJoinSequence = [...monthlyCharacterJoins[currentMonth]];
        gameState.inCharacterJoinSequence = true;
        gameState.currentCharacterJoinIndex = 0;
        showCharacterJoinEvent(0);
    }
}

// 检查竞赛事件
function checkContests() {
    const currentMonth = (gameState.year - 2022) * 12 + gameState.month;
    
    // 收集本月所有未完成的竞赛事件
    const thisMonthContests = contestEvents.filter(contest => 
        !gameState.completedEvents.includes(contest.id) &&
        contest.triggerMonth === currentMonth
    );
    
    if (thisMonthContests.length > 0) {
        // 如果有多个竞赛，启动竞赛序列
        gameState.contestEvents = thisMonthContests;
        gameState.inContestSequence = true;
        gameState.currentContestIndex = 0;
        
        // 显示竞赛事件
        showContestEvent(thisMonthContests[0]);
    } else {
        // 没有竞赛事件，显示默认状态
        showNoContest();
    }
}

// 处理管理员和版主好感度
function processStaffRelationships() {
    // 管理员每月+10%好感度
    gameState.admins.forEach(admin => {
        if (gameState.characters[admin]) {
            gameState.characters[admin].relationship = Math.min(100, gameState.characters[admin].relationship + 10);
            // 如果是Adaihappyjan，则每月降低社区情绪5点
            if (admin === "Adaihappyjan") {
                gameState.communityMood = Math.max(0, gameState.communityMood - 5);
            }
        }
    });
    
    // 版主每月+5%好感度
    gameState.moderators.forEach(moderator => {
        if (gameState.characters[moderator]) {
            gameState.characters[moderator].relationship = Math.min(100, gameState.characters[moderator].relationship + 5);
            // 如果是Adaihappyjan，则每月降低社区情绪3点
            if (moderator === "Adaihappyjan") {
                gameState.communityMood = Math.max(0, gameState.communityMood - 3);
            }
        }
    });
    
    renderCharacterPanel();
}

// 应用管理员和版主加成
function applyStaffBonuses() {
    // 应用管理员加成
    gameState.admins.forEach(admin => {
        const character = gameState.characters[admin];
        if (character && character.adminBonus) {
            Object.entries(character.adminBonus).forEach(([stat, value]) => {
                if (stat in gameState) {
                    gameState[stat] += value;
                }
            });
        }
    });
    
    // 应用版主加成
    gameState.moderators.forEach(moderator => {
        const character = gameState.characters[moderator];
        if (character && character.moderatorBonus) {
            Object.entries(character.moderatorBonus).forEach(([stat, value]) => {
                if (stat in gameState) {
                    gameState[stat] += value;
                }
            });
        }
    });
}

// 更新时间显示
function updateTimeDisplay() {
    const monthNames = ["1月", "2月", "3月", "4月", "5月", "6月",
                       "7月", "8月", "9月", "10月", "11月", "12月"];
    
    document.getElementById('current-time').textContent = 
        `${gameState.year}年${monthNames[gameState.month-1]}`;
}

// 检查事件触发
function checkEvents() {
    // 如果正在处理人物加入序列、冬月奏变序列或竞赛序列，不检查其他事件
    if (gameState.inCharacterJoinSequence || gameState.inWinterMoonSequence || gameState.inContestSequence) return;
    
    const currentMonth = (gameState.year - 2022) * 12 + gameState.month;
    
    for (let i = 0; i < gameEvents.length; i++) {
        const event = gameEvents[i];
        if (!gameState.completedEvents.includes(event.id) &&
            event.triggerMonth === currentMonth) {
            
            // 如果是冬月奏变序列事件
            if (event.isSequence) {
                gameState.inWinterMoonSequence = true;
                gameState.winterMoonEvents = [...event.subEvents];
                gameState.currentSubEventIndex = 0;
                showSiteEvent(gameState.winterMoonEvents[0]);
                document.getElementById('site-next-event-btn').classList.remove('hidden');
            } else {
                // 普通事件
                gameState.currentEventIndex = i;
                showSiteEvent(event);
            }
            return;
        }
    }
    
    // 没有事件发生
    showNoSiteEvent();
}

// 显示站内事件
function showSiteEvent(event) {
    document.getElementById('site-event-title').textContent = event.title;
    document.getElementById('site-event-description').textContent = event.description;
    
    // 更新选择按钮
    const choicesContainer = document.getElementById('site-choices-container');
    choicesContainer.innerHTML = '';
    
    event.choices.forEach((choice, index) => {
        // 检查条件是否满足
        if (choice.condition && !choice.condition()) {
            return;
        }
        
        const button = document.createElement('button');
        button.className = 'choice-btn';
        button.textContent = choice.text;
        button.setAttribute('data-choice', index);
        button.addEventListener('click', handleSiteChoiceSelection);
        choicesContainer.appendChild(button);
    });
    
    // 显示确认按钮
    document.getElementById('site-confirm-btn').classList.remove('hidden');
    
    // 隐藏下一事件按钮（除非是冬月奏变序列）
    if (!gameState.inWinterMoonSequence) {
        document.getElementById('site-next-event-btn').classList.add('hidden');
    }
    
    // 隐藏效果显示
    document.getElementById('site-effects-display').classList.add('hidden');
    
    // 重置选择状态
    gameState.selectedChoice = null;
    gameState.choiceConfirmed = false;
    
    // 更新按钮状态
    updateButtonStates();
}

// 显示无站内事件
function showNoSiteEvent() {
    document.getElementById('site-event-title').textContent = "无重大事件";
    document.getElementById('site-event-description').textContent = 
        `本月没有重大事件发生。社群继续正常运作，${gameState.currentLeader}作为站长管理站点事务。`;
    
    // 清空选择按钮
    const choicesContainer = document.getElementById('site-choices-container');
    choicesContainer.innerHTML = '';
    
    // 隐藏确认按钮和下一事件按钮
    document.getElementById('site-confirm-btn').classList.add('hidden');
    document.getElementById('site-next-event-btn').classList.add('hidden');
    
    // 隐藏效果显示
    document.getElementById('site-effects-display').classList.add('hidden');
    
    // 重置选择状态
    gameState.selectedChoice = null;
    gameState.choiceConfirmed = false;
    
    // 更新按钮状态
    updateButtonStates();
}

// 处理站内选择按钮点击
function handleSiteChoiceSelection(event) {
    // 如果已经确认选择，不允许更改
    if (gameState.choiceConfirmed) return;
    
    const choiceIndex = parseInt(event.currentTarget.getAttribute('data-choice'));
    gameState.selectedChoice = choiceIndex;
    
    // 更新按钮样式
    document.querySelectorAll('#site-choices-container .choice-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');
    
    // 更新按钮状态
    updateButtonStates();
}

// 处理站内选择确认
function handleSiteChoiceConfirmation() {
    if (gameState.selectedChoice === null) return;
    
    // 获取当前事件
    let currentEvent;
    if (gameState.inWinterMoonSequence) {
        currentEvent = gameState.winterMoonEvents[gameState.currentSubEventIndex];
    } else {
        currentEvent = gameEvents[gameState.currentEventIndex];
    }
    
    const choice = currentEvent.choices[gameState.selectedChoice];
    
    // 应用选择效果
    applyEffects(choice.effects);
    
    // 显示效果
    showSiteEffects(choice.effects);
    
    // 执行事件后处理
    if (currentEvent.afterEvent) {
        currentEvent.afterEvent(gameState.selectedChoice);
    }
    
    // 如果不是冬月奏变序列，标记事件为已完成
    if (!gameState.inWinterMoonSequence) {
        gameState.completedEvents.push(currentEvent.id);
    }
    
    // 标记选择已确认
    gameState.choiceConfirmed = true;
    
    // 禁用选择按钮
    document.querySelectorAll('#site-choices-container .choice-btn').forEach(btn => {
        btn.disabled = true;
    });
    
    // 隐藏确认按钮
    document.getElementById('site-confirm-btn').classList.add('hidden');
    
    // 更新显示
    updateGameDisplay();
    renderCharacterPanel();
    
    // 更新按钮状态
    updateButtonStates();
    
    // 检查结局条件
    checkEndings();
}

// 处理人物选择确认
function handleCharacterChoiceConfirmation() {
    // 此函数保留用于未来扩展
}

// 处理站内下一事件
function handleSiteNextEvent() {
    if (gameState.inWinterMoonSequence) {
        // 处理冬月奏变序列
        gameState.currentSubEventIndex++;
        if (gameState.currentSubEventIndex < gameState.winterMoonEvents.length) {
            // 显示下一个事件
            showSiteEvent(gameState.winterMoonEvents[gameState.currentSubEventIndex]);
        } else {
            // 冬月奏变序列结束
            gameState.inWinterMoonSequence = false;
            gameState.completedEvents.push("winter-moon-sequence");
            document.getElementById('site-next-event-btn').classList.add('hidden');
            showNoSiteEvent();
        }
    }
}

// 处理人物下一事件
function handleCharacterNextEvent() {
    if (gameState.inCharacterJoinSequence) {
        // 处理人物加入序列
        gameState.currentCharacterJoinIndex++;
        if (gameState.currentCharacterJoinIndex < gameState.characterJoinSequence.length) {
            // 显示下一个角色加入事件
            showCharacterJoinEvent(gameState.currentCharacterJoinIndex);
        } else {
            // 人物加入序列结束
            gameState.inCharacterJoinSequence = false;
            gameState.characterJoinSequence = [];
            gameState.currentCharacterJoinIndex = 0;
            document.getElementById('character-next-event-btn').classList.add('hidden');
            showNoCharacterJoin();
        }
    }
}

// 更新游戏显示
function updateGameDisplay() {
    document.getElementById('admin-power').textContent = gameState.adminPower;
    document.getElementById('influence').textContent = gameState.influence;
    document.getElementById('community-mood').textContent = gameState.communityMood;
    document.getElementById('article-quality').textContent = gameState.articleQuality;
    document.getElementById('active-writers').textContent = gameState.activeWriters;
    document.getElementById('site-funds').textContent = gameState.siteFunds;
    document.getElementById('current-leader').textContent = gameState.currentLeader;
    document.getElementById('decision-slots').textContent = 
        `${gameState.activeDecisions.length}/${gameState.decisionSlots}`;
    
    updateDecisionButtons();
}

// 渲染角色面板
function renderCharacterPanel() {
    const container = document.getElementById('characters-container');
    container.innerHTML = '';
    
    Object.values(gameState.characters).forEach(character => {
        // 不显示未激活的角色
        if (character.active === false) return;
        
        const card = document.createElement('div');
        card.className = 'character-card';
        
        const relationshipPercent = Math.max(0, Math.min(100, character.relationship));
        
        card.innerHTML = `
            <div class="character-info">
                <div class="character-name">${character.name}</div>
                <div class="character-role">${character.role}</div>
                <div class="relationship-bar">
                    <div class="relationship-fill" style="width: ${relationshipPercent}%"></div>
                </div>
            </div>
        `;
        
        container.appendChild(card);
    });
}

// 更新管理员和版主显示
function updateStaffDisplay() {
    const adminNames = document.getElementById('admin-names');
    const moderatorNames = document.getElementById('moderator-names');
    
    adminNames.textContent = gameState.admins.length > 0 ? gameState.admins.join(', ') : '无';
    moderatorNames.textContent = gameState.moderators.length > 0 ? gameState.moderators.join(', ') : '无';
}

// 检查结局条件
function checkEndings() {
    // 结局1: 社群活跃写手数为0，站点无法运行
    if (gameState.activeWriters <= 0) {
        endGame("无活跃写手，站点无法运行", "人都跑光了，我们完蛋了，哈哈。");
        return;
    }
    
    // 结局1.5: 社群情绪过小，站点无法运行
    if (gameState.communityMood <= 7) {
        endGame("社区不满，大家造反了", "搞什么！又来动乱！");
        return;
    }
    
    // 结局2: 文章质量为0，站点沦为"垃圾场"
    if (gameState.articleQuality <= 0) {
        endGame("站点沦为垃圾场", "文章质量降至0，站点内容质量极低，沦为网络垃圾场，失去了存在的意义。");
        return;
    }
    
    // 结局3: 行政力过低，无政府状态
    if (gameState.adminPower <= 0) {
        endGame("无政府状态", "行政力降至0，站点管理完全瘫痪，陷入无政府状态，无法继续运作。");
        return;
    }
    
    // 结局4: 影响力过低，被Wikidot入侵
    if (gameState.influence <= 0) {
        endGame("被Wikidot入侵", "影响力降至0，站点失去独立性，被Wikidot后室中文站完全控制。");
        return;
    }
    
    // 结局5: RBTL支持度高，没有下台
    if (gameState.rbtlStayed && gameState.year >= 2023) {
        endGame("纯粹派的胜利", "在您的支持下，RBTL成功度过了文风战争危机，继续领导后室中文站。纯粹美学成为站点的主导创作方向。（晴雪：喂我花生）");
        return;
    }
    
    // 结局6: 二月动乱成功，白川山上台（在23年3月判定）
    if (gameState.uprisingSuccess && gameState.year === 2023 && gameState.month >= 3) {
        endGame("写手动乱成功", "二月动乱取得了成功，有雪落在白川山成为新任站长，社群建立了更加民主的管理制度。");
        return;
    }
    
    // 结局7: 冬月奏变失败，阿达复辟
    if (gameState.year >= 2025 && 
        gameState.completedEvents.includes("winter-moon-sequence") && 
        gameState.characters.Adaihappyjan.relationship > 70 && !gameState.adaiLeft) {
        endGame("冬月奏变失败 - 阿达复辟", "冬月奏变失败，Adaihappyjan凭借其高支持度重新掌握权力，恢复了原有的管理模式。冬月奏变成为了和二月动乱一样的事情，但是大家都知道总有一天人们能成功。");
        return;
    }
    
    // 结局8和9: 冬月奏变胜利（在25年1月判定）
    if (gameState.year >= 2025 && 
        gameState.completedEvents.includes("winter-moon-sequence")) {
        
        // 如果Aread支持度小于50%，则支持度最高者上台
        if (gameState.characters.Aread.relationship < 50) {
            // 找出支持度最高的角色
            let highestSupport = 0;
            let highestLeader = "Aread";
            Object.entries(gameState.characters).forEach(([name, char]) => {
                if (char.relationship > highestSupport && char.active !== false) {
                    highestSupport = char.relationship;
                    highestLeader = name;
                }
            });
            
            endGame("冬月奏变胜利 - " + highestLeader + "执政", "冬月奏变后，由于Aread支持度不足，" + highestLeader + "成为新任站长，带领社群继续前行。");
        } else {
            endGame("冬月奏变胜利 - Aread继续执政", "冬月奏变后，Aread继续担任站长，带领社群进入新的发展阶段。");
        }
        return;
    }
    
    // 检查是否到达游戏终点（2025年1月后）
    if (gameState.year > 2025 || (gameState.year === 2025 && gameState.month > 1)) {
        endGame("游戏结束", "您已体验完后室中文站的完整历史。感谢您的参与！");
    }
}

// 结束游戏
function endGame(title, description) {
    gameState.isGameOver = true;
    
    const siteEventContainer = document.getElementById('site-event-container');
    const characterJoinContainer = document.getElementById('character-join-container');
    const contestContainer = document.getElementById('site-contest-container');
    const gameOverContainer = document.getElementById('game-over-container');
    
    siteEventContainer.classList.add('hidden');
    characterJoinContainer.classList.add('hidden');
    contestContainer.classList.add('hidden');
    gameOverContainer.classList.remove('hidden');
    
    document.getElementById('game-over-title').textContent = title;
    document.getElementById('game-over-description').textContent = description;
}

// 重新开始游戏 - 修复版本
function restartGame() {
    // 停止所有定时器
    clearInterval(quoteInterval);
    
    // 重新加载页面以完全重置游戏状态
    window.location.reload();
}
</script>
</body>
</html>
